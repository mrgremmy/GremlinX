/**
 * Core type definitions, branded types, and type guard functions.
 *
 * @packageDocumentation
 */
import { compare, equals, fromHex, isZero } from './io/index.js';
/** @internal Do not mutate */
const EC_P = fromHex('fffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f');
/** @internal Do not mutate â€” secp256k1 curve order */
const EC_N = fromHex('fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141');
export const SATOSHI_MAX = 21n * 10n ** 14n;
export const TAPLEAF_VERSION_MASK = 0xfe;
export function isUInt8(value) {
    return typeof value === 'number' && Number.isInteger(value) && value >= 0 && value <= 0xff;
}
export function isUInt32(value) {
    return (typeof value === 'number' && Number.isInteger(value) && value >= 0 && value <= 0xffffffff);
}
export function isNumber(value) {
    return typeof value === 'number' && Number.isFinite(value);
}
export function isUint8Array(value) {
    return value instanceof Uint8Array;
}
export function isUint8ArrayN(value, n) {
    return value instanceof Uint8Array && value.length === n;
}
export function isArray(value) {
    return Array.isArray(value);
}
export function isHex(value) {
    if (typeof value !== 'string')
        return false;
    if (value.length % 2 !== 0)
        return false;
    return /^[0-9a-fA-F]*$/.test(value);
}
export function isBytes32(value) {
    return value instanceof Uint8Array && value.length === 32;
}
export function isBytes20(value) {
    return value instanceof Uint8Array && value.length === 20;
}
export function isXOnlyPublicKey(value) {
    if (!(value instanceof Uint8Array) || value.length !== 32)
        return false;
    if (isZero(value))
        return false;
    return compare(value, EC_P) < 0;
}
export function isPoint(value) {
    if (!(value instanceof Uint8Array))
        return false;
    if (value.length < 33)
        return false;
    const prefix = value[0];
    const x = value.subarray(1, 33);
    if (isZero(x))
        return false;
    if (compare(x, EC_P) >= 0)
        return false;
    if ((prefix === 0x02 || prefix === 0x03) && value.length === 33) {
        return true;
    }
    if (value.length !== 65)
        return false;
    const y = value.subarray(33);
    if (isZero(y))
        return false;
    if (compare(y, EC_P) >= 0)
        return false;
    return prefix === 0x04 || prefix === 0x06 || prefix === 0x07;
}
export function isSatoshi(value) {
    return typeof value === 'bigint' && value >= 0n && value <= SATOSHI_MAX;
}
export function isPrivateKey(value) {
    if (!(value instanceof Uint8Array) || value.length !== 32)
        return false;
    if (isZero(value))
        return false;
    return compare(value, EC_N) < 0;
}
export function isSchnorrSignature(value) {
    return value instanceof Uint8Array && value.length === 64;
}
export function isSignature(value) {
    return value instanceof Uint8Array && value.length >= 8 && value.length <= 73;
}
export function isScript(value) {
    return value instanceof Uint8Array;
}
export function isTapleaf(value) {
    if (!value || typeof value !== 'object')
        return false;
    const obj = value;
    if (!('output' in obj))
        return false;
    if (!(obj['output'] instanceof Uint8Array))
        return false;
    if (obj['version'] !== undefined) {
        if (typeof obj['version'] !== 'number')
            return false;
        if ((obj['version'] & TAPLEAF_VERSION_MASK) !== obj['version'])
            return false;
    }
    return true;
}
export function isTaptree(value) {
    if (!Array.isArray(value))
        return isTapleaf(value);
    if (value.length !== 2)
        return false;
    return value.every((node) => isTaptree(node));
}
// Utility Functions
export function stacksEqual(a, b) {
    if (a.length !== b.length)
        return false;
    return a.every((x, i) => equals(x, b[i]));
}
export function toBytes32(value) {
    if (!isBytes32(value)) {
        throw new TypeError(`Expected 32-byte Uint8Array, got ${value.length} bytes`);
    }
    return value;
}
export function isMessageHash(value) {
    return value instanceof Uint8Array && value.length === 32;
}
export function toMessageHash(value) {
    if (!isMessageHash(value)) {
        throw new TypeError(`Expected 32-byte Uint8Array, got ${value.length} bytes`);
    }
    return value;
}
export function toBytes20(value) {
    if (!isBytes20(value)) {
        throw new TypeError(`Expected 20-byte Uint8Array, got ${value.length} bytes`);
    }
    return value;
}
export function toSatoshi(value) {
    if (value < 0n) {
        throw new RangeError(`Satoshi cannot be negative, got ${value}`);
    }
    if (value > SATOSHI_MAX) {
        throw new RangeError(`Satoshi exceeds maximum supply (${SATOSHI_MAX}), got ${value}`);
    }
    return value;
}
// Assertion Helpers
export function assertXOnlyPublicKey(value, name) {
    if (!(value instanceof Uint8Array)) {
        throw new TypeError(`${name} must be Uint8Array, got ${typeof value}`);
    }
    if (value.length !== 32) {
        throw new TypeError(`${name} must be 32 bytes, got ${value.length}`);
    }
    if (isZero(value)) {
        throw new RangeError(`${name} cannot be zero`);
    }
    if (compare(value, EC_P) >= 0) {
        throw new RangeError(`${name} exceeds curve order`);
    }
}
export function assertPrivateKey(value, name) {
    if (!(value instanceof Uint8Array)) {
        throw new TypeError(`${name} must be Uint8Array, got ${typeof value}`);
    }
    if (value.length !== 32) {
        throw new TypeError(`${name} must be 32 bytes, got ${value.length}`);
    }
    if (isZero(value)) {
        throw new RangeError(`${name} cannot be zero`);
    }
    if (compare(value, EC_N) >= 0) {
        throw new RangeError(`${name} exceeds curve order`);
    }
}
//# sourceMappingURL=types.js.map