import { mergeTransformer, PathTransformVisitor } from "./transformer.js";
import { decorates, isStdlib, not } from "./utils.js";
export function registerDecorator(decorator) {
    TopLevelDecorator.registerVisitor(decorator);
    return TopLevelDecorator;
}
export class TopLevelDecorator extends PathTransformVisitor {
    static _visitor;
    get visitor() {
        return TopLevelDecorator._visitor;
    }
    static registerVisitor(visitor) {
        TopLevelDecorator._visitor = visitor;
    }
    visitDecoratorNode(node) {
        if (this.visitor.decoratorMatcher(node)) {
            this.visitor.currentPath = this.currentParentPath;
            this.visitor.visit(this.currentParent);
        }
    }
    afterParse(_) {
        mergeTransformer(this, this.visitor);
        this.visit(this.program.sources.filter(this.visitor.sourceFilter));
    }
}
export class Decorator extends PathTransformVisitor {
    /**
     * Default filter that removes library files
     */
    get sourceFilter() {
        return not(isStdlib);
    }
    get decoratorMatcher() {
        return (node) => decorates(node, this.name);
    }
    get name() {
        return "";
    }
    getDecorator(node) {
        return node.decorators && node.decorators.find(this.decoratorMatcher) || null;
    }
}
export class ClassDecorator extends Decorator {
}
export class FunctionDecorator extends Decorator {
}
export class VariableDecorator extends Decorator {
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGVjb3JhdG9yLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL2RlY29yYXRvci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQVkxRSxPQUFPLEVBQUUsU0FBUyxFQUFFLFFBQVEsRUFBRSxHQUFHLEVBQUUsTUFBTSxZQUFZLENBQUM7QUFFdEQsTUFBTSxVQUFVLGlCQUFpQixDQUFDLFNBQTJCO0lBQ3pELGlCQUFpQixDQUFDLGVBQWUsQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUM3QyxPQUFPLGlCQUFpQixDQUFDO0FBQzdCLENBQUM7QUFPRCxNQUFNLE9BQU8saUJBQWtCLFNBQVEsb0JBQW9CO0lBQy9DLE1BQU0sQ0FBQyxRQUFRLENBQW1CO0lBRTFDLElBQVksT0FBTztRQUNmLE9BQU8saUJBQWlCLENBQUMsUUFBUSxDQUFDO0lBQ3RDLENBQUM7SUFFRCxNQUFNLENBQUMsZUFBZSxDQUFDLE9BQXlCO1FBQzVDLGlCQUFpQixDQUFDLFFBQVEsR0FBRyxPQUFPLENBQUM7SUFDekMsQ0FBQztJQUVELGtCQUFrQixDQUFDLElBQW1CO1FBQ2xDLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDO1lBQ3RDLElBQUksQ0FBQyxPQUFPLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxpQkFBaUIsQ0FBQztZQUNsRCxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUM7UUFDM0MsQ0FBQztJQUNMLENBQUM7SUFFRCxVQUFVLENBQUMsQ0FBUztRQUNoQixnQkFBZ0IsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ3JDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQztJQUN2RSxDQUFDO0NBRUo7QUFFRCxNQUFNLE9BQWdCLFNBQVUsU0FBUSxvQkFBb0I7SUFDeEQ7O09BRUc7SUFDSCxJQUFJLFlBQVk7UUFDWixPQUFPLEdBQUcsQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUN6QixDQUFDO0lBRUQsSUFBSSxnQkFBZ0I7UUFDaEIsT0FBTyxDQUFDLElBQW1CLEVBQUUsRUFBRSxDQUFDLFNBQVMsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFBO0lBQzlELENBQUM7SUFFRCxJQUFJLElBQUk7UUFDSixPQUFPLEVBQUUsQ0FBQztJQUNkLENBQUM7SUFFRCxZQUFZLENBQUMsSUFBMEI7UUFDbkMsT0FBTyxJQUFJLENBQUMsVUFBVSxJQUFJLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLElBQUksQ0FBQztJQUNsRixDQUFDO0NBQ0o7QUFFRCxNQUFNLE9BQWdCLGNBQWUsU0FBUSxTQUFTO0NBTXJEO0FBRUQsTUFBTSxPQUFnQixpQkFBa0IsU0FBUSxTQUFTO0NBRXhEO0FBRUQsTUFBTSxPQUFnQixpQkFBa0IsU0FBUSxTQUFTO0NBRXhEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgbWVyZ2VUcmFuc2Zvcm1lciwgUGF0aFRyYW5zZm9ybVZpc2l0b3IgfSBmcm9tIFwiLi90cmFuc2Zvcm1lci5qc1wiO1xyXG5pbXBvcnQge1xyXG4gICAgQ2xhc3NEZWNsYXJhdGlvbixcclxuICAgIERlY2xhcmF0aW9uU3RhdGVtZW50LFxyXG4gICAgRGVjb3JhdG9yTm9kZSxcclxuICAgIEZpZWxkRGVjbGFyYXRpb24sXHJcbiAgICBGdW5jdGlvbkRlY2xhcmF0aW9uLFxyXG4gICAgTWV0aG9kRGVjbGFyYXRpb24sXHJcbiAgICBQYXJzZXIsXHJcbiAgICBTb3VyY2UsXHJcbiAgICBWYXJpYWJsZURlY2xhcmF0aW9uLFxyXG59IGZyb20gXCJAYnRjLXZpc2lvbi9hc3NlbWJseXNjcmlwdC9kaXN0L2Fzc2VtYmx5c2NyaXB0LmpzXCI7XHJcbmltcG9ydCB7IGRlY29yYXRlcywgaXNTdGRsaWIsIG5vdCB9IGZyb20gXCIuL3V0aWxzLmpzXCI7XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gcmVnaXN0ZXJEZWNvcmF0b3IoZGVjb3JhdG9yOiBEZWNvcmF0b3JWaXNpdG9yKSB7XHJcbiAgICBUb3BMZXZlbERlY29yYXRvci5yZWdpc3RlclZpc2l0b3IoZGVjb3JhdG9yKTtcclxuICAgIHJldHVybiBUb3BMZXZlbERlY29yYXRvcjtcclxufVxyXG5cclxuaW50ZXJmYWNlIERlY29yYXRvclZpc2l0b3IgZXh0ZW5kcyBQYXRoVHJhbnNmb3JtVmlzaXRvciB7XHJcbiAgICBkZWNvcmF0b3JNYXRjaGVyOiAobm9kZTogRGVjb3JhdG9yTm9kZSkgPT4gYm9vbGVhbjtcclxuICAgIHNvdXJjZUZpbHRlcjogKHM6IFNvdXJjZSkgPT4gYm9vbDtcclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIFRvcExldmVsRGVjb3JhdG9yIGV4dGVuZHMgUGF0aFRyYW5zZm9ybVZpc2l0b3Ige1xyXG4gICAgcHJpdmF0ZSBzdGF0aWMgX3Zpc2l0b3I6IERlY29yYXRvclZpc2l0b3I7XHJcblxyXG4gICAgcHJpdmF0ZSBnZXQgdmlzaXRvcigpOiBEZWNvcmF0b3JWaXNpdG9yIHtcclxuICAgICAgICByZXR1cm4gVG9wTGV2ZWxEZWNvcmF0b3IuX3Zpc2l0b3I7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIHJlZ2lzdGVyVmlzaXRvcih2aXNpdG9yOiBEZWNvcmF0b3JWaXNpdG9yKTogdm9pZCB7XHJcbiAgICAgICAgVG9wTGV2ZWxEZWNvcmF0b3IuX3Zpc2l0b3IgPSB2aXNpdG9yO1xyXG4gICAgfVxyXG5cclxuICAgIHZpc2l0RGVjb3JhdG9yTm9kZShub2RlOiBEZWNvcmF0b3JOb2RlKSB7XHJcbiAgICAgICAgaWYgKHRoaXMudmlzaXRvci5kZWNvcmF0b3JNYXRjaGVyKG5vZGUpKSB7XHJcbiAgICAgICAgICAgIHRoaXMudmlzaXRvci5jdXJyZW50UGF0aCA9IHRoaXMuY3VycmVudFBhcmVudFBhdGg7XHJcbiAgICAgICAgICAgIHRoaXMudmlzaXRvci52aXNpdCh0aGlzLmN1cnJlbnRQYXJlbnQpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBhZnRlclBhcnNlKF86IFBhcnNlcik6IHZvaWQge1xyXG4gICAgICAgIG1lcmdlVHJhbnNmb3JtZXIodGhpcywgdGhpcy52aXNpdG9yKTtcclxuICAgICAgICB0aGlzLnZpc2l0KHRoaXMucHJvZ3JhbS5zb3VyY2VzLmZpbHRlcih0aGlzLnZpc2l0b3Iuc291cmNlRmlsdGVyKSk7XHJcbiAgICB9XHJcblxyXG59XHJcblxyXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgRGVjb3JhdG9yIGV4dGVuZHMgUGF0aFRyYW5zZm9ybVZpc2l0b3Ige1xyXG4gICAgLyoqXHJcbiAgICAgKiBEZWZhdWx0IGZpbHRlciB0aGF0IHJlbW92ZXMgbGlicmFyeSBmaWxlc1xyXG4gICAgICovXHJcbiAgICBnZXQgc291cmNlRmlsdGVyKCk6IChzOiBTb3VyY2UpID0+IGJvb2wge1xyXG4gICAgICAgIHJldHVybiBub3QoaXNTdGRsaWIpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBkZWNvcmF0b3JNYXRjaGVyKCk6IChub2RlOiBEZWNvcmF0b3JOb2RlKSA9PiBib29sZWFuIHtcclxuICAgICAgICByZXR1cm4gKG5vZGU6IERlY29yYXRvck5vZGUpID0+IGRlY29yYXRlcyhub2RlLCB0aGlzLm5hbWUpXHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IG5hbWUoKTogc3RyaW5nIHtcclxuICAgICAgICByZXR1cm4gXCJcIjtcclxuICAgIH1cclxuXHJcbiAgICBnZXREZWNvcmF0b3Iobm9kZTogRGVjbGFyYXRpb25TdGF0ZW1lbnQpOiBEZWNvcmF0b3JOb2RlIHwgbnVsbCB7XHJcbiAgICAgICAgcmV0dXJuIG5vZGUuZGVjb3JhdG9ycyAmJiBub2RlLmRlY29yYXRvcnMuZmluZCh0aGlzLmRlY29yYXRvck1hdGNoZXIpIHx8IG51bGw7XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBDbGFzc0RlY29yYXRvciBleHRlbmRzIERlY29yYXRvciB7XHJcbiAgICBhYnN0cmFjdCB2aXNpdEZpZWxkRGVjbGFyYXRpb24obm9kZTogRmllbGREZWNsYXJhdGlvbik6IHZvaWQ7XHJcblxyXG4gICAgYWJzdHJhY3QgdmlzaXRNZXRob2REZWNsYXJhdGlvbihub2RlOiBNZXRob2REZWNsYXJhdGlvbik6IHZvaWQ7XHJcblxyXG4gICAgYWJzdHJhY3QgdmlzaXRDbGFzc0RlY2xhcmF0aW9uKG5vZGU6IENsYXNzRGVjbGFyYXRpb24pOiB2b2lkO1xyXG59XHJcblxyXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgRnVuY3Rpb25EZWNvcmF0b3IgZXh0ZW5kcyBEZWNvcmF0b3Ige1xyXG4gICAgYWJzdHJhY3QgdmlzaXRGdW5jdGlvbkRlY2xhcmF0aW9uKG5vZGU6IEZ1bmN0aW9uRGVjbGFyYXRpb24pOiB2b2lkO1xyXG59XHJcblxyXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgVmFyaWFibGVEZWNvcmF0b3IgZXh0ZW5kcyBEZWNvcmF0b3Ige1xyXG4gICAgYWJzdHJhY3QgdmlzaXRWYXJpYWJsZURlY2xhcmF0aW9uKG5vZGU6IFZhcmlhYmxlRGVjbGFyYXRpb24pOiB2b2lkO1xyXG59XHJcbiJdfQ==