import { ASTTransformVisitor } from "../index.js";
import { SimpleParser } from "../simpleParser.js";
import { getName, isMethodNamed, isStdlib, not } from '../utils.js';
class ToStringCallTransform extends ASTTransformVisitor {
    currentClass;
    fields;
    visitFieldDeclaration(node) {
        const name = getName(node);
        let rhs = `this.${name}.toString()`;
        this.fields.push(`sb.push(\`${name}: \${${rhs}}\`)`);
        super.visitFieldDeclaration(node);
    }
    visitClassDeclaration(node) {
        if (!node.members || node.members.some(isMethodNamed("toString"))) {
            super.visitClassDeclaration(node);
            return;
        }
        this.currentClass = node;
        this.fields = [];
        this.visit(node.members); // will visit fields and methods
        const method = `
  toString(): string {
    const sb = new Array<string>();
    ${this.fields.join(";\n\t")};
    return \`${getName(node)}:\\n\\t\${sb.join("\\n\\t")}\`
  }
    `;
        let member = SimpleParser.parseClassMember(method, node);
        node.members.push(member);
        super.visitClassDeclaration(node);
    }
    afterParse(_) {
        let sources = _.sources.filter(not(isStdlib));
        this.visit(sources);
    }
}
export default ToStringCallTransform;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG9TdHJpbmcuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvZXhhbXBsZXMvdG9TdHJpbmcudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sYUFBYSxDQUFDO0FBRWxELE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUNsRCxPQUFPLEVBQUUsT0FBTyxFQUFFLGFBQWEsRUFBRSxRQUFRLEVBQUUsR0FBRyxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBR3BFLE1BQU0scUJBQXNCLFNBQVEsbUJBQW1CO0lBQ25ELFlBQVksQ0FBb0I7SUFDaEMsTUFBTSxDQUFZO0lBRWxCLHFCQUFxQixDQUFDLElBQXNCO1FBQ3hDLE1BQU0sSUFBSSxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUMzQixJQUFJLEdBQUcsR0FBRyxRQUFRLElBQUksYUFBYSxDQUFDO1FBQ3BDLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLGFBQWEsSUFBSSxRQUFRLEdBQUcsTUFBTSxDQUFDLENBQUM7UUFDckQsS0FBSyxDQUFDLHFCQUFxQixDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ3RDLENBQUM7SUFHRCxxQkFBcUIsQ0FBQyxJQUFzQjtRQUN4QyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsVUFBVSxDQUFDLENBQUMsRUFBRSxDQUFDO1lBQ2hFLEtBQUssQ0FBQyxxQkFBcUIsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNsQyxPQUFPO1FBQ1gsQ0FBQztRQUVELElBQUksQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDO1FBQ3pCLElBQUksQ0FBQyxNQUFNLEdBQUcsRUFBRSxDQUFDO1FBQ2pCLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsZ0NBQWdDO1FBQzFELE1BQU0sTUFBTSxHQUFHOzs7TUFHakIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDO2VBQ2hCLE9BQU8sQ0FBQyxJQUFJLENBQUM7O0tBRXZCLENBQUE7UUFDRyxJQUFJLE1BQU0sR0FBRyxZQUFZLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxDQUFDO1FBQ3pELElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQzFCLEtBQUssQ0FBQyxxQkFBcUIsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUN0QyxDQUFDO0lBRUQsVUFBVSxDQUFDLENBQVM7UUFDaEIsSUFBSSxPQUFPLEdBQUcsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7UUFDOUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUN4QixDQUFDO0NBRUo7QUFHRCxlQUFlLHFCQUFxQixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQVNUVHJhbnNmb3JtVmlzaXRvciB9IGZyb20gXCIuLi9pbmRleC5qc1wiO1xyXG5pbXBvcnQgeyBDbGFzc0RlY2xhcmF0aW9uLCBGaWVsZERlY2xhcmF0aW9uLCBQYXJzZXIgfSBmcm9tIFwiQGJ0Yy12aXNpb24vYXNzZW1ibHlzY3JpcHQvZGlzdC9hc3NlbWJseXNjcmlwdC5qc1wiO1xyXG5pbXBvcnQgeyBTaW1wbGVQYXJzZXIgfSBmcm9tIFwiLi4vc2ltcGxlUGFyc2VyLmpzXCI7XHJcbmltcG9ydCB7IGdldE5hbWUsIGlzTWV0aG9kTmFtZWQsIGlzU3RkbGliLCBub3QgfSBmcm9tICcuLi91dGlscy5qcyc7XHJcblxyXG5cclxuY2xhc3MgVG9TdHJpbmdDYWxsVHJhbnNmb3JtIGV4dGVuZHMgQVNUVHJhbnNmb3JtVmlzaXRvciB7XHJcbiAgICBjdXJyZW50Q2xhc3M/OiBDbGFzc0RlY2xhcmF0aW9uO1xyXG4gICAgZmllbGRzITogc3RyaW5nW107XHJcblxyXG4gICAgdmlzaXRGaWVsZERlY2xhcmF0aW9uKG5vZGU6IEZpZWxkRGVjbGFyYXRpb24pOiB2b2lkIHtcclxuICAgICAgICBjb25zdCBuYW1lID0gZ2V0TmFtZShub2RlKTtcclxuICAgICAgICBsZXQgcmhzID0gYHRoaXMuJHtuYW1lfS50b1N0cmluZygpYDtcclxuICAgICAgICB0aGlzLmZpZWxkcy5wdXNoKGBzYi5wdXNoKFxcYCR7bmFtZX06IFxcJHske3Joc319XFxgKWApO1xyXG4gICAgICAgIHN1cGVyLnZpc2l0RmllbGREZWNsYXJhdGlvbihub2RlKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgdmlzaXRDbGFzc0RlY2xhcmF0aW9uKG5vZGU6IENsYXNzRGVjbGFyYXRpb24pOiB2b2lkIHtcclxuICAgICAgICBpZiAoIW5vZGUubWVtYmVycyB8fCBub2RlLm1lbWJlcnMuc29tZShpc01ldGhvZE5hbWVkKFwidG9TdHJpbmdcIikpKSB7XHJcbiAgICAgICAgICAgIHN1cGVyLnZpc2l0Q2xhc3NEZWNsYXJhdGlvbihub2RlKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5jdXJyZW50Q2xhc3MgPSBub2RlO1xyXG4gICAgICAgIHRoaXMuZmllbGRzID0gW107XHJcbiAgICAgICAgdGhpcy52aXNpdChub2RlLm1lbWJlcnMpOyAvLyB3aWxsIHZpc2l0IGZpZWxkcyBhbmQgbWV0aG9kc1xyXG4gICAgICAgIGNvbnN0IG1ldGhvZCA9IGBcclxuICB0b1N0cmluZygpOiBzdHJpbmcge1xyXG4gICAgY29uc3Qgc2IgPSBuZXcgQXJyYXk8c3RyaW5nPigpO1xyXG4gICAgJHt0aGlzLmZpZWxkcy5qb2luKFwiO1xcblxcdFwiKX07XHJcbiAgICByZXR1cm4gXFxgJHtnZXROYW1lKG5vZGUpfTpcXFxcblxcXFx0XFwke3NiLmpvaW4oXCJcXFxcblxcXFx0XCIpfVxcYFxyXG4gIH1cclxuICAgIGBcclxuICAgICAgICBsZXQgbWVtYmVyID0gU2ltcGxlUGFyc2VyLnBhcnNlQ2xhc3NNZW1iZXIobWV0aG9kLCBub2RlKTtcclxuICAgICAgICBub2RlLm1lbWJlcnMucHVzaChtZW1iZXIpO1xyXG4gICAgICAgIHN1cGVyLnZpc2l0Q2xhc3NEZWNsYXJhdGlvbihub2RlKTtcclxuICAgIH1cclxuXHJcbiAgICBhZnRlclBhcnNlKF86IFBhcnNlcik6IHZvaWQge1xyXG4gICAgICAgIGxldCBzb3VyY2VzID0gXy5zb3VyY2VzLmZpbHRlcihub3QoaXNTdGRsaWIpKTtcclxuICAgICAgICB0aGlzLnZpc2l0KHNvdXJjZXMpO1xyXG4gICAgfVxyXG5cclxufVxyXG5cclxuXHJcbmV4cG9ydCBkZWZhdWx0IFRvU3RyaW5nQ2FsbFRyYW5zZm9ybTtcclxuIl19