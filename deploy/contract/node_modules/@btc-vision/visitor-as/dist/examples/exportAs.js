import { Transform } from "@btc-vision/assemblyscript/dist/transform.js";
import { getDecorator, hasDecorator, isLibrary, isUserEntry } from "../utils.js";
function getName(element) {
    let decorator = getDecorator(element.declaration, "exportAs");
    if (decorator.args == null) {
        throw Error("exportAs expects a string argument but got null.");
    }
    if (decorator.args.length != 1) {
        throw Error(`exportAs expects 1 argument but got ${decorator.args.length}`);
    }
    if (!decorator.args[0].isLiteralKind(2 /* LiteralKind.String */)) {
        throw Error("exportAs expects a string argument");
    }
    return decorator.args[0].value;
}
class Transformer extends Transform {
    afterInitialize(program) {
        let files = Array.from(program.filesByName.values()).filter((file) => isUserEntry(file.source) && !isLibrary(file.source));
        for (let file of files) {
            for (let _export of file.exports?.values() || []) {
                if (_export != null && hasDecorator(_export, "exportAs")) {
                    let newName = getName(_export);
                    file.exports?.delete(_export.name);
                    file.exports?.set(newName, _export);
                }
            }
        }
    }
}
export default Transformer;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXhwb3J0QXMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvZXhhbXBsZXMvZXhwb3J0QXMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBTUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLDhDQUE4QyxDQUFDO0FBQ3pFLE9BQU8sRUFBRSxZQUFZLEVBQUUsWUFBWSxFQUFFLFNBQVMsRUFBRSxXQUFXLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFFakYsU0FBUyxPQUFPLENBQUMsT0FBd0I7SUFDckMsSUFBSSxTQUFTLEdBQUcsWUFBWSxDQUFDLE9BQU8sQ0FBQyxXQUFXLEVBQUUsVUFBVSxDQUFDLENBQUM7SUFDOUQsSUFBSSxTQUFTLENBQUMsSUFBSSxJQUFJLElBQUksRUFBRSxDQUFDO1FBQ3pCLE1BQU0sS0FBSyxDQUFDLGtEQUFrRCxDQUFDLENBQUM7SUFDcEUsQ0FBQztJQUNELElBQUksU0FBUyxDQUFDLElBQUksQ0FBQyxNQUFNLElBQUksQ0FBQyxFQUFFLENBQUM7UUFDN0IsTUFBTSxLQUFLLENBQUMsdUNBQXVDLFNBQVMsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQztJQUNoRixDQUFDO0lBQ0QsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsYUFBYSw0QkFBb0IsRUFBRSxDQUFDO1FBQ3ZELE1BQU0sS0FBSyxDQUFDLG9DQUFvQyxDQUFDLENBQUM7SUFDdEQsQ0FBQztJQUNELE9BQWlDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFFLENBQUMsS0FBSyxDQUFDO0FBQzlELENBQUM7QUFFRCxNQUFNLFdBQVksU0FBUSxTQUFTO0lBQy9CLGVBQWUsQ0FBQyxPQUFnQjtRQUM1QixJQUFJLEtBQUssR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxXQUFXLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQ3ZELENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FDaEUsQ0FBQztRQUNGLEtBQUssSUFBSSxJQUFJLElBQUksS0FBSyxFQUFFLENBQUM7WUFDckIsS0FBSyxJQUFJLE9BQU8sSUFBSSxJQUFJLENBQUMsT0FBTyxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsRUFBRSxDQUFDO2dCQUMvQyxJQUFJLE9BQU8sSUFBSSxJQUFJLElBQUksWUFBWSxDQUFDLE9BQU8sRUFBRSxVQUFVLENBQUMsRUFBRSxDQUFDO29CQUN2RCxJQUFJLE9BQU8sR0FBRyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUM7b0JBQy9CLElBQUksQ0FBQyxPQUFPLEVBQUUsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztvQkFDbkMsSUFBSSxDQUFDLE9BQU8sRUFBRSxHQUFHLENBQUMsT0FBTyxFQUFFLE9BQU8sQ0FBQyxDQUFDO2dCQUN4QyxDQUFDO1lBQ0wsQ0FBQztRQUNMLENBQUM7SUFDTCxDQUFDO0NBQ0o7QUFFRCxlQUFlLFdBQVcsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XHJcbiAgICBEZWNsYXJlZEVsZW1lbnQsXHJcbiAgICBMaXRlcmFsS2luZCxcclxuICAgIFByb2dyYW0sXHJcbiAgICBTdHJpbmdMaXRlcmFsRXhwcmVzc2lvbixcclxufSBmcm9tIFwiQGJ0Yy12aXNpb24vYXNzZW1ibHlzY3JpcHQvZGlzdC9hc3NlbWJseXNjcmlwdC5qc1wiO1xyXG5pbXBvcnQgeyBUcmFuc2Zvcm0gfSBmcm9tIFwiQGJ0Yy12aXNpb24vYXNzZW1ibHlzY3JpcHQvZGlzdC90cmFuc2Zvcm0uanNcIjtcclxuaW1wb3J0IHsgZ2V0RGVjb3JhdG9yLCBoYXNEZWNvcmF0b3IsIGlzTGlicmFyeSwgaXNVc2VyRW50cnkgfSBmcm9tIFwiLi4vdXRpbHMuanNcIjtcclxuXHJcbmZ1bmN0aW9uIGdldE5hbWUoZWxlbWVudDogRGVjbGFyZWRFbGVtZW50KTogc3RyaW5nIHtcclxuICAgIGxldCBkZWNvcmF0b3IgPSBnZXREZWNvcmF0b3IoZWxlbWVudC5kZWNsYXJhdGlvbiwgXCJleHBvcnRBc1wiKTtcclxuICAgIGlmIChkZWNvcmF0b3IuYXJncyA9PSBudWxsKSB7XHJcbiAgICAgICAgdGhyb3cgRXJyb3IoXCJleHBvcnRBcyBleHBlY3RzIGEgc3RyaW5nIGFyZ3VtZW50IGJ1dCBnb3QgbnVsbC5cIik7XHJcbiAgICB9XHJcbiAgICBpZiAoZGVjb3JhdG9yLmFyZ3MubGVuZ3RoICE9IDEpIHtcclxuICAgICAgICB0aHJvdyBFcnJvcihgZXhwb3J0QXMgZXhwZWN0cyAxIGFyZ3VtZW50IGJ1dCBnb3QgJHtkZWNvcmF0b3IuYXJncy5sZW5ndGh9YCk7XHJcbiAgICB9XHJcbiAgICBpZiAoIWRlY29yYXRvci5hcmdzWzBdLmlzTGl0ZXJhbEtpbmQoTGl0ZXJhbEtpbmQuU3RyaW5nKSkge1xyXG4gICAgICAgIHRocm93IEVycm9yKFwiZXhwb3J0QXMgZXhwZWN0cyBhIHN0cmluZyBhcmd1bWVudFwiKTtcclxuICAgIH1cclxuICAgIHJldHVybiAoPFN0cmluZ0xpdGVyYWxFeHByZXNzaW9uPmRlY29yYXRvci5hcmdzWzBdKS52YWx1ZTtcclxufVxyXG5cclxuY2xhc3MgVHJhbnNmb3JtZXIgZXh0ZW5kcyBUcmFuc2Zvcm0ge1xyXG4gICAgYWZ0ZXJJbml0aWFsaXplKHByb2dyYW06IFByb2dyYW0pOiB2b2lkIHtcclxuICAgICAgICBsZXQgZmlsZXMgPSBBcnJheS5mcm9tKHByb2dyYW0uZmlsZXNCeU5hbWUudmFsdWVzKCkpLmZpbHRlcihcclxuICAgICAgICAgICAgKGZpbGUpID0+IGlzVXNlckVudHJ5KGZpbGUuc291cmNlKSAmJiAhaXNMaWJyYXJ5KGZpbGUuc291cmNlKVxyXG4gICAgICAgICk7XHJcbiAgICAgICAgZm9yIChsZXQgZmlsZSBvZiBmaWxlcykge1xyXG4gICAgICAgICAgICBmb3IgKGxldCBfZXhwb3J0IG9mIGZpbGUuZXhwb3J0cz8udmFsdWVzKCkgfHwgW10pIHtcclxuICAgICAgICAgICAgICAgIGlmIChfZXhwb3J0ICE9IG51bGwgJiYgaGFzRGVjb3JhdG9yKF9leHBvcnQsIFwiZXhwb3J0QXNcIikpIHtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgbmV3TmFtZSA9IGdldE5hbWUoX2V4cG9ydCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZmlsZS5leHBvcnRzPy5kZWxldGUoX2V4cG9ydC5uYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICBmaWxlLmV4cG9ydHM/LnNldChuZXdOYW1lLCBfZXhwb3J0KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgVHJhbnNmb3JtZXI7XHJcbiJdfQ==