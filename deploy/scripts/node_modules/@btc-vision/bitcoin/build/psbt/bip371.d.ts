import type { PsbtInput, PsbtOutput, TapLeaf } from 'bip174';
import type { Taptree } from '../types.js';
interface PsbtOutputWithScript extends PsbtOutput {
    script?: Uint8Array;
}
/**
 * Default tapscript finalizer. It searches for the `tapLeafHashToFinalize` if provided.
 * Otherwise it will search for the tapleaf that has at least one signature and has the shortest path.
 * @param inputIndex the position of the PSBT input.
 * @param input the PSBT input.
 * @param tapLeafHashToFinalize optional, if provided the finalizer will search for a tapleaf that has this hash
 *                              and will try to build the finalScriptWitness.
 * @returns the finalScriptWitness or throws an exception if no tapleaf found.
 */
export declare function tapScriptFinalizer(inputIndex: number, input: PsbtInput, tapLeafHashToFinalize?: Uint8Array): {
    finalScriptWitness: Uint8Array | undefined;
};
/**
 * Serializes a taproot (Schnorr) signature, optionally appending the sighash type byte.
 * If sighashType is SIGHASH_DEFAULT (0x00) or not provided, no byte is appended (per BIP 341).
 * Used for both P2TR key-path/script-path and P2MR script-path signatures.
 * @param sig - The 64-byte Schnorr signature.
 * @param sighashType - Optional sighash type. Omit or pass 0 for SIGHASH_DEFAULT.
 * @returns The serialized signature (64 or 65 bytes).
 */
export declare function serializeTaprootSignature(sig: Uint8Array, sighashType?: number): Uint8Array;
/**
 * Determines whether a PSBT input should be handled as a taproot-style input.
 * Returns true for both P2TR (SegWit v1, BIP 341) and P2MR (SegWit v2, BIP 360) inputs.
 * This is the gateway check that routes inputs to taproot signing and finalization logic.
 * @param input - The PSBT input to check.
 * @returns True if the input has taproot/P2MR fields or a P2TR/P2MR witnessUtxo script.
 */
export declare function isTaprootInput(input: PsbtInput): boolean;
/**
 * Checks if the input is spending a P2MR (Pay-to-Merkle-Root, BIP 360) output.
 * Requires `witnessUtxo` to be set on the input; returns false otherwise.
 * P2MR uses SegWit version 2 with scriptPubKey: `OP_2 <32-byte merkle_root>`.
 * @param input - The PSBT input to check.
 * @returns True if the witnessUtxo script is a valid P2MR output.
 */
export declare function isP2MRInput(input: PsbtInput): boolean;
/**
 * Determines whether a PSBT output should be handled as a taproot-style output.
 * Returns true for both P2TR (BIP 341) and P2MR (BIP 360) outputs.
 * @param output - The PSBT output to check.
 * @param script - Optional output script to test against P2TR/P2MR patterns.
 * @returns True if the output has taproot fields or a P2TR/P2MR script.
 */
export declare function isTaprootOutput(output: PsbtOutput, script?: Uint8Array): boolean;
export declare function checkTaprootInputFields(inputData: PsbtInput, newInputData: PsbtInput, action: string): void;
export declare function checkTaprootOutputFields(outputData: PsbtOutputWithScript, newOutputData: PsbtOutput, action: string): void;
export declare function tweakInternalPubKey(inputIndex: number, input: PsbtInput): Uint8Array;
/**
 * Convert a binary tree to a BIP371 type list. Each element of the list is (according to BIP371):
 * One or more tuples representing the depth, leaf version, and script for a leaf in the Taproot tree,
 * allowing the entire tree to be reconstructed. The tuples must be in depth first search order so that
 * the tree is correctly reconstructed.
 * @param tree the binary tap tree
 * @returns a list of BIP 371 tapleaves
 */
export declare function tapTreeToList(tree: Taptree): TapLeaf[];
/**
 * Convert a BIP371 TapLeaf list to a TapTree (binary).
 * @param leaves a list of tapleaves where each element of the list is (according to BIP371):
 * One or more tuples representing the depth, leaf version, and script for a leaf in the Taproot tree,
 * allowing the entire tree to be reconstructed. The tuples must be in depth first search order so that
 * the tree is correctly reconstructed.
 * @returns the corresponding taptree, or throws an exception if the tree cannot be reconstructed
 */
export declare function tapTreeFromList(leaves?: TapLeaf[]): Taptree;
export declare function checkTaprootInputForSigs(input: PsbtInput, action: string): boolean;
export declare function getTapKeySigFromWitness(finalScriptWitness?: Uint8Array): Uint8Array | undefined;
export {};
//# sourceMappingURL=bip371.d.ts.map