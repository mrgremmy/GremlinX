const Ot={messagePrefix:`Bitcoin Signed Message:
`,bech32:"bc",bech32Opnet:"op",bip32:{public:76067358,private:76066276},pubKeyHash:0,scriptHash:5,wif:128},Gi={messagePrefix:`Bitcoin Signed Message:
`,bech32:"bcrt",bech32Opnet:"opr",bip32:{public:70617039,private:70615956},pubKeyHash:111,scriptHash:196,wif:239},ji={messagePrefix:`Bitcoin Signed Message:
`,bech32:"tb",bech32Opnet:"opt",bip32:{public:70617039,private:70615956},pubKeyHash:111,scriptHash:196,wif:239},qi={messagePrefix:`Bitcoin Signed Message:
`,bech32:"opt",bech32Opnet:"opt",bip32:{public:70617039,private:70615956},pubKeyHash:111,scriptHash:196,wif:239},Yi={messagePrefix:`Dogecoin Signed Message:
`,bech32:"",bech32Opnet:"",bip32:{public:49990397,private:49988504},pubKeyHash:30,scriptHash:22,wif:158},Wi={messagePrefix:`Dogecoin Signed Message:
`,bech32:"",bech32Opnet:"",bip32:{public:70429096,private:70427203},pubKeyHash:113,scriptHash:196,wif:241},Zi={messagePrefix:`Litecoin Signed Message:
`,bech32:"ltc",bech32Opnet:"opl",bip32:{public:27108450,private:27106558},pubKeyHash:48,scriptHash:50,wif:176},Xi={messagePrefix:`Litecoin Signed Message:
`,bech32:"tltc",bech32Opnet:"oplt",bip32:{public:70709117,private:70711009},pubKeyHash:111,scriptHash:58,wif:239},zi={messagePrefix:`Bitcoin Signed Message:
`,bech32:"bitcoincash",bech32Opnet:"opbch",bip32:{public:76067358,private:76066276},pubKeyHash:0,scriptHash:5,wif:128},Qi={messagePrefix:`Bitcoin Signed Message:
`,bech32:"bchtest",bech32Opnet:"opbcht",bip32:{public:70617039,private:70615956},pubKeyHash:111,scriptHash:196,wif:239},Ji={messagePrefix:`DarkCoin Signed Message:
`,bech32:"",bech32Opnet:"",bip32:{public:50221772,private:50221816},pubKeyHash:76,scriptHash:16,wif:204},ts={messagePrefix:`DarkCoin Signed Message:
`,bech32:"",bech32Opnet:"",bip32:{public:981492128,private:981489719},pubKeyHash:140,scriptHash:19,wif:239},Rh=Object.freeze(Object.defineProperty({__proto__:null,bitcoin:Ot,bitcoinCash:zi,bitcoinCashTestnet:Qi,dash:Ji,dashTestnet:ts,dogecoin:Yi,dogecoinTestnet:Wi,litecoin:Zi,litecoinTestnet:Xi,opnetTestnet:qi,regtest:Gi,testnet:ji},Symbol.toStringTag,{value:"Module"}));var jt={},jr;function es(){if(jr)return jt;jr=1,Object.defineProperty(jt,"__esModule",{value:!0}),jt.bech32m=jt.bech32=void 0;const e="qpzry9x8gf2tvdw0s3jn54khce6mua7l",t={};for(let l=0;l<e.length;l++){const a=e.charAt(l);t[a]=l}function r(l){const a=l>>25;return(l&33554431)<<5^-(a>>0&1)&996825010^-(a>>1&1)&642813549^-(a>>2&1)&513874426^-(a>>3&1)&1027748829^-(a>>4&1)&705979059}function n(l){let a=1;for(let w=0;w<l.length;++w){const m=l.charCodeAt(w);if(m<33||m>126)return"Invalid prefix ("+l+")";a=r(a)^m>>5}a=r(a);for(let w=0;w<l.length;++w){const m=l.charCodeAt(w);a=r(a)^m&31}return a}function o(l,a,w,m){let g=0,v=0;const E=(1<<w)-1,T=[];for(let U=0;U<l.length;++U)for(g=g<<a|l[U],v+=a;v>=w;)v-=w,T.push(g>>v&E);if(m)v>0&&T.push(g<<w-v&E);else{if(v>=a)return"Excess padding";if(g<<w-v&E)return"Non-zero padding"}return T}function f(l){return o(l,8,5,!0)}function u(l){const a=o(l,5,8,!1);if(Array.isArray(a))return a}function c(l){const a=o(l,5,8,!1);if(Array.isArray(a))return a;throw new Error(a)}function p(l){let a;l==="bech32"?a=1:a=734539939;function w(E,T,U){if(U=U||90,E.length+7+T.length>U)throw new TypeError("Exceeds length limit");E=E.toLowerCase();let k=n(E);if(typeof k=="string")throw new Error(k);let R=E+"1";for(let N=0;N<T.length;++N){const $=T[N];if($>>5!==0)throw new Error("Non 5-bit word");k=r(k)^$,R+=e.charAt($)}for(let N=0;N<6;++N)k=r(k);k^=a;for(let N=0;N<6;++N){const $=k>>(5-N)*5&31;R+=e.charAt($)}return R}function m(E,T){if(T=T||90,E.length<8)return E+" too short";if(E.length>T)return"Exceeds length limit";const U=E.toLowerCase(),k=E.toUpperCase();if(E!==U&&E!==k)return"Mixed-case string "+E;E=U;const R=E.lastIndexOf("1");if(R===-1)return"No separator character for "+E;if(R===0)return"Missing prefix for "+E;const N=E.slice(0,R),$=E.slice(R+1);if($.length<6)return"Data too short";let J=n(N);if(typeof J=="string")return J;const Lt=[];for(let st=0;st<$.length;++st){const G=$.charAt(st),mt=t[G];if(mt===void 0)return"Unknown character "+G;J=r(J)^mt,!(st+6>=$.length)&&Lt.push(mt)}return J!==a?"Invalid checksum for "+E:{prefix:N,words:Lt}}function g(E,T){const U=m(E,T);if(typeof U=="object")return U}function v(E,T){const U=m(E,T);if(typeof U=="object")return U;throw new Error(U)}return{decodeUnsafe:g,decode:v,encode:w,toWords:f,fromWordsUnsafe:u,fromWords:c}}return jt.bech32=p("bech32"),jt.bech32m=p("bech32m"),jt}var ut=es();function Br(e){let t,r;try{t=ut.bech32.decode(e)}catch{}if(t){if(r=t.words[0],r!==0)throw new TypeError(e+" uses wrong encoding")}else if(t=ut.bech32m.decode(e),r=t.words[0],r===0)throw new TypeError(e+" uses wrong encoding");const n=ut.bech32.fromWords(t.words.slice(1));return{version:r,prefix:t.prefix,data:new Uint8Array(n)}}const Sn="0123456789abcdefABCDEF";Sn.split("").map(e=>e.codePointAt(0));Array(256).fill(!0).map((e,t)=>{const r=String.fromCodePoint(t),n=Sn.indexOf(r);return n<0?void 0:n<16?n:n-6});new TextEncoder;new TextDecoder;function rs(e,t,r,n){if(t+2>e.length)throw new Error("Offset is outside the bounds of Uint8Array");if(n=n.toUpperCase(),r>65535)throw new Error(`The value of "value" is out of range. It must be >= 0 and <= 65535. Received ${r}`);n==="LE"?(e[t]=r&255,e[t+1]=r>>8&255):(e[t]=r>>8&255,e[t+1]=r&255)}function ns(e,t,r,n){if(t+4>e.length)throw new Error("Offset is outside the bounds of Uint8Array");if(n=n.toUpperCase(),r>4294967295)throw new Error(`The value of "value" is out of range. It must be >= 0 and <= ${4294967295}. Received ${r}`);n==="LE"?(e[t]=r&255,e[t+1]=r>>8&255,e[t+2]=r>>16&255,e[t+3]=r>>24&255):(e[t]=r>>24&255,e[t+1]=r>>16&255,e[t+2]=r>>8&255,e[t+3]=r&255)}function is(e,t,r,n){if(t+8>e.length)throw new Error("Offset is outside the bounds of Uint8Array");if(n=n.toUpperCase(),r>0xffffffffffffffffn)throw new Error(`The value of "value" is out of range. It must be >= 0 and <= ${0xffffffffffffffffn}. Received ${r}`);n==="LE"?(e[t]=Number(r&0xffn),e[t+1]=Number(r>>8n&0xffn),e[t+2]=Number(r>>16n&0xffn),e[t+3]=Number(r>>24n&0xffn),e[t+4]=Number(r>>32n&0xffn),e[t+5]=Number(r>>40n&0xffn),e[t+6]=Number(r>>48n&0xffn),e[t+7]=Number(r>>56n&0xffn)):(e[t]=Number(r>>56n&0xffn),e[t+1]=Number(r>>48n&0xffn),e[t+2]=Number(r>>40n&0xffn),e[t+3]=Number(r>>32n&0xffn),e[t+4]=Number(r>>24n&0xffn),e[t+5]=Number(r>>16n&0xffn),e[t+6]=Number(r>>8n&0xffn),e[t+7]=Number(r&0xffn))}function ss(e,t,r){if(t+2>e.length)throw new Error("Offset is outside the bounds of Uint8Array");if(r=r.toUpperCase(),r==="LE"){let n=0;return n=(n<<8)+e[t+1],n=(n<<8)+e[t],n}else{let n=0;return n=(n<<8)+e[t],n=(n<<8)+e[t+1],n}}function os(e,t,r){if(t+4>e.length)throw new Error("Offset is outside the bounds of Uint8Array");if(r=r.toUpperCase(),r==="LE"){let n=0;return n=(n<<8)+e[t+3]>>>0,n=(n<<8)+e[t+2]>>>0,n=(n<<8)+e[t+1]>>>0,n=(n<<8)+e[t]>>>0,n}else{let n=0;return n=(n<<8)+e[t]>>>0,n=(n<<8)+e[t+1]>>>0,n=(n<<8)+e[t+2]>>>0,n=(n<<8)+e[t+3]>>>0,n}}function hs(e,t,r){if(t+8>e.length)throw new Error("Offset is outside the bounds of Uint8Array");if(r=r.toUpperCase(),r==="LE"){let n=0n;return n=(n<<8n)+BigInt(e[t+7]),n=(n<<8n)+BigInt(e[t+6]),n=(n<<8n)+BigInt(e[t+5]),n=(n<<8n)+BigInt(e[t+4]),n=(n<<8n)+BigInt(e[t+3]),n=(n<<8n)+BigInt(e[t+2]),n=(n<<8n)+BigInt(e[t+1]),n=(n<<8n)+BigInt(e[t]),n}else{let n=0n;return n=(n<<8n)+BigInt(e[t]),n=(n<<8n)+BigInt(e[t+1]),n=(n<<8n)+BigInt(e[t+2]),n=(n<<8n)+BigInt(e[t+3]),n=(n<<8n)+BigInt(e[t+4]),n=(n<<8n)+BigInt(e[t+5]),n=(n<<8n)+BigInt(e[t+6]),n=(n<<8n)+BigInt(e[t+7]),n}}const fs=e=>{if(e<0||e>0xffffffffffffffffn)throw new RangeError("value out of range")};function us(e){if(e<0||e>Number.MAX_SAFE_INTEGER||e%1!==0)throw new RangeError("value out of range")}function _n(e){typeof e=="number"?us(e):fs(e)}function Nn(e,t,r){_n(e),r===void 0&&(r=0),t===void 0&&(t=new Uint8Array(kr(e)));let n=0;return e<253?(t.set([Number(e)],r),n=1):e<=65535?(t.set([253],r),rs(t,r+1,Number(e),"LE"),n=3):e<=4294967295?(t.set([254],r),ns(t,r+1,Number(e),"LE"),n=5):(t.set([255],r),is(t,r+1,BigInt(e),"LE"),n=9),{buffer:t,bytes:n}}function as(e,t){t===void 0&&(t=0);const r=e.at(t);if(r===void 0)throw new Error("buffer too small");if(r<253)return{numberValue:r,bigintValue:BigInt(r),bytes:1};if(r===253){const n=ss(e,t+1,"LE");return{numberValue:n,bigintValue:BigInt(n),bytes:3}}else if(r===254){const n=os(e,t+1,"LE");return{numberValue:n,bigintValue:BigInt(n),bytes:5}}else{const n=hs(e,t+1,"LE");return{numberValue:n<=Number.MAX_SAFE_INTEGER?Number(n):null,bigintValue:n,bytes:9}}}function kr(e){return _n(e),e<253?1:e<=65535?3:e<=4294967295?5:9}const cs=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0")),qr=(()=>{const e=new Array(128).fill(-1);for(let t=0;t<10;t++)e[48+t]=t;for(let t=0;t<6;t++)e[65+t]=10+t,e[97+t]=10+t;return e})();function ls(e){let t="";for(let r=0;r<e.length;r++){const n=cs[e[r]];t+=n}return t}function ae(e){e.length>=2&&e[0]==="0"&&(e[1]==="x"||e[1]==="X")&&(e=e.slice(2));const t=e.length;if(t%2!==0)throw new TypeError("Invalid hex string: odd length");const r=t/2,n=new Uint8Array(r);for(let o=0;o<r;o++){const f=o*2,u=e.charCodeAt(f),c=e.charCodeAt(f+1);if(u>=128||c>=128)throw new TypeError(`Invalid hex character at position ${f}`);const p=qr[u],l=qr[c];if(p===-1)throw new TypeError(`Invalid hex character at position ${f}`);if(l===-1)throw new TypeError(`Invalid hex character at position ${f+1}`);n[o]=p<<4|l}return n}function ds(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function Ln(e,t,r=""){const n=ds(e),o=e?.length;if(!n||t!==void 0){const f=r&&`"${r}" `,u="",c=n?`length=${o}`:`type=${typeof e}`;throw new Error(f+"expected Uint8Array"+u+", got "+c)}return e}function Yr(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function ps(e,t){Ln(e,void 0,"digestInto() output");const r=t.outputLen;if(e.length<r)throw new Error('"digestInto() output" expected to be of length >='+r)}function Oe(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function sr(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function Tt(e,t){return e<<32-t|e>>>t}function ke(e,t){return e<<t|e>>>32-t>>>0}function Cn(e,t={}){const r=(o,f)=>e(f).update(o).digest(),n=e(void 0);return r.outputLen=n.outputLen,r.blockLen=n.blockLen,r.create=o=>e(o),Object.assign(r,t),Object.freeze(r)}const ws=e=>({oid:Uint8Array.from([6,9,96,134,72,1,101,3,4,2,e])});function ys(e,t,r){return e&t^~e&r}function gs(e,t,r){return e&t^e&r^t&r}class Hn{blockLen;outputLen;padOffset;isLE;buffer;view;finished=!1;length=0;pos=0;destroyed=!1;constructor(t,r,n,o){this.blockLen=t,this.outputLen=r,this.padOffset=n,this.isLE=o,this.buffer=new Uint8Array(t),this.view=sr(this.buffer)}update(t){Yr(this),Ln(t);const{view:r,buffer:n,blockLen:o}=this,f=t.length;for(let u=0;u<f;){const c=Math.min(o-this.pos,f-u);if(c===o){const p=sr(t);for(;o<=f-u;u+=o)this.process(p,u);continue}n.set(t.subarray(u,u+c),this.pos),this.pos+=c,u+=c,this.pos===o&&(this.process(r,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){Yr(this),ps(t,this),this.finished=!0;const{buffer:r,view:n,blockLen:o,isLE:f}=this;let{pos:u}=this;r[u++]=128,Oe(this.buffer.subarray(u)),this.padOffset>o-u&&(this.process(n,0),u=0);for(let w=u;w<o;w++)r[w]=0;n.setBigUint64(o-8,BigInt(this.length*8),f),this.process(n,0);const c=sr(t),p=this.outputLen;if(p%4)throw new Error("_sha2: outputLen must be aligned to 32bit");const l=p/4,a=this.get();if(l>a.length)throw new Error("_sha2: outputLen bigger than state");for(let w=0;w<l;w++)c.setUint32(4*w,a[w],f)}digest(){const{buffer:t,outputLen:r}=this;this.digestInto(t);const n=t.slice(0,r);return this.destroy(),n}_cloneInto(t){t||=new this.constructor,t.set(...this.get());const{blockLen:r,buffer:n,length:o,finished:f,destroyed:u,pos:c}=this;return t.destroyed=u,t.finished=f,t.length=o,t.pos=c,o%r&&t.buffer.set(n),t}clone(){return this._cloneInto()}}const Ht=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),bs=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Dt=new Uint32Array(64);class ms extends Hn{constructor(t){super(64,t,8,!1)}get(){const{A:t,B:r,C:n,D:o,E:f,F:u,G:c,H:p}=this;return[t,r,n,o,f,u,c,p]}set(t,r,n,o,f,u,c,p){this.A=t|0,this.B=r|0,this.C=n|0,this.D=o|0,this.E=f|0,this.F=u|0,this.G=c|0,this.H=p|0}process(t,r){for(let w=0;w<16;w++,r+=4)Dt[w]=t.getUint32(r,!1);for(let w=16;w<64;w++){const m=Dt[w-15],g=Dt[w-2],v=Tt(m,7)^Tt(m,18)^m>>>3,E=Tt(g,17)^Tt(g,19)^g>>>10;Dt[w]=E+Dt[w-7]+v+Dt[w-16]|0}let{A:n,B:o,C:f,D:u,E:c,F:p,G:l,H:a}=this;for(let w=0;w<64;w++){const m=Tt(c,6)^Tt(c,11)^Tt(c,25),g=a+m+ys(c,p,l)+bs[w]+Dt[w]|0,v=(Tt(n,2)^Tt(n,13)^Tt(n,22))+gs(n,o,f)|0;a=l,l=p,p=c,c=u+g|0,u=f,f=o,o=n,n=g+v|0}n=n+this.A|0,o=o+this.B|0,f=f+this.C|0,u=u+this.D|0,c=c+this.E|0,p=p+this.F|0,l=l+this.G|0,a=a+this.H|0,this.set(n,o,f,u,c,p,l,a)}roundClean(){Oe(Dt)}destroy(){this.set(0,0,0,0,0,0,0,0),Oe(this.buffer)}}class Es extends ms{A=Ht[0]|0;B=Ht[1]|0;C=Ht[2]|0;D=Ht[3]|0;E=Ht[4]|0;F=Ht[5]|0;G=Ht[6]|0;H=Ht[7]|0;constructor(){super(32)}}const Me=Cn(()=>new Es,ws(1));function vs(e){if(e.length>=255)throw new TypeError("Alphabet too long");const t=new Uint8Array(256);for(let l=0;l<t.length;l++)t[l]=255;for(let l=0;l<e.length;l++){const a=e.charAt(l),w=a.charCodeAt(0);if(t[w]!==255)throw new TypeError(a+" is ambiguous");t[w]=l}const r=e.length,n=e.charAt(0),o=Math.log(r)/Math.log(256),f=Math.log(256)/Math.log(r);function u(l){if(l instanceof Uint8Array||(ArrayBuffer.isView(l)?l=new Uint8Array(l.buffer,l.byteOffset,l.byteLength):Array.isArray(l)&&(l=Uint8Array.from(l))),!(l instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(l.length===0)return"";let a=0,w=0,m=0;const g=l.length;for(;m!==g&&l[m]===0;)m++,a++;const v=(g-m)*f+1>>>0,E=new Uint8Array(v);for(;m!==g;){let k=l[m],R=0;for(let N=v-1;(k!==0||R<w)&&N!==-1;N--,R++)k+=256*E[N]>>>0,E[N]=k%r>>>0,k=k/r>>>0;if(k!==0)throw new Error("Non-zero carry");w=R,m++}let T=v-w;for(;T!==v&&E[T]===0;)T++;let U=n.repeat(a);for(;T<v;++T)U+=e.charAt(E[T]);return U}function c(l){if(typeof l!="string")throw new TypeError("Expected String");if(l.length===0)return new Uint8Array;let a=0,w=0,m=0;for(;l[a]===n;)w++,a++;const g=(l.length-a)*o+1>>>0,v=new Uint8Array(g);for(;a<l.length;){const k=l.charCodeAt(a);if(k>255)return;let R=t[k];if(R===255)return;let N=0;for(let $=g-1;(R!==0||N<m)&&$!==-1;$--,N++)R+=r*v[$]>>>0,v[$]=R%256>>>0,R=R/256>>>0;if(R!==0)throw new Error("Non-zero carry");m=N,a++}let E=g-m;for(;E!==g&&v[E]===0;)E++;const T=new Uint8Array(w+(g-E));let U=w;for(;E!==g;)T[U++]=v[E++];return T}function p(l){const a=c(l);if(a)return a;throw new Error("Non-base"+r+" character")}return{encode:u,decodeUnsafe:c,decode:p}}var As="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";const or=vs(As);function Os(e){function t(f){const u=e(f),c=f.length+4,p=new Uint8Array(c);return p.set(f,0),p.set(u.subarray(0,4),f.length),or.encode(p)}function r(f){const u=f.slice(0,-4),c=f.slice(-4),p=e(u);if(!(c[0]^p[0]|c[1]^p[1]|c[2]^p[2]|c[3]^p[3]))return u}function n(f){const u=or.decodeUnsafe(f);if(u!==void 0)return r(u)}function o(f){const u=or.decode(f),c=r(u);if(c===void 0)throw new Error("Invalid checksum");return c}return{encode:t,decode:o,decodeUnsafe:n}}function Ps(e){return Me(Me(e))}const{encode:Dn,decode:Vn}=Os(Ps);function Nt(e){let t=0;for(const o of e)t+=o.length;const r=new Uint8Array(t);let n=0;for(const o of e)r.set(o,n),n+=o.length;return r}function M(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function oe(e,t){const r=Math.min(e.length,t.length);for(let n=0;n<r;n++){const o=e[n]-t[n];if(o!==0)return o}return e.length-t.length}function wr(e){for(let t=0;t<e.length;t++)if(e[t]!==0)return!1;return!0}function ce(e,t=0){const r=new Uint8Array(e);return t!==0&&r.fill(t),r}function Ts(e){if(e.length<8||e.length>72||e[0]!==48||e[1]!==e.length-2||e[2]!==2)return!1;const t=e[3];if(t===0||5+t>=e.length||e[4+t]!==2)return!1;const r=e[5+t];return!(r===0||6+t+r!==e.length||e[4]&128||t>1&&e[4]===0&&!(e[5]&128)||e[t+6]&128||r>1&&e[t+6]===0&&!(e[t+7]&128))}const q={OP_FALSE:0,OP_0:0,OP_PUSHDATA1:76,OP_PUSHDATA2:77,OP_PUSHDATA4:78,OP_1NEGATE:79,OP_RESERVED:80,OP_TRUE:81,OP_1:81,OP_2:82,OP_3:83,OP_4:84,OP_5:85,OP_6:86,OP_7:87,OP_8:88,OP_9:89,OP_10:90,OP_11:91,OP_12:92,OP_13:93,OP_14:94,OP_15:95,OP_16:96,OP_NOP:97,OP_VER:98,OP_IF:99,OP_NOTIF:100,OP_VERIF:101,OP_VERNOTIF:102,OP_ELSE:103,OP_ENDIF:104,OP_VERIFY:105,OP_RETURN:106,OP_TOALTSTACK:107,OP_FROMALTSTACK:108,OP_2DROP:109,OP_2DUP:110,OP_3DUP:111,OP_2OVER:112,OP_2ROT:113,OP_2SWAP:114,OP_IFDUP:115,OP_DEPTH:116,OP_DROP:117,OP_DUP:118,OP_NIP:119,OP_OVER:120,OP_PICK:121,OP_ROLL:122,OP_ROT:123,OP_SWAP:124,OP_TUCK:125,OP_CAT:126,OP_SUBSTR:127,OP_LEFT:128,OP_RIGHT:129,OP_SIZE:130,OP_INVERT:131,OP_AND:132,OP_OR:133,OP_XOR:134,OP_EQUAL:135,OP_EQUALVERIFY:136,OP_RESERVED1:137,OP_RESERVED2:138,OP_1ADD:139,OP_1SUB:140,OP_2MUL:141,OP_2DIV:142,OP_NEGATE:143,OP_ABS:144,OP_NOT:145,OP_0NOTEQUAL:146,OP_ADD:147,OP_SUB:148,OP_MUL:149,OP_DIV:150,OP_MOD:151,OP_LSHIFT:152,OP_RSHIFT:153,OP_BOOLAND:154,OP_BOOLOR:155,OP_NUMEQUAL:156,OP_NUMEQUALVERIFY:157,OP_NUMNOTEQUAL:158,OP_LESSTHAN:159,OP_GREATERTHAN:160,OP_LESSTHANOREQUAL:161,OP_GREATERTHANOREQUAL:162,OP_MIN:163,OP_MAX:164,OP_WITHIN:165,OP_RIPEMD160:166,OP_SHA1:167,OP_SHA256:168,OP_HASH160:169,OP_HASH256:170,OP_CODESEPARATOR:171,OP_CHECKSIG:172,OP_CHECKSIGVERIFY:173,OP_CHECKMULTISIG:174,OP_CHECKMULTISIGVERIFY:175,OP_NOP1:176,OP_NOP2:177,OP_CHECKLOCKTIMEVERIFY:177,OP_NOP3:178,OP_CHECKSEQUENCEVERIFY:178,OP_NOP4:179,OP_NOP5:180,OP_NOP6:181,OP_NOP7:182,OP_NOP8:183,OP_NOP9:184,OP_NOP10:185,OP_CHECKSIGADD:186,OP_PUBKEYHASH:253,OP_PUBKEY:254,OP_INVALIDOPCODE:255};let Ue;function Is(){if(!Ue){Ue={};for(const e of Object.keys(q)){const t=q[e];Ue[t]=e}}return Ue}Is();function Mn(e){return e<q.OP_PUSHDATA1?1:e<=255?2:e<=65535?3:5}function Bs(e,t,r){const n=Mn(t),o=new DataView(e.buffer,e.byteOffset,e.byteLength);return n===1?e[r]=t:n===2?(e[r]=q.OP_PUSHDATA1,e[r+1]=t):n===3?(e[r]=q.OP_PUSHDATA2,o.setUint16(r+1,t,!0)):(e[r]=q.OP_PUSHDATA4,o.setUint32(r+1,t,!0)),n}function ks(e,t){const r=new DataView(e.buffer,e.byteOffset,e.byteLength),n=e[t];let o,f;if(n<q.OP_PUSHDATA1)o=n,f=1;else if(n===q.OP_PUSHDATA1){if(t+2>e.length)return null;o=e[t+1],f=2}else if(n===q.OP_PUSHDATA2){if(t+3>e.length)return null;o=r.getUint16(t+1,!0),f=3}else{if(t+5>e.length)return null;if(n!==q.OP_PUSHDATA4)throw new Error("Unexpected opcode");o=r.getUint32(t+1,!0),f=5}return{opcode:n,number:o,size:f}}var Fn={},ze={};ze.byteLength=xs;ze.toByteArray=_s;ze.fromByteArray=Cs;var Bt=[],bt=[],Us=typeof Uint8Array<"u"?Uint8Array:Array,hr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var ne=0,Rs=hr.length;ne<Rs;++ne)Bt[ne]=hr[ne],bt[hr.charCodeAt(ne)]=ne;bt[45]=62;bt[95]=63;function Kn(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");r===-1&&(r=t);var n=r===t?0:4-r%4;return[r,n]}function xs(e){var t=Kn(e),r=t[0],n=t[1];return(r+n)*3/4-n}function Ss(e,t,r){return(t+r)*3/4-r}function _s(e){var t,r=Kn(e),n=r[0],o=r[1],f=new Us(Ss(e,n,o)),u=0,c=o>0?n-4:n,p;for(p=0;p<c;p+=4)t=bt[e.charCodeAt(p)]<<18|bt[e.charCodeAt(p+1)]<<12|bt[e.charCodeAt(p+2)]<<6|bt[e.charCodeAt(p+3)],f[u++]=t>>16&255,f[u++]=t>>8&255,f[u++]=t&255;return o===2&&(t=bt[e.charCodeAt(p)]<<2|bt[e.charCodeAt(p+1)]>>4,f[u++]=t&255),o===1&&(t=bt[e.charCodeAt(p)]<<10|bt[e.charCodeAt(p+1)]<<4|bt[e.charCodeAt(p+2)]>>2,f[u++]=t>>8&255,f[u++]=t&255),f}function Ns(e){return Bt[e>>18&63]+Bt[e>>12&63]+Bt[e>>6&63]+Bt[e&63]}function Ls(e,t,r){for(var n,o=[],f=t;f<r;f+=3)n=(e[f]<<16&16711680)+(e[f+1]<<8&65280)+(e[f+2]&255),o.push(Ns(n));return o.join("")}function Cs(e){for(var t,r=e.length,n=r%3,o=[],f=16383,u=0,c=r-n;u<c;u+=f)o.push(Ls(e,u,u+f>c?c:u+f));return n===1?(t=e[r-1],o.push(Bt[t>>2]+Bt[t<<4&63]+"==")):n===2&&(t=(e[r-2]<<8)+e[r-1],o.push(Bt[t>>10]+Bt[t>>4&63]+Bt[t<<2&63]+"=")),o.join("")}var Ur={};Ur.read=function(e,t,r,n,o){var f,u,c=o*8-n-1,p=(1<<c)-1,l=p>>1,a=-7,w=r?o-1:0,m=r?-1:1,g=e[t+w];for(w+=m,f=g&(1<<-a)-1,g>>=-a,a+=c;a>0;f=f*256+e[t+w],w+=m,a-=8);for(u=f&(1<<-a)-1,f>>=-a,a+=n;a>0;u=u*256+e[t+w],w+=m,a-=8);if(f===0)f=1-l;else{if(f===p)return u?NaN:(g?-1:1)*(1/0);u=u+Math.pow(2,n),f=f-l}return(g?-1:1)*u*Math.pow(2,f-n)};Ur.write=function(e,t,r,n,o,f){var u,c,p,l=f*8-o-1,a=(1<<l)-1,w=a>>1,m=o===23?Math.pow(2,-24)-Math.pow(2,-77):0,g=n?0:f-1,v=n?1:-1,E=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(c=isNaN(t)?1:0,u=a):(u=Math.floor(Math.log(t)/Math.LN2),t*(p=Math.pow(2,-u))<1&&(u--,p*=2),u+w>=1?t+=m/p:t+=m*Math.pow(2,1-w),t*p>=2&&(u++,p/=2),u+w>=a?(c=0,u=a):u+w>=1?(c=(t*p-1)*Math.pow(2,o),u=u+w):(c=t*Math.pow(2,w-1)*Math.pow(2,o),u=0));o>=8;e[r+g]=c&255,g+=v,c/=256,o-=8);for(u=u<<o|c,l+=o;l>0;e[r+g]=u&255,g+=v,u/=256,l-=8);e[r+g-v]|=E*128};(function(e){const t=ze,r=Ur,n=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;e.Buffer=a,e.SlowBuffer=$,e.INSPECT_MAX_BYTES=50;const o=2147483647;e.kMaxLength=o;const{Uint8Array:f,ArrayBuffer:u,SharedArrayBuffer:c}=globalThis;a.TYPED_ARRAY_SUPPORT=p(),!a.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function p(){try{const i=new f(1),s={foo:function(){return 42}};return Object.setPrototypeOf(s,f.prototype),Object.setPrototypeOf(i,s),i.foo()===42}catch{return!1}}Object.defineProperty(a.prototype,"parent",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.buffer}}),Object.defineProperty(a.prototype,"offset",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.byteOffset}});function l(i){if(i>o)throw new RangeError('The value "'+i+'" is invalid for option "size"');const s=new f(i);return Object.setPrototypeOf(s,a.prototype),s}function a(i,s,h){if(typeof i=="number"){if(typeof s=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return v(i)}return w(i,s,h)}a.poolSize=8192;function w(i,s,h){if(typeof i=="string")return E(i,s);if(u.isView(i))return U(i);if(i==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof i);if(Pt(i,u)||i&&Pt(i.buffer,u)||typeof c<"u"&&(Pt(i,c)||i&&Pt(i.buffer,c)))return k(i,s,h);if(typeof i=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const d=i.valueOf&&i.valueOf();if(d!=null&&d!==i)return a.from(d,s,h);const y=R(i);if(y)return y;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof i[Symbol.toPrimitive]=="function")return a.from(i[Symbol.toPrimitive]("string"),s,h);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof i)}a.from=function(i,s,h){return w(i,s,h)},Object.setPrototypeOf(a.prototype,f.prototype),Object.setPrototypeOf(a,f);function m(i){if(typeof i!="number")throw new TypeError('"size" argument must be of type number');if(i<0)throw new RangeError('The value "'+i+'" is invalid for option "size"')}function g(i,s,h){return m(i),i<=0?l(i):s!==void 0?typeof h=="string"?l(i).fill(s,h):l(i).fill(s):l(i)}a.alloc=function(i,s,h){return g(i,s,h)};function v(i){return m(i),l(i<0?0:N(i)|0)}a.allocUnsafe=function(i){return v(i)},a.allocUnsafeSlow=function(i){return v(i)};function E(i,s){if((typeof s!="string"||s==="")&&(s="utf8"),!a.isEncoding(s))throw new TypeError("Unknown encoding: "+s);const h=J(i,s)|0;let d=l(h);const y=d.write(i,s);return y!==h&&(d=d.slice(0,y)),d}function T(i){const s=i.length<0?0:N(i.length)|0,h=l(s);for(let d=0;d<s;d+=1)h[d]=i[d]&255;return h}function U(i){if(Pt(i,f)){const s=new f(i);return k(s.buffer,s.byteOffset,s.byteLength)}return T(i)}function k(i,s,h){if(s<0||i.byteLength<s)throw new RangeError('"offset" is outside of buffer bounds');if(i.byteLength<s+(h||0))throw new RangeError('"length" is outside of buffer bounds');let d;return s===void 0&&h===void 0?d=new f(i):h===void 0?d=new f(i,s):d=new f(i,s,h),Object.setPrototypeOf(d,a.prototype),d}function R(i){if(a.isBuffer(i)){const s=N(i.length)|0,h=l(s);return h.length===0||i.copy(h,0,0,s),h}if(i.length!==void 0)return typeof i.length!="number"||ir(i.length)?l(0):T(i);if(i.type==="Buffer"&&Array.isArray(i.data))return T(i.data)}function N(i){if(i>=o)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return i|0}function $(i){return+i!=i&&(i=0),a.alloc(+i)}a.isBuffer=function(i){return i!=null&&i._isBuffer===!0&&i!==a.prototype},a.compare=function(i,s){if(Pt(i,f)&&(i=a.from(i,i.offset,i.byteLength)),Pt(s,f)&&(s=a.from(s,s.offset,s.byteLength)),!a.isBuffer(i)||!a.isBuffer(s))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(i===s)return 0;let h=i.length,d=s.length;for(let y=0,b=Math.min(h,d);y<b;++y)if(i[y]!==s[y]){h=i[y],d=s[y];break}return h<d?-1:d<h?1:0},a.isEncoding=function(i){switch(String(i).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(i,s){if(!Array.isArray(i))throw new TypeError('"list" argument must be an Array of Buffers');if(i.length===0)return a.alloc(0);let h;if(s===void 0)for(s=0,h=0;h<i.length;++h)s+=i[h].length;const d=a.allocUnsafe(s);let y=0;for(h=0;h<i.length;++h){let b=i[h];if(Pt(b,f))y+b.length>d.length?(a.isBuffer(b)||(b=a.from(b)),b.copy(d,y)):f.prototype.set.call(d,b,y);else if(a.isBuffer(b))b.copy(d,y);else throw new TypeError('"list" argument must be an Array of Buffers');y+=b.length}return d};function J(i,s){if(a.isBuffer(i))return i.length;if(u.isView(i)||Pt(i,u))return i.byteLength;if(typeof i!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof i);const h=i.length,d=arguments.length>2&&arguments[2]===!0;if(!d&&h===0)return 0;let y=!1;for(;;)switch(s){case"ascii":case"latin1":case"binary":return h;case"utf8":case"utf-8":return nr(i).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return h*2;case"hex":return h>>>1;case"base64":return Gr(i).length;default:if(y)return d?-1:nr(i).length;s=(""+s).toLowerCase(),y=!0}}a.byteLength=J;function Lt(i,s,h){let d=!1;if((s===void 0||s<0)&&(s=0),s>this.length||((h===void 0||h>this.length)&&(h=this.length),h<=0)||(h>>>=0,s>>>=0,h<=s))return"";for(i||(i="utf8");;)switch(i){case"hex":return F(this,s,h);case"utf8":case"utf-8":return L(this,s,h);case"ascii":return _(this,s,h);case"latin1":case"binary":return V(this,s,h);case"base64":return B(this,s,h);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return et(this,s,h);default:if(d)throw new TypeError("Unknown encoding: "+i);i=(i+"").toLowerCase(),d=!0}}a.prototype._isBuffer=!0;function st(i,s,h){const d=i[s];i[s]=i[h],i[h]=d}a.prototype.swap16=function(){const i=this.length;if(i%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let s=0;s<i;s+=2)st(this,s,s+1);return this},a.prototype.swap32=function(){const i=this.length;if(i%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let s=0;s<i;s+=4)st(this,s,s+3),st(this,s+1,s+2);return this},a.prototype.swap64=function(){const i=this.length;if(i%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let s=0;s<i;s+=8)st(this,s,s+7),st(this,s+1,s+6),st(this,s+2,s+5),st(this,s+3,s+4);return this},a.prototype.toString=function(){const i=this.length;return i===0?"":arguments.length===0?L(this,0,i):Lt.apply(this,arguments)},a.prototype.toLocaleString=a.prototype.toString,a.prototype.equals=function(i){if(!a.isBuffer(i))throw new TypeError("Argument must be a Buffer");return this===i?!0:a.compare(this,i)===0},a.prototype.inspect=function(){let i="";const s=e.INSPECT_MAX_BYTES;return i=this.toString("hex",0,s).replace(/(.{2})/g,"$1 ").trim(),this.length>s&&(i+=" ... "),"<Buffer "+i+">"},n&&(a.prototype[n]=a.prototype.inspect),a.prototype.compare=function(i,s,h,d,y){if(Pt(i,f)&&(i=a.from(i,i.offset,i.byteLength)),!a.isBuffer(i))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof i);if(s===void 0&&(s=0),h===void 0&&(h=i?i.length:0),d===void 0&&(d=0),y===void 0&&(y=this.length),s<0||h>i.length||d<0||y>this.length)throw new RangeError("out of range index");if(d>=y&&s>=h)return 0;if(d>=y)return-1;if(s>=h)return 1;if(s>>>=0,h>>>=0,d>>>=0,y>>>=0,this===i)return 0;let b=y-d,P=h-s;const z=Math.min(b,P),ft=this.slice(d,y),Q=i.slice(s,h);for(let W=0;W<z;++W)if(ft[W]!==Q[W]){b=ft[W],P=Q[W];break}return b<P?-1:P<b?1:0};function G(i,s,h,d,y){if(i.length===0)return-1;if(typeof h=="string"?(d=h,h=0):h>2147483647?h=2147483647:h<-2147483648&&(h=-2147483648),h=+h,ir(h)&&(h=y?0:i.length-1),h<0&&(h=i.length+h),h>=i.length){if(y)return-1;h=i.length-1}else if(h<0)if(y)h=0;else return-1;if(typeof s=="string"&&(s=a.from(s,d)),a.isBuffer(s))return s.length===0?-1:mt(i,s,h,d,y);if(typeof s=="number")return s=s&255,typeof f.prototype.indexOf=="function"?y?f.prototype.indexOf.call(i,s,h):f.prototype.lastIndexOf.call(i,s,h):mt(i,[s],h,d,y);throw new TypeError("val must be string, number or Buffer")}function mt(i,s,h,d,y){let b=1,P=i.length,z=s.length;if(d!==void 0&&(d=String(d).toLowerCase(),d==="ucs2"||d==="ucs-2"||d==="utf16le"||d==="utf-16le")){if(i.length<2||s.length<2)return-1;b=2,P/=2,z/=2,h/=2}function ft(W,nt){return b===1?W[nt]:W.readUInt16BE(nt*b)}let Q;if(y){let W=-1;for(Q=h;Q<P;Q++)if(ft(i,Q)===ft(s,W===-1?0:Q-W)){if(W===-1&&(W=Q),Q-W+1===z)return W*b}else W!==-1&&(Q-=Q-W),W=-1}else for(h+z>P&&(h=P-z),Q=h;Q>=0;Q--){let W=!0;for(let nt=0;nt<z;nt++)if(ft(i,Q+nt)!==ft(s,nt)){W=!1;break}if(W)return Q}return-1}a.prototype.includes=function(i,s,h){return this.indexOf(i,s,h)!==-1},a.prototype.indexOf=function(i,s,h){return G(this,i,s,h,!0)},a.prototype.lastIndexOf=function(i,s,h){return G(this,i,s,h,!1)};function kt(i,s,h,d){h=Number(h)||0;const y=i.length-h;d?(d=Number(d),d>y&&(d=y)):d=y;const b=s.length;d>b/2&&(d=b/2);let P;for(P=0;P<d;++P){const z=parseInt(s.substr(P*2,2),16);if(ir(z))return P;i[h+P]=z}return P}function j(i,s,h,d){return Be(nr(s,i.length-h),i,h,d)}function I(i,s,h,d){return Be(Mi(s),i,h,d)}function O(i,s,h,d){return Be(Gr(s),i,h,d)}function A(i,s,h,d){return Be(Fi(s,i.length-h),i,h,d)}a.prototype.write=function(i,s,h,d){if(s===void 0)d="utf8",h=this.length,s=0;else if(h===void 0&&typeof s=="string")d=s,h=this.length,s=0;else if(isFinite(s))s=s>>>0,isFinite(h)?(h=h>>>0,d===void 0&&(d="utf8")):(d=h,h=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const y=this.length-s;if((h===void 0||h>y)&&(h=y),i.length>0&&(h<0||s<0)||s>this.length)throw new RangeError("Attempt to write outside buffer bounds");d||(d="utf8");let b=!1;for(;;)switch(d){case"hex":return kt(this,i,s,h);case"utf8":case"utf-8":return j(this,i,s,h);case"ascii":case"latin1":case"binary":return I(this,i,s,h);case"base64":return O(this,i,s,h);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return A(this,i,s,h);default:if(b)throw new TypeError("Unknown encoding: "+d);d=(""+d).toLowerCase(),b=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function B(i,s,h){return s===0&&h===i.length?t.fromByteArray(i):t.fromByteArray(i.slice(s,h))}function L(i,s,h){h=Math.min(i.length,h);const d=[];let y=s;for(;y<h;){const b=i[y];let P=null,z=b>239?4:b>223?3:b>191?2:1;if(y+z<=h){let ft,Q,W,nt;switch(z){case 1:b<128&&(P=b);break;case 2:ft=i[y+1],(ft&192)===128&&(nt=(b&31)<<6|ft&63,nt>127&&(P=nt));break;case 3:ft=i[y+1],Q=i[y+2],(ft&192)===128&&(Q&192)===128&&(nt=(b&15)<<12|(ft&63)<<6|Q&63,nt>2047&&(nt<55296||nt>57343)&&(P=nt));break;case 4:ft=i[y+1],Q=i[y+2],W=i[y+3],(ft&192)===128&&(Q&192)===128&&(W&192)===128&&(nt=(b&15)<<18|(ft&63)<<12|(Q&63)<<6|W&63,nt>65535&&nt<1114112&&(P=nt))}}P===null?(P=65533,z=1):P>65535&&(P-=65536,d.push(P>>>10&1023|55296),P=56320|P&1023),d.push(P),y+=z}return H(d)}const C=4096;function H(i){const s=i.length;if(s<=C)return String.fromCharCode.apply(String,i);let h="",d=0;for(;d<s;)h+=String.fromCharCode.apply(String,i.slice(d,d+=C));return h}function _(i,s,h){let d="";h=Math.min(i.length,h);for(let y=s;y<h;++y)d+=String.fromCharCode(i[y]&127);return d}function V(i,s,h){let d="";h=Math.min(i.length,h);for(let y=s;y<h;++y)d+=String.fromCharCode(i[y]);return d}function F(i,s,h){const d=i.length;(!s||s<0)&&(s=0),(!h||h<0||h>d)&&(h=d);let y="";for(let b=s;b<h;++b)y+=Ki[i[b]];return y}function et(i,s,h){const d=i.slice(s,h);let y="";for(let b=0;b<d.length-1;b+=2)y+=String.fromCharCode(d[b]+d[b+1]*256);return y}a.prototype.slice=function(i,s){const h=this.length;i=~~i,s=s===void 0?h:~~s,i<0?(i+=h,i<0&&(i=0)):i>h&&(i=h),s<0?(s+=h,s<0&&(s=0)):s>h&&(s=h),s<i&&(s=i);const d=this.subarray(i,s);return Object.setPrototypeOf(d,a.prototype),d};function K(i,s,h){if(i%1!==0||i<0)throw new RangeError("offset is not uint");if(i+s>h)throw new RangeError("Trying to access beyond buffer length")}a.prototype.readUintLE=a.prototype.readUIntLE=function(i,s,h){i=i>>>0,s=s>>>0,h||K(i,s,this.length);let d=this[i],y=1,b=0;for(;++b<s&&(y*=256);)d+=this[i+b]*y;return d},a.prototype.readUintBE=a.prototype.readUIntBE=function(i,s,h){i=i>>>0,s=s>>>0,h||K(i,s,this.length);let d=this[i+--s],y=1;for(;s>0&&(y*=256);)d+=this[i+--s]*y;return d},a.prototype.readUint8=a.prototype.readUInt8=function(i,s){return i=i>>>0,s||K(i,1,this.length),this[i]},a.prototype.readUint16LE=a.prototype.readUInt16LE=function(i,s){return i=i>>>0,s||K(i,2,this.length),this[i]|this[i+1]<<8},a.prototype.readUint16BE=a.prototype.readUInt16BE=function(i,s){return i=i>>>0,s||K(i,2,this.length),this[i]<<8|this[i+1]},a.prototype.readUint32LE=a.prototype.readUInt32LE=function(i,s){return i=i>>>0,s||K(i,4,this.length),(this[i]|this[i+1]<<8|this[i+2]<<16)+this[i+3]*16777216},a.prototype.readUint32BE=a.prototype.readUInt32BE=function(i,s){return i=i>>>0,s||K(i,4,this.length),this[i]*16777216+(this[i+1]<<16|this[i+2]<<8|this[i+3])},a.prototype.readBigUInt64LE=Ct(function(i){i=i>>>0,re(i,"offset");const s=this[i],h=this[i+7];(s===void 0||h===void 0)&&pe(i,this.length-8);const d=s+this[++i]*2**8+this[++i]*2**16+this[++i]*2**24,y=this[++i]+this[++i]*2**8+this[++i]*2**16+h*2**24;return BigInt(d)+(BigInt(y)<<BigInt(32))}),a.prototype.readBigUInt64BE=Ct(function(i){i=i>>>0,re(i,"offset");const s=this[i],h=this[i+7];(s===void 0||h===void 0)&&pe(i,this.length-8);const d=s*2**24+this[++i]*2**16+this[++i]*2**8+this[++i],y=this[++i]*2**24+this[++i]*2**16+this[++i]*2**8+h;return(BigInt(d)<<BigInt(32))+BigInt(y)}),a.prototype.readIntLE=function(i,s,h){i=i>>>0,s=s>>>0,h||K(i,s,this.length);let d=this[i],y=1,b=0;for(;++b<s&&(y*=256);)d+=this[i+b]*y;return y*=128,d>=y&&(d-=Math.pow(2,8*s)),d},a.prototype.readIntBE=function(i,s,h){i=i>>>0,s=s>>>0,h||K(i,s,this.length);let d=s,y=1,b=this[i+--d];for(;d>0&&(y*=256);)b+=this[i+--d]*y;return y*=128,b>=y&&(b-=Math.pow(2,8*s)),b},a.prototype.readInt8=function(i,s){return i=i>>>0,s||K(i,1,this.length),this[i]&128?(255-this[i]+1)*-1:this[i]},a.prototype.readInt16LE=function(i,s){i=i>>>0,s||K(i,2,this.length);const h=this[i]|this[i+1]<<8;return h&32768?h|4294901760:h},a.prototype.readInt16BE=function(i,s){i=i>>>0,s||K(i,2,this.length);const h=this[i+1]|this[i]<<8;return h&32768?h|4294901760:h},a.prototype.readInt32LE=function(i,s){return i=i>>>0,s||K(i,4,this.length),this[i]|this[i+1]<<8|this[i+2]<<16|this[i+3]<<24},a.prototype.readInt32BE=function(i,s){return i=i>>>0,s||K(i,4,this.length),this[i]<<24|this[i+1]<<16|this[i+2]<<8|this[i+3]},a.prototype.readBigInt64LE=Ct(function(i){i=i>>>0,re(i,"offset");const s=this[i],h=this[i+7];(s===void 0||h===void 0)&&pe(i,this.length-8);const d=this[i+4]+this[i+5]*2**8+this[i+6]*2**16+(h<<24);return(BigInt(d)<<BigInt(32))+BigInt(s+this[++i]*2**8+this[++i]*2**16+this[++i]*2**24)}),a.prototype.readBigInt64BE=Ct(function(i){i=i>>>0,re(i,"offset");const s=this[i],h=this[i+7];(s===void 0||h===void 0)&&pe(i,this.length-8);const d=(s<<24)+this[++i]*2**16+this[++i]*2**8+this[++i];return(BigInt(d)<<BigInt(32))+BigInt(this[++i]*2**24+this[++i]*2**16+this[++i]*2**8+h)}),a.prototype.readFloatLE=function(i,s){return i=i>>>0,s||K(i,4,this.length),r.read(this,i,!0,23,4)},a.prototype.readFloatBE=function(i,s){return i=i>>>0,s||K(i,4,this.length),r.read(this,i,!1,23,4)},a.prototype.readDoubleLE=function(i,s){return i=i>>>0,s||K(i,8,this.length),r.read(this,i,!0,52,8)},a.prototype.readDoubleBE=function(i,s){return i=i>>>0,s||K(i,8,this.length),r.read(this,i,!1,52,8)};function D(i,s,h,d,y,b){if(!a.isBuffer(i))throw new TypeError('"buffer" argument must be a Buffer instance');if(s>y||s<b)throw new RangeError('"value" argument is out of bounds');if(h+d>i.length)throw new RangeError("Index out of range")}a.prototype.writeUintLE=a.prototype.writeUIntLE=function(i,s,h,d){if(i=+i,s=s>>>0,h=h>>>0,!d){const P=Math.pow(2,8*h)-1;D(this,i,s,h,P,0)}let y=1,b=0;for(this[s]=i&255;++b<h&&(y*=256);)this[s+b]=i/y&255;return s+h},a.prototype.writeUintBE=a.prototype.writeUIntBE=function(i,s,h,d){if(i=+i,s=s>>>0,h=h>>>0,!d){const P=Math.pow(2,8*h)-1;D(this,i,s,h,P,0)}let y=h-1,b=1;for(this[s+y]=i&255;--y>=0&&(b*=256);)this[s+y]=i/b&255;return s+h},a.prototype.writeUint8=a.prototype.writeUInt8=function(i,s,h){return i=+i,s=s>>>0,h||D(this,i,s,1,255,0),this[s]=i&255,s+1},a.prototype.writeUint16LE=a.prototype.writeUInt16LE=function(i,s,h){return i=+i,s=s>>>0,h||D(this,i,s,2,65535,0),this[s]=i&255,this[s+1]=i>>>8,s+2},a.prototype.writeUint16BE=a.prototype.writeUInt16BE=function(i,s,h){return i=+i,s=s>>>0,h||D(this,i,s,2,65535,0),this[s]=i>>>8,this[s+1]=i&255,s+2},a.prototype.writeUint32LE=a.prototype.writeUInt32LE=function(i,s,h){return i=+i,s=s>>>0,h||D(this,i,s,4,4294967295,0),this[s+3]=i>>>24,this[s+2]=i>>>16,this[s+1]=i>>>8,this[s]=i&255,s+4},a.prototype.writeUint32BE=a.prototype.writeUInt32BE=function(i,s,h){return i=+i,s=s>>>0,h||D(this,i,s,4,4294967295,0),this[s]=i>>>24,this[s+1]=i>>>16,this[s+2]=i>>>8,this[s+3]=i&255,s+4};function Z(i,s,h,d,y){$r(s,d,y,i,h,7);let b=Number(s&BigInt(4294967295));i[h++]=b,b=b>>8,i[h++]=b,b=b>>8,i[h++]=b,b=b>>8,i[h++]=b;let P=Number(s>>BigInt(32)&BigInt(4294967295));return i[h++]=P,P=P>>8,i[h++]=P,P=P>>8,i[h++]=P,P=P>>8,i[h++]=P,h}function rt(i,s,h,d,y){$r(s,d,y,i,h,7);let b=Number(s&BigInt(4294967295));i[h+7]=b,b=b>>8,i[h+6]=b,b=b>>8,i[h+5]=b,b=b>>8,i[h+4]=b;let P=Number(s>>BigInt(32)&BigInt(4294967295));return i[h+3]=P,P=P>>8,i[h+2]=P,P=P>>8,i[h+1]=P,P=P>>8,i[h]=P,h+8}a.prototype.writeBigUInt64LE=Ct(function(i,s=0){return Z(this,i,s,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeBigUInt64BE=Ct(function(i,s=0){return rt(this,i,s,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeIntLE=function(i,s,h,d){if(i=+i,s=s>>>0,!d){const z=Math.pow(2,8*h-1);D(this,i,s,h,z-1,-z)}let y=0,b=1,P=0;for(this[s]=i&255;++y<h&&(b*=256);)i<0&&P===0&&this[s+y-1]!==0&&(P=1),this[s+y]=(i/b>>0)-P&255;return s+h},a.prototype.writeIntBE=function(i,s,h,d){if(i=+i,s=s>>>0,!d){const z=Math.pow(2,8*h-1);D(this,i,s,h,z-1,-z)}let y=h-1,b=1,P=0;for(this[s+y]=i&255;--y>=0&&(b*=256);)i<0&&P===0&&this[s+y+1]!==0&&(P=1),this[s+y]=(i/b>>0)-P&255;return s+h},a.prototype.writeInt8=function(i,s,h){return i=+i,s=s>>>0,h||D(this,i,s,1,127,-128),i<0&&(i=255+i+1),this[s]=i&255,s+1},a.prototype.writeInt16LE=function(i,s,h){return i=+i,s=s>>>0,h||D(this,i,s,2,32767,-32768),this[s]=i&255,this[s+1]=i>>>8,s+2},a.prototype.writeInt16BE=function(i,s,h){return i=+i,s=s>>>0,h||D(this,i,s,2,32767,-32768),this[s]=i>>>8,this[s+1]=i&255,s+2},a.prototype.writeInt32LE=function(i,s,h){return i=+i,s=s>>>0,h||D(this,i,s,4,2147483647,-2147483648),this[s]=i&255,this[s+1]=i>>>8,this[s+2]=i>>>16,this[s+3]=i>>>24,s+4},a.prototype.writeInt32BE=function(i,s,h){return i=+i,s=s>>>0,h||D(this,i,s,4,2147483647,-2147483648),i<0&&(i=4294967295+i+1),this[s]=i>>>24,this[s+1]=i>>>16,this[s+2]=i>>>8,this[s+3]=i&255,s+4},a.prototype.writeBigInt64LE=Ct(function(i,s=0){return Z(this,i,s,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),a.prototype.writeBigInt64BE=Ct(function(i,s=0){return rt(this,i,s,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function wt(i,s,h,d,y,b){if(h+d>i.length)throw new RangeError("Index out of range");if(h<0)throw new RangeError("Index out of range")}function X(i,s,h,d,y){return s=+s,h=h>>>0,y||wt(i,s,h,4),r.write(i,s,h,d,23,4),h+4}a.prototype.writeFloatLE=function(i,s,h){return X(this,i,s,!0,h)},a.prototype.writeFloatBE=function(i,s,h){return X(this,i,s,!1,h)};function ot(i,s,h,d,y){return s=+s,h=h>>>0,y||wt(i,s,h,8),r.write(i,s,h,d,52,8),h+8}a.prototype.writeDoubleLE=function(i,s,h){return ot(this,i,s,!0,h)},a.prototype.writeDoubleBE=function(i,s,h){return ot(this,i,s,!1,h)},a.prototype.copy=function(i,s,h,d){if(!a.isBuffer(i))throw new TypeError("argument should be a Buffer");if(h||(h=0),!d&&d!==0&&(d=this.length),s>=i.length&&(s=i.length),s||(s=0),d>0&&d<h&&(d=h),d===h||i.length===0||this.length===0)return 0;if(s<0)throw new RangeError("targetStart out of bounds");if(h<0||h>=this.length)throw new RangeError("Index out of range");if(d<0)throw new RangeError("sourceEnd out of bounds");d>this.length&&(d=this.length),i.length-s<d-h&&(d=i.length-s+h);const y=d-h;return this===i&&typeof f.prototype.copyWithin=="function"?this.copyWithin(s,h,d):f.prototype.set.call(i,this.subarray(h,d),s),y},a.prototype.fill=function(i,s,h,d){if(typeof i=="string"){if(typeof s=="string"?(d=s,s=0,h=this.length):typeof h=="string"&&(d=h,h=this.length),d!==void 0&&typeof d!="string")throw new TypeError("encoding must be a string");if(typeof d=="string"&&!a.isEncoding(d))throw new TypeError("Unknown encoding: "+d);if(i.length===1){const b=i.charCodeAt(0);(d==="utf8"&&b<128||d==="latin1")&&(i=b)}}else typeof i=="number"?i=i&255:typeof i=="boolean"&&(i=Number(i));if(s<0||this.length<s||this.length<h)throw new RangeError("Out of range index");if(h<=s)return this;s=s>>>0,h=h===void 0?this.length:h>>>0,i||(i=0);let y;if(typeof i=="number")for(y=s;y<h;++y)this[y]=i;else{const b=a.isBuffer(i)?i:a.from(i,d),P=b.length;if(P===0)throw new TypeError('The value "'+i+'" is invalid for argument "value"');for(y=0;y<h-s;++y)this[y+s]=b[y%P]}return this};const Et={};function ee(i,s,h){Et[i]=class extends h{constructor(){super(),Object.defineProperty(this,"message",{value:s.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${i}]`,this.stack,delete this.name}get code(){return i}set code(d){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:d,writable:!0})}toString(){return`${this.name} [${i}]: ${this.message}`}}}ee("ERR_BUFFER_OUT_OF_BOUNDS",function(i){return i?`${i} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),ee("ERR_INVALID_ARG_TYPE",function(i,s){return`The "${i}" argument must be of type number. Received type ${typeof s}`},TypeError),ee("ERR_OUT_OF_RANGE",function(i,s,h){let d=`The value of "${i}" is out of range.`,y=h;return Number.isInteger(h)&&Math.abs(h)>2**32?y=de(String(h)):typeof h=="bigint"&&(y=String(h),(h>BigInt(2)**BigInt(32)||h<-(BigInt(2)**BigInt(32)))&&(y=de(y)),y+="n"),d+=` It must be ${s}. Received ${y}`,d},RangeError);function de(i){let s="",h=i.length;const d=i[0]==="-"?1:0;for(;h>=d+4;h-=3)s=`_${i.slice(h-3,h)}${s}`;return`${i.slice(0,h)}${s}`}function Hi(i,s,h){re(s,"offset"),(i[s]===void 0||i[s+h]===void 0)&&pe(s,i.length-(h+1))}function $r(i,s,h,d,y,b){if(i>h||i<s){const P=typeof s=="bigint"?"n":"";let z;throw s===0||s===BigInt(0)?z=`>= 0${P} and < 2${P} ** ${(b+1)*8}${P}`:z=`>= -(2${P} ** ${(b+1)*8-1}${P}) and < 2 ** ${(b+1)*8-1}${P}`,new Et.ERR_OUT_OF_RANGE("value",z,i)}Hi(d,y,b)}function re(i,s){if(typeof i!="number")throw new Et.ERR_INVALID_ARG_TYPE(s,"number",i)}function pe(i,s,h){throw Math.floor(i)!==i?(re(i,h),new Et.ERR_OUT_OF_RANGE("offset","an integer",i)):s<0?new Et.ERR_BUFFER_OUT_OF_BOUNDS:new Et.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${s}`,i)}const Di=/[^+/0-9A-Za-z-_]/g;function Vi(i){if(i=i.split("=")[0],i=i.trim().replace(Di,""),i.length<2)return"";for(;i.length%4!==0;)i=i+"=";return i}function nr(i,s){s=s||1/0;let h;const d=i.length;let y=null;const b=[];for(let P=0;P<d;++P){if(h=i.charCodeAt(P),h>55295&&h<57344){if(!y){if(h>56319){(s-=3)>-1&&b.push(239,191,189);continue}else if(P+1===d){(s-=3)>-1&&b.push(239,191,189);continue}y=h;continue}if(h<56320){(s-=3)>-1&&b.push(239,191,189),y=h;continue}h=(y-55296<<10|h-56320)+65536}else y&&(s-=3)>-1&&b.push(239,191,189);if(y=null,h<128){if((s-=1)<0)break;b.push(h)}else if(h<2048){if((s-=2)<0)break;b.push(h>>6|192,h&63|128)}else if(h<65536){if((s-=3)<0)break;b.push(h>>12|224,h>>6&63|128,h&63|128)}else if(h<1114112){if((s-=4)<0)break;b.push(h>>18|240,h>>12&63|128,h>>6&63|128,h&63|128)}else throw new Error("Invalid code point")}return b}function Mi(i){const s=[];for(let h=0;h<i.length;++h)s.push(i.charCodeAt(h)&255);return s}function Fi(i,s){let h,d,y;const b=[];for(let P=0;P<i.length&&!((s-=2)<0);++P)h=i.charCodeAt(P),d=h>>8,y=h%256,b.push(y),b.push(d);return b}function Gr(i){return t.toByteArray(Vi(i))}function Be(i,s,h,d){let y;for(y=0;y<d&&!(y+h>=s.length||y>=i.length);++y)s[y+h]=i[y];return y}function Pt(i,s){return i instanceof s||i!=null&&i.constructor!=null&&i.constructor.name!=null&&i.constructor.name===s.name}function ir(i){return i!==i}const Ki=(function(){const i="0123456789abcdef",s=new Array(256);for(let h=0;h<16;++h){const d=h*16;for(let y=0;y<16;++y)s[d+y]=i[h]+i[y]}return s})();function Ct(i){return typeof BigInt>"u"?$i:i}function $i(){throw new Error("BigInt not supported")}})(Fn);const Hs=Fn.Buffer;function Ds(e){return e>2147483647?5:e>8388607?4:e>32767?3:e>127?2:e>0?1:0}function Vs(e){let t=Math.abs(e);const r=Ds(t),n=Hs.allocUnsafe(r),o=e<0;for(let f=0;f<r;++f)n.writeUInt8(t&255,f),t>>=8;return n[r-1]&128?n.writeUInt8(o?128:0,r-1):o&&(n[r-1]=n[r-1]|128),n}const yr=ae("fffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f");ae("fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141");const Xt=254;function Ms(e){return typeof e=="number"&&Number.isFinite(e)}function Rr(e){return Array.isArray(e)}function Fs(e){return!(e instanceof Uint8Array)||e.length!==32||wr(e)?!1:oe(e,yr)<0}function he(e){if(!(e instanceof Uint8Array)||e.length<33)return!1;const t=e[0],r=e.subarray(1,33);if(wr(r)||oe(r,yr)>=0)return!1;if((t===2||t===3)&&e.length===33)return!0;if(e.length!==65)return!1;const n=e.subarray(33);return wr(n)||oe(n,yr)>=0?!1:t===4||t===6||t===7}function Ks(e){if(!e||typeof e!="object")return!1;const t=e;return!(!("output"in t)||!(t.output instanceof Uint8Array)||t.version!==void 0&&(typeof t.version!="number"||(t.version&Xt)!==t.version))}function Jt(e,t){return e.length!==t.length?!1:e.every((r,n)=>M(r,t[n]))}function $s(e){return e instanceof Uint8Array&&e.length===32}function Gs(e){if(!$s(e))throw new TypeError(`Expected 32-byte Uint8Array, got ${e.length} bytes`);return e}function js(e){const t=e&-129;return t>0&&t<4}const $n=q.OP_RESERVED;function qs(e){return Ms(e)&&(e===q.OP_0||e>=q.OP_1&&e<=q.OP_16||e===q.OP_1NEGATE)}function Gn(e){return e instanceof Uint8Array?!0:qs(e)}function xr(e){return Rr(e)&&e.every(Gn)}function jn(e){return e.length-e.filter(Gn).length}function gr(e){if(e.length===0)return q.OP_0;if(e.length!==1)return;const t=e[0];if(t>=1&&t<=16)return $n+t;if(t===129)return q.OP_1NEGATE}function qn(e){return e instanceof Uint8Array}function Ys(e){return Rr(e)}function br(e){return e instanceof Uint8Array}function at(e){if(qn(e))return e;if(!Rr(e))throw new TypeError("Expected an array");const t=e.reduce((o,f)=>br(f)?f.length===1&&gr(f)!==void 0?o+1:o+Mn(f.length)+f.length:o+1,0),r=new Uint8Array(t);let n=0;if(e.forEach(o=>{if(br(o)){const f=gr(o);if(f!==void 0){r[n]=f,n+=1;return}n+=Bs(r,o.length,n),r.set(o,n),n+=o.length}else r[n]=o,n+=1}),n!==r.length)throw new Error("Could not decode chunks");return r}function ht(e){if(Ys(e))return e;if(!(e instanceof Uint8Array))throw new TypeError("Expected a Uint8Array");const t=[];let r=0;for(;r<e.length;){const n=e[r];if(n>q.OP_0&&n<=q.OP_PUSHDATA4){const o=ks(e,r);if(o===null||(r+=o.size,r+o.number>e.length))return null;const f=e.subarray(r,r+o.number);r+=o.number;const u=gr(f);u!==void 0?t.push(u):t.push(f)}else t.push(n),r+=1}return t}function Ws(e){const t=qn(e)?ht(e):e;if(!t||!xr(t))throw new TypeError("Expected push-only script");return t.map(r=>br(r)?r:r===q.OP_0?ce(0):Vs(r-$n))}function Qe(e){return!(e instanceof Uint8Array)||!js(e[e.length-1])?!1:Ts(e.subarray(0,-1))}const it={P2PK:"p2pk",P2PKH:"p2pkh",P2SH:"p2sh",P2MS:"p2ms",P2WPKH:"p2wpkh",P2WSH:"p2wsh",P2TR:"p2tr",P2MR:"p2mr",P2OP:"p2op",Embed:"embed"},Wr=q,Zr=16,Xr=2,zr=40;class ye{static NAME=it.P2OP;#o;#a;#n;#s;#e;#t;#r;#i;#f;#u;#h;#c;#w=!1;#y=!1;#g=!1;#l=!1;#d=!1;#p;#m=!1;constructor(t,r){this.#o=t.network??Ot,this.#a={validate:r?.validate??!0,allowIncomplete:r?.allowIncomplete??!1},this.#n=t.address,this.#s=t.program,this.#e=t.deploymentVersion,this.#t=t.hash160,this.#r=t.output,this.#a.validate&&this.#I()}get name(){return it.P2OP}get network(){return this.#o}get address(){return this.#w||(this.#i=this.#A(),this.#w=!0),this.#i}get program(){return this.#y||(this.#f=this.#b(),this.#y=!0),this.#f}get deploymentVersion(){return this.#g||(this.#u=this.#P(),this.#g=!0),this.#u}get hash160(){return this.#l||(this.#h=this.#O(),this.#l=!0),this.#h}get output(){return this.#d||(this.#c=this.#T(),this.#d=!0),this.#c}static fromProgram(t,r){return new ye({program:t,network:r})}static fromParts(t,r,n){return new ye({deploymentVersion:t,hash160:r,network:n})}static fromAddress(t,r){return new ye({address:t,network:r})}static fromOutput(t,r){return new ye({output:t,network:r})}toPayment(){return{name:this.name,network:this.network,address:this.address,program:this.program,deploymentVersion:this.deploymentVersion,hash160:this.hash160,output:this.output}}#E(){if(!this.#m){if(this.#n){const t=Br(this.#n);t&&(this.#p={version:t.version,prefix:t.prefix,data:t.data})}this.#m=!0}return this.#p}#v(){if(typeof this.#e<"u"&&typeof this.#t<"u"){if(this.#t.length!==20)throw new TypeError("hash160 must be exactly 20 bytes");if(this.#e<0||this.#e>255)throw new TypeError("deploymentVersion must fit in one byte");return Nt([new Uint8Array([this.#e]),this.#t])}}#A(){if(this.#n)return this.#n;const t=this.program;if(!t)return;if(!this.#o.bech32Opnet)throw new TypeError("Network does not support opnet");const r=ut.bech32m.toWords(t);return r.unshift(Zr),ut.bech32m.encode(this.#o.bech32Opnet,r)}#b(){if(this.#s)return this.#s;const t=this.#v();if(t)return t;if(this.#r){if(this.#r[0]!==Wr.OP_16)throw new TypeError("Invalid P2OP script");let r=1,n;const o=this.#r[1],f=this.#r[2];if(o!==void 0&&o<76)n=o,r=2;else if(o===76&&f!==void 0)n=f,r=3;else throw new TypeError("Unsupported push opcode in P2OP script");return this.#r.subarray(r,r+n)}if(this.#n)return this.#E()?.data}#P(){if(this.#e!==void 0)return this.#e;const t=this.program;if(t)return t[0]}#O(){if(this.#t)return this.#t;const t=this.program;if(t)return t.subarray(1)}#T(){if(this.#r)return this.#r;const t=this.program;if(t)return at([Wr.OP_16,t])}#I(){let t=ce(0);if(this.#n){const r=this.#E();if(!r)throw new TypeError("Invalid address");if(this.#o.bech32Opnet!==r.prefix)throw new TypeError("Invalid prefix or network mismatch");if(r.version!==Zr)throw new TypeError("Invalid witness version for p2op");if(r.data.length<Xr||r.data.length>zr)throw new TypeError("Invalid witness program length");t=r.data}if(this.#s){if(t.length>0&&!M(t,this.#s))throw new TypeError("Program mismatch");t=this.#s}if(!t.length&&this.#e!==void 0&&this.#t){const r=this.#v();r&&(t=r)}if(this.#r){const r=this.program;if(!r)throw new TypeError("Output program is required");if(t.length>0&&!M(t,r))throw new TypeError("Program mismatch (output vs other source)");t=r}if(t.length<Xr||t.length>zr)throw new TypeError(`Witness program must be 240 bytes. Was ${t.length} bytes`);if(this.#e!==void 0&&this.#e!==t[0])throw new TypeError("deploymentVersion mismatch");if(this.#t&&!M(this.#t,t.subarray(1)))throw new TypeError("hash160 mismatch")}}const Zs=Uint8Array.from([7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8]),Yn=Uint8Array.from(new Array(16).fill(0).map((e,t)=>t)),Xs=Yn.map(e=>(9*e+5)%16),Wn=(()=>{const e=[[Yn],[Xs]];for(let t=0;t<4;t++)for(let r of e)r.push(r[t].map(n=>Zs[n]));return e})(),Zn=Wn[0],Xn=Wn[1],zn=[[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8],[12,13,11,15,6,9,9,7,12,15,11,13,7,8,7,7],[13,15,14,11,7,7,6,8,13,14,13,12,5,5,6,9],[14,11,12,14,8,6,5,5,15,12,15,14,9,9,8,6],[15,12,13,13,9,5,8,6,14,11,12,11,8,6,5,5]].map(e=>Uint8Array.from(e)),zs=Zn.map((e,t)=>e.map(r=>zn[t][r])),Qs=Xn.map((e,t)=>e.map(r=>zn[t][r])),Js=Uint32Array.from([0,1518500249,1859775393,2400959708,2840853838]),to=Uint32Array.from([1352829926,1548603684,1836072691,2053994217,0]);function Qr(e,t,r,n){return e===0?t^r^n:e===1?t&r|~t&n:e===2?(t|~r)^n:e===3?t&n|r&~n:t^(r|~n)}const Re=new Uint32Array(16);class eo extends Hn{h0=1732584193;h1=-271733879;h2=-1732584194;h3=271733878;h4=-1009589776;constructor(){super(64,20,8,!0)}get(){const{h0:t,h1:r,h2:n,h3:o,h4:f}=this;return[t,r,n,o,f]}set(t,r,n,o,f){this.h0=t|0,this.h1=r|0,this.h2=n|0,this.h3=o|0,this.h4=f|0}process(t,r){for(let g=0;g<16;g++,r+=4)Re[g]=t.getUint32(r,!0);let n=this.h0|0,o=n,f=this.h1|0,u=f,c=this.h2|0,p=c,l=this.h3|0,a=l,w=this.h4|0,m=w;for(let g=0;g<5;g++){const v=4-g,E=Js[g],T=to[g],U=Zn[g],k=Xn[g],R=zs[g],N=Qs[g];for(let $=0;$<16;$++){const J=ke(n+Qr(g,f,c,l)+Re[U[$]]+E,R[$])+w|0;n=w,w=l,l=ke(c,10)|0,c=f,f=J}for(let $=0;$<16;$++){const J=ke(o+Qr(v,u,p,a)+Re[k[$]]+T,N[$])+m|0;o=m,m=a,a=ke(p,10)|0,p=u,u=J}}this.set(this.h1+c+a|0,this.h2+l+m|0,this.h3+w+o|0,this.h4+n+u|0,this.h0+f+p|0)}roundClean(){Oe(Re)}destroy(){this.destroyed=!0,Oe(this.buffer),this.set(0,0,0,0,0)}}const ro=Cn(()=>new eo);function mr(e){return Me(e)}function At(e){return ro(Me(e))}const no={"BIP0340/challenge":new Uint8Array([123,181,45,122,159,239,88,50,62,177,191,122,64,125,179,130,210,243,242,216,27,177,34,79,73,254,81,143,109,72,211,124,123,181,45,122,159,239,88,50,62,177,191,122,64,125,179,130,210,243,242,216,27,177,34,79,73,254,81,143,109,72,211,124]),"BIP0340/aux":new Uint8Array([241,239,78,94,192,99,202,218,109,148,202,250,157,152,126,160,105,38,88,57,236,193,31,151,45,119,165,46,216,193,204,144,241,239,78,94,192,99,202,218,109,148,202,250,157,152,126,160,105,38,88,57,236,193,31,151,45,119,165,46,216,193,204,144]),"BIP0340/nonce":new Uint8Array([7,73,119,52,167,155,203,53,91,155,140,125,3,79,18,28,244,52,215,62,247,45,218,25,135,0,97,251,82,191,235,47,7,73,119,52,167,155,203,53,91,155,140,125,3,79,18,28,244,52,215,62,247,45,218,25,135,0,97,251,82,191,235,47]),TapLeaf:new Uint8Array([174,234,143,220,66,8,152,49,5,115,75,88,8,29,30,38,56,211,95,28,181,64,8,212,211,87,202,3,190,120,233,238,174,234,143,220,66,8,152,49,5,115,75,88,8,29,30,38,56,211,95,28,181,64,8,212,211,87,202,3,190,120,233,238]),TapBranch:new Uint8Array([25,65,161,242,229,110,185,95,162,169,241,148,190,92,1,247,33,111,51,237,130,176,145,70,52,144,208,91,245,22,160,21,25,65,161,242,229,110,185,95,162,169,241,148,190,92,1,247,33,111,51,237,130,176,145,70,52,144,208,91,245,22,160,21]),TapSighash:new Uint8Array([244,10,72,223,75,42,112,200,180,146,75,242,101,70,97,237,61,149,253,102,163,19,235,135,35,117,151,198,40,228,160,49,244,10,72,223,75,42,112,200,180,146,75,242,101,70,97,237,61,149,253,102,163,19,235,135,35,117,151,198,40,228,160,49]),TapTweak:new Uint8Array([232,15,225,99,156,156,160,80,227,175,27,57,193,67,198,62,66,156,188,235,21,217,64,251,181,197,161,244,175,87,197,233,232,15,225,99,156,156,160,80,227,175,27,57,193,67,198,62,66,156,188,235,21,217,64,251,181,197,161,244,175,87,197,233]),"KeyAgg list":new Uint8Array([72,28,151,28,60,11,70,215,240,178,117,174,89,141,78,44,126,215,49,156,89,74,92,110,199,158,160,212,153,2,148,240,72,28,151,28,60,11,70,215,240,178,117,174,89,141,78,44,126,215,49,156,89,74,92,110,199,158,160,212,153,2,148,240]),"KeyAgg coefficient":new Uint8Array([191,201,4,3,77,28,136,232,200,14,34,229,61,36,86,109,100,130,78,214,66,114,129,192,145,0,249,77,205,82,201,129,191,201,4,3,77,28,136,232,200,14,34,229,61,36,86,109,100,130,78,214,66,114,129,192,145,0,249,77,205,82,201,129])};function Sr(e,t){return mr(Nt([no[e],t]))}const Qn={p:0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2fn,n:0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141n,h:1n,a:0n,b:7n,Gx:0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798n,Gy:0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8n},{p:zt,n:io,Gx:so,Gy:oo,b:Jn}=Qn,Er=32,_r=64,ho={publicKey:Er+1,publicKeyUncompressed:_r+1},fo=(...e)=>{"captureStackTrace"in Error&&typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(...e)},pt=(e="")=>{const t=new Error(e);throw fo(t,pt),t},uo=e=>typeof e=="bigint",ao=e=>typeof e=="string",co=e=>e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array",Nr=(e,t,r="")=>{const n=co(e),o=e?.length;if(!n||t!==void 0){const u=r&&`"${r}" `,c="",p=n?`length=${o}`:`type=${typeof e}`;pt(u+"expected Uint8Array"+c+", got "+p)}return e},ti=e=>new Uint8Array(e),ei=(e,t)=>e.toString(16).padStart(t,"0"),ri=e=>Array.from(Nr(e)).map(t=>ei(t,2)).join(""),Ut={_0:48,_9:57,A:65,F:70,a:97,f:102},Jr=e=>{if(e>=Ut._0&&e<=Ut._9)return e-Ut._0;if(e>=Ut.A&&e<=Ut.F)return e-(Ut.A-10);if(e>=Ut.a&&e<=Ut.f)return e-(Ut.a-10)},ni=e=>{const t="hex invalid";if(!ao(e))return pt(t);const r=e.length,n=r/2;if(r%2)return pt(t);const o=ti(n);for(let f=0,u=0;f<n;f++,u+=2){const c=Jr(e.charCodeAt(u)),p=Jr(e.charCodeAt(u+1));if(c===void 0||p===void 0)return pt(t);o[f]=c*16+p}return o},tn=(...e)=>{const t=ti(e.reduce((n,o)=>n+Nr(o).length,0));let r=0;return e.forEach(n=>{t.set(n,r),r+=n.length}),t},Fe=BigInt,Je=(e,t,r,n="bad number: out of range")=>uo(e)&&t<=e&&e<r?e:pt(n),x=(e,t=zt)=>{const r=e%t;return r>=0n?r:t+r},lo=(e,t)=>{(e===0n||t<=0n)&&pt("no inverse n="+e+" mod="+t);let r=x(e,t),n=t,o=0n,f=1n;for(;r!==0n;){const u=n/r,c=n%r,p=o-f*u;n=r,r=c,o=f,f=p}return n===1n?x(o,t):pt("no inverse")},fr=e=>e instanceof le?e:pt("Point expected"),ii=e=>x(x(e*e)*e+Jn),en=e=>Je(e,0n,zt),Ce=e=>Je(e,1n,zt),po=e=>Je(e,1n,io),vr=e=>(e&1n)===0n,si=e=>Uint8Array.of(e),wo=e=>si(vr(e)?2:3),yo=e=>{const t=ii(Ce(e));let r=1n;for(let n=t,o=(zt+1n)/4n;o>0n;o>>=1n)o&1n&&(r=r*n%zt),n=n*n%zt;return x(r*r)===t?r:pt("sqrt invalid")};let le=class qt{static BASE;static ZERO;X;Y;Z;constructor(t,r,n){this.X=en(t),this.Y=Ce(r),this.Z=en(n),Object.freeze(this)}static CURVE(){return Qn}static fromAffine(t){const{x:r,y:n}=t;return r===0n&&n===0n?Yt:new qt(r,n,1n)}static fromBytes(t){Nr(t);const{publicKey:r,publicKeyUncompressed:n}=ho;let o;const f=t.length,u=t[0],c=t.subarray(1),p=rn(c,0,Er);if(f===r&&(u===2||u===3)){let l=yo(p);const a=vr(l);vr(Fe(u))!==a&&(l=x(-l)),o=new qt(p,l,1n)}return f===n&&u===4&&(o=new qt(p,rn(c,Er,_r),1n)),o?o.assertValidity():pt("bad point: not on curve")}static fromHex(t){return qt.fromBytes(ni(t))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}equals(t){const{X:r,Y:n,Z:o}=this,{X:f,Y:u,Z:c}=fr(t),p=x(r*c),l=x(f*o),a=x(n*c),w=x(u*o);return p===l&&a===w}is0(){return this.equals(Yt)}negate(){return new qt(this.X,x(-this.Y),this.Z)}double(){return this.add(this)}add(t){const{X:r,Y:n,Z:o}=this,{X:f,Y:u,Z:c}=fr(t),p=0n,l=Jn;let a=0n,w=0n,m=0n;const g=x(l*3n);let v=x(r*f),E=x(n*u),T=x(o*c),U=x(r+n),k=x(f+u);U=x(U*k),k=x(v+E),U=x(U-k),k=x(r+o);let R=x(f+c);return k=x(k*R),R=x(v+T),k=x(k-R),R=x(n+o),a=x(u+c),R=x(R*a),a=x(E+T),R=x(R-a),m=x(p*k),a=x(g*T),m=x(a+m),a=x(E-m),m=x(E+m),w=x(a*m),E=x(v+v),E=x(E+v),T=x(p*T),k=x(g*k),E=x(E+T),T=x(v-T),T=x(p*T),k=x(k+T),v=x(E*k),w=x(w+v),v=x(R*k),a=x(U*a),a=x(a-v),v=x(U*E),m=x(R*m),m=x(m+v),new qt(a,w,m)}subtract(t){return this.add(fr(t).negate())}multiply(t,r=!0){if(!r&&t===0n)return Yt;if(po(t),t===1n)return this;if(this.equals(Pe))return vo(t).p;let n=Yt,o=Pe;for(let f=this;t>0n;f=f.double(),t>>=1n)t&1n?n=n.add(f):r&&(o=o.add(f));return n}multiplyUnsafe(t){return this.multiply(t,!1)}toAffine(){const{X:t,Y:r,Z:n}=this;if(this.equals(Yt))return{x:0n,y:0n};if(n===1n)return{x:t,y:r};const o=lo(n,zt);return x(n*o)!==1n&&pt("inverse invalid"),{x:x(t*o),y:x(r*o)}}assertValidity(){const{x:t,y:r}=this.toAffine();return Ce(t),Ce(r),x(r*r)===ii(t)?this:pt("bad point: not on curve")}toBytes(t=!0){const{x:r,y:n}=this.assertValidity().toAffine(),o=nn(r);return t?tn(wo(n),o):tn(si(4),o,nn(n))}toHex(t){return ri(this.toBytes(t))}};const Pe=new le(so,oo,1n),Yt=new le(0n,1n,0n);le.BASE=Pe;le.ZERO=Yt;const go=e=>Fe("0x"+(ri(e)||"0")),rn=(e,t,r)=>go(e.subarray(t,r)),bo=2n**256n,nn=e=>ni(ei(Je(e,0n,bo),_r)),Ke=8,mo=256,oi=Math.ceil(mo/Ke)+1,Ar=2**(Ke-1),Eo=()=>{const e=[];let t=Pe,r=t;for(let n=0;n<oi;n++){r=t,e.push(r);for(let o=1;o<Ar;o++)r=r.add(t),e.push(r);t=r.double()}return e};let sn;const on=(e,t)=>{const r=t.negate();return e?r:t},vo=e=>{const t=sn||(sn=Eo());let r=Yt,n=Pe;const o=2**Ke,f=o,u=Fe(o-1),c=Fe(Ke);for(let p=0;p<oi;p++){let l=Number(e&u);e>>=c,l>Ar&&(l-=f,e+=1n);const a=p*Ar,w=a,m=a+Math.abs(l)-1,g=p%2!==0,v=l<0;l===0?n=n.add(on(g,t[w])):r=r.add(on(v,t[m]))}return e!==0n&&pt("invalid wnaf"),{p:r,f:n}};function hn(e){let t=e.toString(16);return t=t.padStart(64,"0"),t.length>64&&(t=t.slice(-64)),ae(t)}function fn(e){if(e.length===32)return;if(![33,65].includes(e.length)){console.warn(`Unsupported key length=${e.length}. Must be 33 (compressed) or 65 (uncompressed).`);return}let t;try{t=le.fromHex(ls(e))}catch(c){throw new Error("Invalid secp256k1 public key bytes. Cannot parse.",{cause:c})}const r=hn(t.x),n=hn(t.y),o=t.y%2n===0n?6:7,f=ce(65);f[0]=o,f.set(r,1),f.set(n,33);const u=Nt([new Uint8Array([4]),r,n]);return{hybrid:f,uncompressed:u}}const Vt=q;class ge{static NAME=it.P2PKH;#o;#a;#n;#s;#e;#t;#r;#i;#f=!1;#u=!1;#h;#c;#w;#y;#g;#l;#d;#p=!1;#m=!1;#E=!1;#v=!1;#A=!1;#b=!1;#P=!1;#O;#T=!1;#I;#U=!1;constructor(t,r){this.#o=t.network??Ot,this.#a={validate:r?.validate??!0,allowIncomplete:r?.allowIncomplete??!1},this.#n=t.address,this.#s=t.hash,this.#e=t.pubkey,this.#t=t.signature,this.#r=t.output,this.#i=t.input,this.#f=t.useHybrid??!1,this.#u=t.useUncompressed??!1,this.#a.validate&&this.#H()}get name(){return it.P2PKH}get network(){return this.#o}get address(){return this.#p||(this.#h=this.#R(),this.#p=!0),this.#h}get hash(){return this.#m||(this.#c=this.#x(),this.#m=!0),this.#c}get pubkey(){return this.#E||(this.#w=this.#S(),this.#E=!0),this.#w}get signature(){return this.#v||(this.#y=this.#_(),this.#v=!0),this.#y}get output(){return this.#A||(this.#g=this.#N(),this.#A=!0),this.#g}get input(){return this.#b||(this.#l=this.#L(),this.#b=!0),this.#l}get witness(){return this.#P||(this.#d=this.#C(),this.#P=!0),this.#d}static fromPubkey(t,r){return new ge({pubkey:t,network:r})}static fromAddress(t,r){return new ge({address:t,network:r})}static fromHash(t,r){return new ge({hash:t,network:r})}static fromOutput(t,r){return new ge({output:t,network:r})}toPayment(){return{name:this.name,network:this.network,address:this.address,hash:this.hash,pubkey:this.pubkey,signature:this.signature,output:this.output,input:this.input,witness:this.witness}}#B(){if(!this.#T){if(this.#n){const t=new Uint8Array(Vn(this.#n));this.#O={version:t[0],hash:t.subarray(1)}}this.#T=!0}return this.#O}#k(){return this.#U||(this.#i&&(this.#I=ht(this.#i)??void 0),this.#U=!0),this.#I}#R(){if(this.#n)return this.#n;const t=this.hash;if(!t)return;const r=ce(21);return r[0]=this.#o.pubKeyHash,r.set(t,1),Dn(r)}#x(){if(this.#s)return this.#s;if(this.#r)return this.#r.subarray(3,23);if(this.#n)return this.#B()?.hash;const t=this.pubkey;if(t)return At(t)}#S(){if(this.#e)return this.#e;if(this.#i){const t=this.#k();if(t&&t.length>=2)return t[1]}}#_(){if(this.#t)return this.#t;if(this.#i){const t=this.#k();if(t&&t.length>=1)return t[0]}}#N(){if(this.#r)return this.#r;const t=this.hash;if(t)return at([Vt.OP_DUP,Vt.OP_HASH160,t,Vt.OP_EQUALVERIFY,Vt.OP_CHECKSIG])}#L(){if(this.#i)return this.#i;if(!this.#e||!this.#t)return;let t=this.#e;if(this.#f||this.#u){const r=fn(this.#e);r&&(this.#u?t=r.uncompressed:t=r.hybrid)}return at([this.#t,t])}#C(){if(this.input)return[]}#H(){let t=new Uint8Array(0);if(this.#n){const r=this.#B();if(!r)throw new TypeError("Invalid address");if(r.version!==this.#o.pubKeyHash)throw new TypeError("Invalid version or Network mismatch");if(r.hash.length!==20)throw new TypeError("Invalid address");t=r.hash}if(this.#s){if(t.length>0&&!M(t,this.#s))throw new TypeError("Hash mismatch");t=this.#s}if(this.#r){if(this.#r.length!==25||this.#r[0]!==Vt.OP_DUP||this.#r[1]!==Vt.OP_HASH160||this.#r[2]!==20||this.#r[23]!==Vt.OP_EQUALVERIFY||this.#r[24]!==Vt.OP_CHECKSIG)throw new TypeError("Output is invalid");const r=this.#r.subarray(3,23);if(t.length>0&&!M(t,r))throw new TypeError("Hash mismatch");t=r}if(this.#e){const r=At(this.#e);let n=t.length>0&&!M(t,r);if(n&&(this.#e.length===33&&(this.#e[0]===2||this.#e[0]===3)||this.#e.length===65&&this.#e[0]===4)){const o=fn(this.#e);if(o){const f=At(o.uncompressed);if(M(t,f))n=!1,this.#u=!0;else{const u=At(o.hybrid);n=!M(t,u),n||(this.#f=!0)}}}if(n)throw new TypeError("Hash mismatch");t=r}if(this.#i){const r=this.#k();if(!r||r.length!==2)throw new TypeError("Input is invalid");if(!Qe(r[0]))throw new TypeError("Input has invalid signature");if(!he(r[1]))throw new TypeError("Input has invalid pubkey");if(this.#t&&!M(this.#t,r[0]))throw new TypeError("Signature mismatch");if(this.#e&&!M(this.#e,r[1]))throw new TypeError("Pubkey mismatch");const n=At(r[1]);if(t.length>0&&!M(t,n))throw new TypeError("Hash mismatch (input)")}}}const we=q;class be{static NAME=it.P2SH;#o;#a;#n;#s;#e;#t;#r;#i;#f;#u;#h;#c;#w;#y;#g=!1;#l=!1;#d=!1;#p=!1;#m=!1;#E=!1;#v;#A=!1;#b;#P=!1;#O;#T=!1;constructor(t,r){let n=t.network;n||(n=t.redeem&&t.redeem.network||Ot),this.#o=n,this.#a={validate:r?.validate??!0,allowIncomplete:r?.allowIncomplete??!1},this.#n=t.address,this.#s=t.hash,this.#e=t.output,this.#t=t.input,this.#r=t.redeem,this.#i=t.witness,this.#a.validate&&this.#C()}get name(){const t=this.redeem;return t!==void 0&&t.name!==void 0?`p2sh-${t.name}`:it.P2SH}get network(){return this.#o}get address(){return this.#g||(this.#f=this.#k(),this.#g=!0),this.#f}get hash(){return this.#l||(this.#u=this.#R(),this.#l=!0),this.#u}get output(){return this.#d||(this.#h=this.#x(),this.#d=!0),this.#h}get input(){return this.#p||(this.#c=this.#S(),this.#p=!0),this.#c}get redeem(){return this.#m||(this.#w=this.#_(),this.#m=!0),this.#w}get witness(){return this.#E||(this.#y=this.#N(),this.#E=!0),this.#y}static fromRedeem(t,r){return new be({redeem:t,network:r})}static fromAddress(t,r){return new be({address:t,network:r})}static fromHash(t,r){return new be({hash:t,network:r})}static fromOutput(t,r){return new be({output:t,network:r})}toPayment(){return{name:this.name,network:this.network,address:this.address,hash:this.hash,output:this.output,input:this.input,redeem:this.redeem,witness:this.witness}}#I(){if(!this.#A){if(this.#n){const t=new Uint8Array(Vn(this.#n));this.#v={version:t[0],hash:t.subarray(1)}}this.#A=!0}return this.#v}#U(){return this.#P||(this.#t&&(this.#b=ht(this.#t)??void 0),this.#P=!0),this.#b}#B(){if(!this.#T){const t=this.#U();if(t){const r=t[t.length-1];this.#O={network:this.#o,output:r===we.OP_FALSE?new Uint8Array(0):r,input:at(t.slice(0,-1)),witness:this.#i||[]}}this.#T=!0}return this.#O}#k(){if(this.#n)return this.#n;const t=this.hash;if(!t)return;const r=ce(21);return r[0]=this.#o.scriptHash,r.set(t,1),Dn(r)}#R(){if(this.#s)return this.#s;if(this.#e)return this.#e.subarray(2,22);if(this.#n)return this.#I()?.hash;const t=this.redeem;if(t&&t.output)return At(t.output)}#x(){if(this.#e)return this.#e;const t=this.hash;if(t)return at([we.OP_HASH160,t,we.OP_EQUAL])}#S(){if(this.#t)return this.#t;const t=this.#r;if(!(!t||!t.input||!t.output))return at([].concat(ht(t.input),t.output))}#_(){if(this.#r)return this.#r;if(this.#t)return this.#B()}#N(){if(this.#i)return this.#i;const t=this.redeem;if(t&&t.witness)return t.witness;if(this.input)return[]}#L(t){if(t.output){const r=ht(t.output);if(!r||r.length<1)throw new TypeError("Redeem.output too short");if(t.output.byteLength>520)throw new TypeError("Redeem.output unspendable if larger than 520 bytes");if(jn(r)>201)throw new TypeError("Redeem.output unspendable with more than 201 non-push ops")}if(t.input){const r=t.input.length>0,n=t.witness&&t.witness.length>0;if(!r&&!n)throw new TypeError("Empty input");if(r&&n)throw new TypeError("Input and witness provided");if(r){const o=ht(t.input);if(!xr(o))throw new TypeError("Non push-only scriptSig")}}}#C(){let t=new Uint8Array(0);if(this.#n){const r=this.#I();if(!r)throw new TypeError("Invalid address");if(r.version!==this.#o.scriptHash)throw new TypeError("Invalid version or Network mismatch");if(r.hash.length!==20)throw new TypeError("Invalid address");t=r.hash}if(this.#s){if(t.length>0&&!M(t,this.#s))throw new TypeError("Hash mismatch");t=this.#s}if(this.#e){if(this.#e.length!==23||this.#e[0]!==we.OP_HASH160||this.#e[1]!==20||this.#e[22]!==we.OP_EQUAL)throw new TypeError("Output is invalid");const r=this.#e.subarray(2,22);if(t.length>0&&!M(t,r))throw new TypeError("Hash mismatch");t=r}if(this.#t){const r=this.#U();if(!r||r.length<1)throw new TypeError("Input too short");const n=this.#B();if(!n||!(n.output instanceof Uint8Array))throw new TypeError("Input is invalid");if(this.#L(n),n.output){const o=At(n.output);if(t.length>0&&!M(t,o))throw new TypeError("Hash mismatch");t=o}}if(this.#r){if(this.#r.network&&this.#r.network!==this.#o)throw new TypeError("Network mismatch");if(this.#t){const r=this.#B();if(r){if(this.#r.output&&r.output&&!M(this.#r.output,r.output))throw new TypeError("Redeem.output mismatch");if(this.#r.input&&r.input&&!M(this.#r.input,r.input))throw new TypeError("Redeem.input mismatch")}}if(this.#L(this.#r),this.#r.output){const r=At(this.#r.output);if(t.length>0&&!M(t,r))throw new TypeError("Hash mismatch")}}if(this.#i&&this.#r&&this.#r.witness&&!Jt(this.#r.witness,this.#i))throw new TypeError("Witness and redeem.witness mismatch")}}function Ao(e){const t=e.length;if(t%2!==0)throw new TypeError("fromHexInternal: odd-length hex string");const r=new Uint8Array(t/2);for(let n=0;n<t;n+=2){const o=un(e.charCodeAt(n)),f=un(e.charCodeAt(n+1));if(o===-1||f===-1)throw new TypeError("fromHexInternal: invalid hex character");r[n>>1]=o<<4|f}return r}function un(e){return e>=48&&e<=57?e-48:e>=65&&e<=70?e-55:e>=97&&e<=102?e-87:-1}function lt(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function Lr(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function te(e,t=""){if(!Number.isSafeInteger(e)||e<0){const r=t&&`"${t}" `;throw new Error(`${r}expected integer >= 0, got ${e}`)}}function tt(e,t,r=""){const n=Lr(e),o=e?.length,f=t!==void 0;if(!n||f&&o!==t){const u=r&&`"${r}" `,c=f?` of length ${t}`:"",p=n?`length=${o}`:`type=${typeof e}`;throw new Error(u+"expected Uint8Array"+c+", got "+p)}return e}function hi(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash must wrapped by utils.createHasher");te(e.outputLen),te(e.blockLen)}function $e(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Oo(e,t){tt(e,void 0,"digestInto() output");const r=t.outputLen;if(e.length<r)throw new Error('"digestInto() output" expected to be of length >='+r)}function Ge(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function ur(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function It(e,t){return e<<32-t|e>>>t}const fi=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",Po=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function tr(e){if(tt(e),fi)return e.toHex();let t="";for(let r=0;r<e.length;r++)t+=Po[e[r]];return t}const Rt={_0:48,_9:57,A:65,F:70,a:97,f:102};function an(e){if(e>=Rt._0&&e<=Rt._9)return e-Rt._0;if(e>=Rt.A&&e<=Rt.F)return e-(Rt.A-10);if(e>=Rt.a&&e<=Rt.f)return e-(Rt.a-10)}function je(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);if(fi)return Uint8Array.fromHex(e);const t=e.length,r=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(r);for(let o=0,f=0;o<r;o++,f+=2){const u=an(e.charCodeAt(f)),c=an(e.charCodeAt(f+1));if(u===void 0||c===void 0){const p=e[f]+e[f+1];throw new Error('hex string expected, got non-hex character "'+p+'" at index '+f)}n[o]=u*16+c}return n}function Gt(...e){let t=0;for(let n=0;n<e.length;n++){const o=e[n];tt(o),t+=o.length}const r=new Uint8Array(t);for(let n=0,o=0;n<e.length;n++){const f=e[n];r.set(f,o),o+=f.length}return r}function To(e,t={}){const r=(o,f)=>e(f).update(o).digest(),n=e(void 0);return r.outputLen=n.outputLen,r.blockLen=n.blockLen,r.create=o=>e(o),Object.assign(r,t),Object.freeze(r)}function ui(e=32){const t=typeof globalThis=="object"?globalThis.crypto:null;if(typeof t?.getRandomValues!="function")throw new Error("crypto.getRandomValues must be defined");return t.getRandomValues(new Uint8Array(e))}const Io=e=>({oid:Uint8Array.from([6,9,96,134,72,1,101,3,4,2,e])});function Bo(e,t,r){return e&t^~e&r}function ko(e,t,r){return e&t^e&r^t&r}class Uo{blockLen;outputLen;padOffset;isLE;buffer;view;finished=!1;length=0;pos=0;destroyed=!1;constructor(t,r,n,o){this.blockLen=t,this.outputLen=r,this.padOffset=n,this.isLE=o,this.buffer=new Uint8Array(t),this.view=ur(this.buffer)}update(t){$e(this),tt(t);const{view:r,buffer:n,blockLen:o}=this,f=t.length;for(let u=0;u<f;){const c=Math.min(o-this.pos,f-u);if(c===o){const p=ur(t);for(;o<=f-u;u+=o)this.process(p,u);continue}n.set(t.subarray(u,u+c),this.pos),this.pos+=c,u+=c,this.pos===o&&(this.process(r,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){$e(this),Oo(t,this),this.finished=!0;const{buffer:r,view:n,blockLen:o,isLE:f}=this;let{pos:u}=this;r[u++]=128,Ge(this.buffer.subarray(u)),this.padOffset>o-u&&(this.process(n,0),u=0);for(let w=u;w<o;w++)r[w]=0;n.setBigUint64(o-8,BigInt(this.length*8),f),this.process(n,0);const c=ur(t),p=this.outputLen;if(p%4)throw new Error("_sha2: outputLen must be aligned to 32bit");const l=p/4,a=this.get();if(l>a.length)throw new Error("_sha2: outputLen bigger than state");for(let w=0;w<l;w++)c.setUint32(4*w,a[w],f)}digest(){const{buffer:t,outputLen:r}=this;this.digestInto(t);const n=t.slice(0,r);return this.destroy(),n}_cloneInto(t){t||=new this.constructor,t.set(...this.get());const{blockLen:r,buffer:n,length:o,finished:f,destroyed:u,pos:c}=this;return t.destroyed=u,t.finished=f,t.length=o,t.pos=c,o%r&&t.buffer.set(n),t}clone(){return this._cloneInto()}}const Mt=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Ro=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Ft=new Uint32Array(64);class xo extends Uo{constructor(t){super(64,t,8,!1)}get(){const{A:t,B:r,C:n,D:o,E:f,F:u,G:c,H:p}=this;return[t,r,n,o,f,u,c,p]}set(t,r,n,o,f,u,c,p){this.A=t|0,this.B=r|0,this.C=n|0,this.D=o|0,this.E=f|0,this.F=u|0,this.G=c|0,this.H=p|0}process(t,r){for(let w=0;w<16;w++,r+=4)Ft[w]=t.getUint32(r,!1);for(let w=16;w<64;w++){const m=Ft[w-15],g=Ft[w-2],v=It(m,7)^It(m,18)^m>>>3,E=It(g,17)^It(g,19)^g>>>10;Ft[w]=E+Ft[w-7]+v+Ft[w-16]|0}let{A:n,B:o,C:f,D:u,E:c,F:p,G:l,H:a}=this;for(let w=0;w<64;w++){const m=It(c,6)^It(c,11)^It(c,25),g=a+m+Bo(c,p,l)+Ro[w]+Ft[w]|0,v=(It(n,2)^It(n,13)^It(n,22))+ko(n,o,f)|0;a=l,l=p,p=c,c=u+g|0,u=f,f=o,o=n,n=g+v|0}n=n+this.A|0,o=o+this.B|0,f=f+this.C|0,u=u+this.D|0,c=c+this.E|0,p=p+this.F|0,l=l+this.G|0,a=a+this.H|0,this.set(n,o,f,u,c,p,l,a)}roundClean(){Ge(Ft)}destroy(){this.set(0,0,0,0,0,0,0,0),Ge(this.buffer)}}class So extends xo{A=Mt[0]|0;B=Mt[1]|0;C=Mt[2]|0;D=Mt[3]|0;E=Mt[4]|0;F=Mt[5]|0;G=Mt[6]|0;H=Mt[7]|0;constructor(){super(32)}}const _o=To(()=>new So,Io(1));function No(e){if(e.length>=255)throw new TypeError("Alphabet too long");const t=new Uint8Array(256);for(let l=0;l<t.length;l++)t[l]=255;for(let l=0;l<e.length;l++){const a=e.charAt(l),w=a.charCodeAt(0);if(t[w]!==255)throw new TypeError(a+" is ambiguous");t[w]=l}const r=e.length,n=e.charAt(0),o=Math.log(r)/Math.log(256),f=Math.log(256)/Math.log(r);function u(l){if(l instanceof Uint8Array||(ArrayBuffer.isView(l)?l=new Uint8Array(l.buffer,l.byteOffset,l.byteLength):Array.isArray(l)&&(l=Uint8Array.from(l))),!(l instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(l.length===0)return"";let a=0,w=0,m=0;const g=l.length;for(;m!==g&&l[m]===0;)m++,a++;const v=(g-m)*f+1>>>0,E=new Uint8Array(v);for(;m!==g;){let k=l[m],R=0;for(let N=v-1;(k!==0||R<w)&&N!==-1;N--,R++)k+=256*E[N]>>>0,E[N]=k%r>>>0,k=k/r>>>0;if(k!==0)throw new Error("Non-zero carry");w=R,m++}let T=v-w;for(;T!==v&&E[T]===0;)T++;let U=n.repeat(a);for(;T<v;++T)U+=e.charAt(E[T]);return U}function c(l){if(typeof l!="string")throw new TypeError("Expected String");if(l.length===0)return new Uint8Array;let a=0,w=0,m=0;for(;l[a]===n;)w++,a++;const g=(l.length-a)*o+1>>>0,v=new Uint8Array(g);for(;a<l.length;){const k=l.charCodeAt(a);if(k>255)return;let R=t[k];if(R===255)return;let N=0;for(let $=g-1;(R!==0||N<m)&&$!==-1;$--,N++)R+=r*v[$]>>>0,v[$]=R%256>>>0,R=R/256>>>0;if(R!==0)throw new Error("Non-zero carry");m=N,a++}let E=g-m;for(;E!==g&&v[E]===0;)E++;const T=new Uint8Array(w+(g-E));let U=w;for(;E!==g;)T[U++]=v[E++];return T}function p(l){const a=c(l);if(a)return a;throw new Error("Non-base"+r+" character")}return{encode:u,decodeUnsafe:c,decode:p}}var Lo="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";No(Lo);const Cr=BigInt(0),Or=BigInt(1);function qe(e,t=""){if(typeof e!="boolean"){const r=t&&`"${t}" `;throw new Error(r+"expected boolean, got type="+typeof e)}return e}function ai(e){if(typeof e=="bigint"){if(!He(e))throw new Error("positive bigint expected, got "+e)}else te(e);return e}function xe(e){const t=ai(e).toString(16);return t.length&1?"0"+t:t}function ci(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return e===""?Cr:BigInt("0x"+e)}function er(e){return ci(tr(e))}function li(e){return ci(tr(Co(tt(e)).reverse()))}function Hr(e,t){te(t),e=ai(e);const r=je(e.toString(16).padStart(t*2,"0"));if(r.length!==t)throw new Error("number too large");return r}function di(e,t){return Hr(e,t).reverse()}function Co(e){return Uint8Array.from(e)}const He=e=>typeof e=="bigint"&&Cr<=e;function Ho(e,t,r){return He(e)&&He(t)&&He(r)&&t<=e&&e<r}function Do(e,t,r,n){if(!Ho(t,r,n))throw new Error("expected valid "+e+": "+r+" <= n < "+n+", got "+t)}function Vo(e){let t;for(t=0;e>Cr;e>>=Or,t+=1);return t}const Dr=e=>(Or<<BigInt(e))-Or;function Mo(e,t,r){if(te(e,"hashLen"),te(t,"qByteLen"),typeof r!="function")throw new Error("hmacFn must be a function");const n=E=>new Uint8Array(E),o=Uint8Array.of(),f=Uint8Array.of(0),u=Uint8Array.of(1),c=1e3;let p=n(e),l=n(e),a=0;const w=()=>{p.fill(1),l.fill(0),a=0},m=(...E)=>r(l,Gt(p,...E)),g=(E=o)=>{l=m(f,E),p=m(),E.length!==0&&(l=m(u,E),p=m())},v=()=>{if(a++>=c)throw new Error("drbg: tried max amount of iterations");let E=0;const T=[];for(;E<t;){p=m();const U=p.slice();T.push(U),E+=p.length}return Gt(...T)};return(E,T)=>{w(),g(E);let U;for(;!(U=T(v()));)g();return w(),U}}function Vr(e,t={},r={}){if(!e||typeof e!="object")throw new Error("expected valid options object");function n(f,u,c){const p=e[f];if(c&&p===void 0)return;const l=typeof p;if(l!==u||p===null)throw new Error(`param "${f}" is invalid: expected ${u}, got ${l}`)}const o=(f,u)=>Object.entries(f).forEach(([c,p])=>n(c,p,u));o(t,!1),o(r,!0)}function cn(e){const t=new WeakMap;return(r,...n)=>{const o=t.get(r);if(o!==void 0)return o;const f=e(r,...n);return t.set(r,f),f}}const dt=BigInt(0),ct=BigInt(1),Wt=BigInt(2),pi=BigInt(3),wi=BigInt(4),yi=BigInt(5),Fo=BigInt(7),gi=BigInt(8),Ko=BigInt(9),bi=BigInt(16);function vt(e,t){const r=e%t;return r>=dt?r:t+r}function yt(e,t,r){let n=e;for(;t-- >dt;)n*=n,n%=r;return n}function ln(e,t){if(e===dt)throw new Error("invert: expected non-zero number");if(t<=dt)throw new Error("invert: expected positive modulus, got "+t);let r=vt(e,t),n=t,o=dt,f=ct;for(;r!==dt;){const u=n/r,c=n%r,p=o-f*u;n=r,r=c,o=f,f=p}if(n!==ct)throw new Error("invert: does not exist");return vt(o,t)}function Mr(e,t,r){if(!e.eql(e.sqr(t),r))throw new Error("Cannot find square root")}function mi(e,t){const r=(e.ORDER+ct)/wi,n=e.pow(t,r);return Mr(e,n,t),n}function $o(e,t){const r=(e.ORDER-yi)/gi,n=e.mul(t,Wt),o=e.pow(n,r),f=e.mul(t,o),u=e.mul(e.mul(f,Wt),o),c=e.mul(f,e.sub(u,e.ONE));return Mr(e,c,t),c}function Go(e){const t=rr(e),r=Ei(e),n=r(t,t.neg(t.ONE)),o=r(t,n),f=r(t,t.neg(n)),u=(e+Fo)/bi;return(c,p)=>{let l=c.pow(p,u),a=c.mul(l,n);const w=c.mul(l,o),m=c.mul(l,f),g=c.eql(c.sqr(a),p),v=c.eql(c.sqr(w),p);l=c.cmov(l,a,g),a=c.cmov(m,w,v);const E=c.eql(c.sqr(a),p),T=c.cmov(l,a,E);return Mr(c,T,p),T}}function Ei(e){if(e<pi)throw new Error("sqrt is not defined for small field");let t=e-ct,r=0;for(;t%Wt===dt;)t/=Wt,r++;let n=Wt;const o=rr(e);for(;dn(o,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return mi;let f=o.pow(n,t);const u=(t+ct)/Wt;return function(c,p){if(c.is0(p))return p;if(dn(c,p)!==1)throw new Error("Cannot find square root");let l=r,a=c.mul(c.ONE,f),w=c.pow(p,t),m=c.pow(p,u);for(;!c.eql(w,c.ONE);){if(c.is0(w))return c.ZERO;let g=1,v=c.sqr(w);for(;!c.eql(v,c.ONE);)if(g++,v=c.sqr(v),g===l)throw new Error("Cannot find square root");const E=ct<<BigInt(l-g-1),T=c.pow(a,E);l=g,a=c.sqr(T),w=c.mul(w,a),m=c.mul(m,T)}return m}}function jo(e){return e%wi===pi?mi:e%gi===yi?$o:e%bi===Ko?Go(e):Ei(e)}const qo=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Yo(e){const t={ORDER:"bigint",BYTES:"number",BITS:"number"},r=qo.reduce((n,o)=>(n[o]="function",n),t);return Vr(e,r),e}function Wo(e,t,r){if(r<dt)throw new Error("invalid exponent, negatives unsupported");if(r===dt)return e.ONE;if(r===ct)return t;let n=e.ONE,o=t;for(;r>dt;)r&ct&&(n=e.mul(n,o)),o=e.sqr(o),r>>=ct;return n}function vi(e,t,r=!1){const n=new Array(t.length).fill(r?e.ZERO:void 0),o=t.reduce((u,c,p)=>e.is0(c)?u:(n[p]=u,e.mul(u,c)),e.ONE),f=e.inv(o);return t.reduceRight((u,c,p)=>e.is0(c)?u:(n[p]=e.mul(u,n[p]),e.mul(u,c)),f),n}function dn(e,t){const r=(e.ORDER-ct)/Wt,n=e.pow(t,r),o=e.eql(n,e.ONE),f=e.eql(n,e.ZERO),u=e.eql(n,e.neg(e.ONE));if(!o&&!f&&!u)throw new Error("invalid Legendre symbol result");return o?1:f?0:-1}function Zo(e,t){t!==void 0&&te(t);const r=t!==void 0?t:e.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}class Xo{ORDER;BITS;BYTES;isLE;ZERO=dt;ONE=ct;_lengths;_sqrt;_mod;constructor(t,r={}){if(t<=dt)throw new Error("invalid field: expected ORDER > 0, got "+t);let n;this.isLE=!1,r!=null&&typeof r=="object"&&(typeof r.BITS=="number"&&(n=r.BITS),typeof r.sqrt=="function"&&(this.sqrt=r.sqrt),typeof r.isLE=="boolean"&&(this.isLE=r.isLE),r.allowedLengths&&(this._lengths=r.allowedLengths?.slice()),typeof r.modFromBytes=="boolean"&&(this._mod=r.modFromBytes));const{nBitLength:o,nByteLength:f}=Zo(t,n);if(f>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");this.ORDER=t,this.BITS=o,this.BYTES=f,this._sqrt=void 0,Object.preventExtensions(this)}create(t){return vt(t,this.ORDER)}isValid(t){if(typeof t!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof t);return dt<=t&&t<this.ORDER}is0(t){return t===dt}isValidNot0(t){return!this.is0(t)&&this.isValid(t)}isOdd(t){return(t&ct)===ct}neg(t){return vt(-t,this.ORDER)}eql(t,r){return t===r}sqr(t){return vt(t*t,this.ORDER)}add(t,r){return vt(t+r,this.ORDER)}sub(t,r){return vt(t-r,this.ORDER)}mul(t,r){return vt(t*r,this.ORDER)}pow(t,r){return Wo(this,t,r)}div(t,r){return vt(t*ln(r,this.ORDER),this.ORDER)}sqrN(t){return t*t}addN(t,r){return t+r}subN(t,r){return t-r}mulN(t,r){return t*r}inv(t){return ln(t,this.ORDER)}sqrt(t){return this._sqrt||(this._sqrt=jo(this.ORDER)),this._sqrt(this,t)}toBytes(t){return this.isLE?di(t,this.BYTES):Hr(t,this.BYTES)}fromBytes(t,r=!1){tt(t);const{_lengths:n,BYTES:o,isLE:f,ORDER:u,_mod:c}=this;if(n){if(!n.includes(t.length)||t.length>o)throw new Error("Field.fromBytes: expected "+n+" bytes, got "+t.length);const l=new Uint8Array(o);l.set(t,f?0:l.length-t.length),t=l}if(t.length!==o)throw new Error("Field.fromBytes: expected "+o+" bytes, got "+t.length);let p=f?li(t):er(t);if(c&&(p=vt(p,u)),!r&&!this.isValid(p))throw new Error("invalid field element: outside of range 0..ORDER");return p}invertBatch(t){return vi(this,t)}cmov(t,r,n){return n?r:t}}function rr(e,t={}){return new Xo(e,t)}function Ai(e){if(typeof e!="bigint")throw new Error("field order must be bigint");const t=e.toString(2).length;return Math.ceil(t/8)}function Oi(e){const t=Ai(e);return t+Math.ceil(t/2)}function zo(e,t,r=!1){tt(e);const n=e.length,o=Ai(t),f=Oi(t);if(n<16||n<f||n>1024)throw new Error("expected "+f+"-1024 bytes of input, got "+n);const u=r?li(e):er(e),c=vt(u,t-ct)+ct;return r?di(c,o):Hr(c,o)}const fe=BigInt(0),Zt=BigInt(1);function Ye(e,t){const r=t.negate();return e?r:t}function pn(e,t){const r=vi(e.Fp,t.map(n=>n.Z));return t.map((n,o)=>e.fromAffine(n.toAffine(r[o])))}function Pi(e,t){if(!Number.isSafeInteger(e)||e<=0||e>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+e)}function ar(e,t){Pi(e,t);const r=Math.ceil(t/e)+1,n=2**(e-1),o=2**e,f=Dr(e),u=BigInt(e);return{windows:r,windowSize:n,mask:f,maxNumber:o,shiftBy:u}}function wn(e,t,r){const{windowSize:n,mask:o,maxNumber:f,shiftBy:u}=r;let c=Number(e&o),p=e>>u;c>n&&(c-=f,p+=Zt);const l=t*n,a=l+Math.abs(c)-1,w=c===0,m=c<0,g=t%2!==0;return{nextN:p,offset:a,isZero:w,isNeg:m,isNegF:g,offsetF:l}}const cr=new WeakMap,Ti=new WeakMap;function lr(e){return Ti.get(e)||1}function yn(e){if(e!==fe)throw new Error("invalid wNAF")}class Qo{BASE;ZERO;Fn;bits;constructor(t,r){this.BASE=t.BASE,this.ZERO=t.ZERO,this.Fn=t.Fn,this.bits=r}_unsafeLadder(t,r,n=this.ZERO){let o=t;for(;r>fe;)r&Zt&&(n=n.add(o)),o=o.double(),r>>=Zt;return n}precomputeWindow(t,r){const{windows:n,windowSize:o}=ar(r,this.bits),f=[];let u=t,c=u;for(let p=0;p<n;p++){c=u,f.push(c);for(let l=1;l<o;l++)c=c.add(u),f.push(c);u=c.double()}return f}wNAF(t,r,n){if(!this.Fn.isValid(n))throw new Error("invalid scalar");let o=this.ZERO,f=this.BASE;const u=ar(t,this.bits);for(let c=0;c<u.windows;c++){const{nextN:p,offset:l,isZero:a,isNeg:w,isNegF:m,offsetF:g}=wn(n,c,u);n=p,a?f=f.add(Ye(m,r[g])):o=o.add(Ye(w,r[l]))}return yn(n),{p:o,f}}wNAFUnsafe(t,r,n,o=this.ZERO){const f=ar(t,this.bits);for(let u=0;u<f.windows&&n!==fe;u++){const{nextN:c,offset:p,isZero:l,isNeg:a}=wn(n,u,f);if(n=c,!l){const w=r[p];o=o.add(a?w.negate():w)}}return yn(n),o}getPrecomputes(t,r,n){let o=cr.get(r);return o||(o=this.precomputeWindow(r,t),t!==1&&(typeof n=="function"&&(o=n(o)),cr.set(r,o))),o}cached(t,r,n){const o=lr(t);return this.wNAF(o,this.getPrecomputes(o,t,n),r)}unsafe(t,r,n,o){const f=lr(t);return f===1?this._unsafeLadder(t,r,o):this.wNAFUnsafe(f,this.getPrecomputes(f,t,n),r,o)}createCache(t,r){Pi(r,this.bits),Ti.set(t,r),cr.delete(t)}hasCache(t){return lr(t)!==1}}function Jo(e,t,r,n){let o=t,f=e.ZERO,u=e.ZERO;for(;r>fe||n>fe;)r&Zt&&(f=f.add(o)),n&Zt&&(u=u.add(o)),o=o.double(),r>>=Zt,n>>=Zt;return{p1:f,p2:u}}function gn(e,t,r){if(t){if(t.ORDER!==e)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return Yo(t),t}else return rr(e,{isLE:r})}function th(e,t,r={},n){if(n===void 0&&(n=e==="edwards"),!t||typeof t!="object")throw new Error(`expected valid ${e} CURVE object`);for(const c of["p","n","h"]){const p=t[c];if(!(typeof p=="bigint"&&p>fe))throw new Error(`CURVE.${c} must be positive bigint`)}const o=gn(t.p,r.Fp,n),f=gn(t.n,r.Fn,n),u=["Gx","Gy","a","b"];for(const c of u)if(!o.isValid(t[c]))throw new Error(`CURVE.${c} must be valid field element of CURVE.Fp`);return t=Object.freeze(Object.assign({},t)),{CURVE:t,Fp:o,Fn:f}}function eh(e,t){return function(r){const n=e(r);return{secretKey:n,publicKey:t(n)}}}class Ii{oHash;iHash;blockLen;outputLen;finished=!1;destroyed=!1;constructor(t,r){if(hi(t),tt(r,void 0,"key"),this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const n=this.blockLen,o=new Uint8Array(n);o.set(r.length>n?t.create().update(r).digest():r);for(let f=0;f<o.length;f++)o[f]^=54;this.iHash.update(o),this.oHash=t.create();for(let f=0;f<o.length;f++)o[f]^=106;this.oHash.update(o),Ge(o)}update(t){return $e(this),this.iHash.update(t),this}digestInto(t){$e(this),tt(t,this.outputLen,"output"),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||=Object.create(Object.getPrototypeOf(this),{});const{oHash:r,iHash:n,finished:o,destroyed:f,blockLen:u,outputLen:c}=this;return t=t,t.finished=o,t.destroyed=f,t.blockLen=u,t.outputLen=c,t.oHash=r._cloneInto(t.oHash),t.iHash=n._cloneInto(t.iHash),t}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Bi=(e,t,r)=>new Ii(e,t).update(r).digest();Bi.create=(e,t)=>new Ii(e,t);const bn=(e,t)=>(e+(e>=0?t:-t)/ki)/t;function rh(e,t,r){const[[n,o],[f,u]]=t,c=bn(u*e,r),p=bn(-o*e,r);let l=e-c*n-p*f,a=-c*o-p*u;const w=l<St,m=a<St;w&&(l=-l),m&&(a=-a);const g=Dr(Math.ceil(Vo(r)/2))+se;if(l<St||l>=g||a<St||a>=g)throw new Error("splitScalar (endomorphism): failed, k="+e);return{k1neg:w,k1:l,k2neg:m,k2:a}}function Pr(e){if(!["compact","recovered","der"].includes(e))throw new Error('Signature format must be "compact", "recovered", or "der"');return e}function dr(e,t){const r={};for(let n of Object.keys(t))r[n]=e[n]===void 0?t[n]:e[n];return qe(r.lowS,"lowS"),qe(r.prehash,"prehash"),r.format!==void 0&&Pr(r.format),r}class nh extends Error{constructor(t=""){super(t)}}const Kt={Err:nh,_tlv:{encode:(e,t)=>{const{Err:r}=Kt;if(e<0||e>256)throw new r("tlv.encode: wrong tag");if(t.length&1)throw new r("tlv.encode: unpadded data");const n=t.length/2,o=xe(n);if(o.length/2&128)throw new r("tlv.encode: long form length too big");const f=n>127?xe(o.length/2|128):"";return xe(e)+f+o+t},decode(e,t){const{Err:r}=Kt;let n=0;if(e<0||e>256)throw new r("tlv.encode: wrong tag");if(t.length<2||t[n++]!==e)throw new r("tlv.decode: wrong tlv");const o=t[n++],f=!!(o&128);let u=0;if(!f)u=o;else{const p=o&127;if(!p)throw new r("tlv.decode(long): indefinite length not supported");if(p>4)throw new r("tlv.decode(long): byte length is too big");const l=t.subarray(n,n+p);if(l.length!==p)throw new r("tlv.decode: length bytes not complete");if(l[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(const a of l)u=u<<8|a;if(n+=p,u<128)throw new r("tlv.decode(long): not minimal encoding")}const c=t.subarray(n,n+u);if(c.length!==u)throw new r("tlv.decode: wrong value length");return{v:c,l:t.subarray(n+u)}}},_int:{encode(e){const{Err:t}=Kt;if(e<St)throw new t("integer: negative integers are not allowed");let r=xe(e);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new t("unexpected DER parsing assertion: unpadded hex");return r},decode(e){const{Err:t}=Kt;if(e[0]&128)throw new t("invalid signature integer: negative");if(e[0]===0&&!(e[1]&128))throw new t("invalid signature integer: unnecessary leading zero");return er(e)}},toSig(e){const{Err:t,_int:r,_tlv:n}=Kt,o=tt(e,void 0,"signature"),{v:f,l:u}=n.decode(48,o);if(u.length)throw new t("invalid signature: left bytes after parsing");const{v:c,l:p}=n.decode(2,f),{v:l,l:a}=n.decode(2,p);if(a.length)throw new t("invalid signature: left bytes after parsing");return{r:r.decode(c),s:r.decode(l)}},hexFromSig(e){const{_tlv:t,_int:r}=Kt,n=t.encode(2,r.encode(e.r)),o=t.encode(2,r.encode(e.s)),f=n+o;return t.encode(48,f)}},St=BigInt(0),se=BigInt(1),ki=BigInt(2),Se=BigInt(3),ih=BigInt(4);function sh(e,t={}){const r=th("weierstrass",e,t),{Fp:n,Fn:o}=r;let f=r.CURVE;const{h:u,n:c}=f;Vr(t,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object"});const{endo:p}=t;if(p&&(!n.is0(f.a)||typeof p.beta!="bigint"||!Array.isArray(p.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const l=Ri(n,o);function a(){if(!n.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function w(j,I,O){const{x:A,y:B}=I.toAffine(),L=n.toBytes(A);if(qe(O,"isCompressed"),O){a();const C=!n.isOdd(B);return Gt(Ui(C),L)}else return Gt(Uint8Array.of(4),L,n.toBytes(B))}function m(j){tt(j,void 0,"Point");const{publicKey:I,publicKeyUncompressed:O}=l,A=j.length,B=j[0],L=j.subarray(1);if(A===I&&(B===2||B===3)){const C=n.fromBytes(L);if(!n.isValid(C))throw new Error("bad point: is not on curve, wrong x");const H=E(C);let _;try{_=n.sqrt(H)}catch(F){const et=F instanceof Error?": "+F.message:"";throw new Error("bad point: is not on curve, sqrt error"+et)}a();const V=n.isOdd(_);return(B&1)===1!==V&&(_=n.neg(_)),{x:C,y:_}}else if(A===O&&B===4){const C=n.BYTES,H=n.fromBytes(L.subarray(0,C)),_=n.fromBytes(L.subarray(C,C*2));if(!T(H,_))throw new Error("bad point: is not on curve");return{x:H,y:_}}else throw new Error(`bad point: got length ${A}, expected compressed=${I} or uncompressed=${O}`)}const g=t.toBytes||w,v=t.fromBytes||m;function E(j){const I=n.sqr(j),O=n.mul(I,j);return n.add(n.add(O,n.mul(j,f.a)),f.b)}function T(j,I){const O=n.sqr(I),A=E(j);return n.eql(O,A)}if(!T(f.Gx,f.Gy))throw new Error("bad curve params: generator point");const U=n.mul(n.pow(f.a,Se),ih),k=n.mul(n.sqr(f.b),BigInt(27));if(n.is0(n.add(U,k)))throw new Error("bad curve params: a or b");function R(j,I,O=!1){if(!n.isValid(I)||O&&n.is0(I))throw new Error(`bad point coordinate ${j}`);return I}function N(j){if(!(j instanceof G))throw new Error("Weierstrass Point expected")}function $(j){if(!p||!p.basises)throw new Error("no endo");return rh(j,p.basises,o.ORDER)}const J=cn((j,I)=>{const{X:O,Y:A,Z:B}=j;if(n.eql(B,n.ONE))return{x:O,y:A};const L=j.is0();I==null&&(I=L?n.ONE:n.inv(B));const C=n.mul(O,I),H=n.mul(A,I),_=n.mul(B,I);if(L)return{x:n.ZERO,y:n.ZERO};if(!n.eql(_,n.ONE))throw new Error("invZ was invalid");return{x:C,y:H}}),Lt=cn(j=>{if(j.is0()){if(t.allowInfinityPoint&&!n.is0(j.Y))return;throw new Error("bad point: ZERO")}const{x:I,y:O}=j.toAffine();if(!n.isValid(I)||!n.isValid(O))throw new Error("bad point: x or y not field elements");if(!T(I,O))throw new Error("bad point: equation left != right");if(!j.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function st(j,I,O,A,B){return O=new G(n.mul(O.X,j),O.Y,O.Z),I=Ye(A,I),O=Ye(B,O),I.add(O)}class G{static BASE=new G(f.Gx,f.Gy,n.ONE);static ZERO=new G(n.ZERO,n.ONE,n.ZERO);static Fp=n;static Fn=o;X;Y;Z;constructor(I,O,A){this.X=R("x",I),this.Y=R("y",O,!0),this.Z=R("z",A),Object.freeze(this)}static CURVE(){return f}static fromAffine(I){const{x:O,y:A}=I||{};if(!I||!n.isValid(O)||!n.isValid(A))throw new Error("invalid affine point");if(I instanceof G)throw new Error("projective point not allowed");return n.is0(O)&&n.is0(A)?G.ZERO:new G(O,A,n.ONE)}static fromBytes(I){const O=G.fromAffine(v(tt(I,void 0,"point")));return O.assertValidity(),O}static fromHex(I){return G.fromBytes(je(I))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(I=8,O=!0){return kt.createCache(this,I),O||this.multiply(Se),this}assertValidity(){Lt(this)}hasEvenY(){const{y:I}=this.toAffine();if(!n.isOdd)throw new Error("Field doesn't support isOdd");return!n.isOdd(I)}equals(I){N(I);const{X:O,Y:A,Z:B}=this,{X:L,Y:C,Z:H}=I,_=n.eql(n.mul(O,H),n.mul(L,B)),V=n.eql(n.mul(A,H),n.mul(C,B));return _&&V}negate(){return new G(this.X,n.neg(this.Y),this.Z)}double(){const{a:I,b:O}=f,A=n.mul(O,Se),{X:B,Y:L,Z:C}=this;let H=n.ZERO,_=n.ZERO,V=n.ZERO,F=n.mul(B,B),et=n.mul(L,L),K=n.mul(C,C),D=n.mul(B,L);return D=n.add(D,D),V=n.mul(B,C),V=n.add(V,V),H=n.mul(I,V),_=n.mul(A,K),_=n.add(H,_),H=n.sub(et,_),_=n.add(et,_),_=n.mul(H,_),H=n.mul(D,H),V=n.mul(A,V),K=n.mul(I,K),D=n.sub(F,K),D=n.mul(I,D),D=n.add(D,V),V=n.add(F,F),F=n.add(V,F),F=n.add(F,K),F=n.mul(F,D),_=n.add(_,F),K=n.mul(L,C),K=n.add(K,K),F=n.mul(K,D),H=n.sub(H,F),V=n.mul(K,et),V=n.add(V,V),V=n.add(V,V),new G(H,_,V)}add(I){N(I);const{X:O,Y:A,Z:B}=this,{X:L,Y:C,Z:H}=I;let _=n.ZERO,V=n.ZERO,F=n.ZERO;const et=f.a,K=n.mul(f.b,Se);let D=n.mul(O,L),Z=n.mul(A,C),rt=n.mul(B,H),wt=n.add(O,A),X=n.add(L,C);wt=n.mul(wt,X),X=n.add(D,Z),wt=n.sub(wt,X),X=n.add(O,B);let ot=n.add(L,H);return X=n.mul(X,ot),ot=n.add(D,rt),X=n.sub(X,ot),ot=n.add(A,B),_=n.add(C,H),ot=n.mul(ot,_),_=n.add(Z,rt),ot=n.sub(ot,_),F=n.mul(et,X),_=n.mul(K,rt),F=n.add(_,F),_=n.sub(Z,F),F=n.add(Z,F),V=n.mul(_,F),Z=n.add(D,D),Z=n.add(Z,D),rt=n.mul(et,rt),X=n.mul(K,X),Z=n.add(Z,rt),rt=n.sub(D,rt),rt=n.mul(et,rt),X=n.add(X,rt),D=n.mul(Z,X),V=n.add(V,D),D=n.mul(ot,X),_=n.mul(wt,_),_=n.sub(_,D),D=n.mul(wt,Z),F=n.mul(ot,F),F=n.add(F,D),new G(_,V,F)}subtract(I){return this.add(I.negate())}is0(){return this.equals(G.ZERO)}multiply(I){const{endo:O}=t;if(!o.isValidNot0(I))throw new Error("invalid scalar: out of range");let A,B;const L=C=>kt.cached(this,C,H=>pn(G,H));if(O){const{k1neg:C,k1:H,k2neg:_,k2:V}=$(I),{p:F,f:et}=L(H),{p:K,f:D}=L(V);B=et.add(D),A=st(O.beta,F,K,C,_)}else{const{p:C,f:H}=L(I);A=C,B=H}return pn(G,[A,B])[0]}multiplyUnsafe(I){const{endo:O}=t,A=this;if(!o.isValid(I))throw new Error("invalid scalar: out of range");if(I===St||A.is0())return G.ZERO;if(I===se)return A;if(kt.hasCache(this))return this.multiply(I);if(O){const{k1neg:B,k1:L,k2neg:C,k2:H}=$(I),{p1:_,p2:V}=Jo(G,A,L,H);return st(O.beta,_,V,B,C)}else return kt.unsafe(A,I)}toAffine(I){return J(this,I)}isTorsionFree(){const{isTorsionFree:I}=t;return u===se?!0:I?I(G,this):kt.unsafe(this,c).is0()}clearCofactor(){const{clearCofactor:I}=t;return u===se?this:I?I(G,this):this.multiplyUnsafe(u)}isSmallOrder(){return this.multiplyUnsafe(u).is0()}toBytes(I=!0){return qe(I,"isCompressed"),this.assertValidity(),g(G,this,I)}toHex(I=!0){return tr(this.toBytes(I))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}const mt=o.BITS,kt=new Qo(G,t.endo?Math.ceil(mt/2):mt);return G.BASE.precompute(8),G}function Ui(e){return Uint8Array.of(e?2:3)}function Ri(e,t){return{secretKey:t.BYTES,publicKey:1+e.BYTES,publicKeyUncompressed:1+2*e.BYTES,publicKeyHasPrefix:!0,signature:2*t.BYTES}}function oh(e,t={}){const{Fn:r}=e,n=t.randomBytes||ui,o=Object.assign(Ri(e.Fp,r),{seed:Oi(r.ORDER)});function f(g){try{const v=r.fromBytes(g);return r.isValidNot0(v)}catch{return!1}}function u(g,v){const{publicKey:E,publicKeyUncompressed:T}=o;try{const U=g.length;return v===!0&&U!==E||v===!1&&U!==T?!1:!!e.fromBytes(g)}catch{return!1}}function c(g=n(o.seed)){return zo(tt(g,o.seed,"seed"),r.ORDER)}function p(g,v=!0){return e.BASE.multiply(r.fromBytes(g)).toBytes(v)}function l(g){const{secretKey:v,publicKey:E,publicKeyUncompressed:T}=o;if(!Lr(g)||"_lengths"in r&&r._lengths||v===E)return;const U=tt(g,void 0,"key").length;return U===E||U===T}function a(g,v,E=!0){if(l(g)===!0)throw new Error("first arg must be private key");if(l(v)===!1)throw new Error("second arg must be public key");const T=r.fromBytes(g);return e.fromBytes(v).multiply(T).toBytes(E)}const w={isValidSecretKey:f,isValidPublicKey:u,randomSecretKey:c},m=eh(c,p);return Object.freeze({getPublicKey:p,getSharedSecret:a,keygen:m,Point:e,utils:w,lengths:o})}function hh(e,t,r={}){hi(t),Vr(r,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"}),r=Object.assign({},r);const n=r.randomBytes||ui,o=r.hmac||((O,A)=>Bi(t,O,A)),{Fp:f,Fn:u}=e,{ORDER:c,BITS:p}=u,{keygen:l,getPublicKey:a,getSharedSecret:w,utils:m,lengths:g}=oh(e,r),v={prehash:!0,lowS:typeof r.lowS=="boolean"?r.lowS:!0,format:"compact",extraEntropy:!1},E=c*ki<f.ORDER;function T(O){const A=c>>se;return O>A}function U(O,A){if(!u.isValidNot0(A))throw new Error(`invalid signature ${O}: out of range 1..Point.Fn.ORDER`);return A}function k(){if(E)throw new Error('"recovered" sig type is not supported for cofactor >2 curves')}function R(O,A){Pr(A);const B=g.signature,L=A==="compact"?B:A==="recovered"?B+1:void 0;return tt(O,L)}class N{r;s;recovery;constructor(A,B,L){if(this.r=U("r",A),this.s=U("s",B),L!=null){if(k(),![0,1,2,3].includes(L))throw new Error("invalid recovery id");this.recovery=L}Object.freeze(this)}static fromBytes(A,B=v.format){R(A,B);let L;if(B==="der"){const{r:V,s:F}=Kt.toSig(tt(A));return new N(V,F)}B==="recovered"&&(L=A[0],B="compact",A=A.subarray(1));const C=g.signature/2,H=A.subarray(0,C),_=A.subarray(C,C*2);return new N(u.fromBytes(H),u.fromBytes(_),L)}static fromHex(A,B){return this.fromBytes(je(A),B)}assertRecovery(){const{recovery:A}=this;if(A==null)throw new Error("invalid recovery id: must be present");return A}addRecoveryBit(A){return new N(this.r,this.s,A)}recoverPublicKey(A){const{r:B,s:L}=this,C=this.assertRecovery(),H=C===2||C===3?B+c:B;if(!f.isValid(H))throw new Error("invalid recovery id: sig.r+curve.n != R.x");const _=f.toBytes(H),V=e.fromBytes(Gt(Ui((C&1)===0),_)),F=u.inv(H),et=J(tt(A,void 0,"msgHash")),K=u.create(-et*F),D=u.create(L*F),Z=e.BASE.multiplyUnsafe(K).add(V.multiplyUnsafe(D));if(Z.is0())throw new Error("invalid recovery: point at infinify");return Z.assertValidity(),Z}hasHighS(){return T(this.s)}toBytes(A=v.format){if(Pr(A),A==="der")return je(Kt.hexFromSig(this));const{r:B,s:L}=this,C=u.toBytes(B),H=u.toBytes(L);return A==="recovered"?(k(),Gt(Uint8Array.of(this.assertRecovery()),C,H)):Gt(C,H)}toHex(A){return tr(this.toBytes(A))}}const $=r.bits2int||function(O){if(O.length>8192)throw new Error("input is too large");const A=er(O),B=O.length*8-p;return B>0?A>>BigInt(B):A},J=r.bits2int_modN||function(O){return u.create($(O))},Lt=Dr(p);function st(O){return Do("num < 2^"+p,O,St,Lt),u.toBytes(O)}function G(O,A){return tt(O,void 0,"message"),A?tt(t(O),void 0,"prehashed message"):O}function mt(O,A,B){const{lowS:L,prehash:C,extraEntropy:H}=dr(B,v);O=G(O,C);const _=J(O),V=u.fromBytes(A);if(!u.isValidNot0(V))throw new Error("invalid private key");const F=[st(V),st(_)];if(H!=null&&H!==!1){const Z=H===!0?n(g.secretKey):H;F.push(tt(Z,void 0,"extraEntropy"))}const et=Gt(...F),K=_;function D(Z){const rt=$(Z);if(!u.isValidNot0(rt))return;const wt=u.inv(rt),X=e.BASE.multiply(rt).toAffine(),ot=u.create(X.x);if(ot===St)return;const Et=u.create(wt*u.create(K+ot*V));if(Et===St)return;let ee=(X.x===ot?0:2)|Number(X.y&se),de=Et;return L&&T(Et)&&(de=u.neg(Et),ee^=1),new N(ot,de,E?void 0:ee)}return{seed:et,k2sig:D}}function kt(O,A,B={}){const{seed:L,k2sig:C}=mt(O,A,B);return Mo(t.outputLen,u.BYTES,o)(L,C).toBytes(B.format)}function j(O,A,B,L={}){const{lowS:C,prehash:H,format:_}=dr(L,v);if(B=tt(B,void 0,"publicKey"),A=G(A,H),!Lr(O)){const V=O instanceof N?", use sig.toBytes()":"";throw new Error("verify expects Uint8Array signature"+V)}R(O,_);try{const V=N.fromBytes(O,_),F=e.fromBytes(B);if(C&&V.hasHighS())return!1;const{r:et,s:K}=V,D=J(A),Z=u.inv(K),rt=u.create(D*Z),wt=u.create(et*Z),X=e.BASE.multiplyUnsafe(rt).add(F.multiplyUnsafe(wt));return X.is0()?!1:u.create(X.x)===et}catch{return!1}}function I(O,A,B={}){const{prehash:L}=dr(B,v);return A=G(A,L),N.fromBytes(O,"recovered").recoverPublicKey(A).toBytes()}return Object.freeze({keygen:l,getPublicKey:a,getSharedSecret:w,utils:m,lengths:g,Point:e,sign:kt,verify:j,recoverPublicKey:I,Signature:N,hash:t})}const Fr={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:BigInt(1),a:BigInt(0),b:BigInt(7),Gx:BigInt("0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),Gy:BigInt("0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8")},fh={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),basises:[[BigInt("0x3086d221a7d46bcde86c90e49284eb15"),-BigInt("0xe4437ed6010e88286f547fa90abfe4c3")],[BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),BigInt("0x3086d221a7d46bcde86c90e49284eb15")]]},mn=BigInt(2);function uh(e){const t=Fr.p,r=BigInt(3),n=BigInt(6),o=BigInt(11),f=BigInt(22),u=BigInt(23),c=BigInt(44),p=BigInt(88),l=e*e*e%t,a=l*l*e%t,w=yt(a,r,t)*a%t,m=yt(w,r,t)*a%t,g=yt(m,mn,t)*l%t,v=yt(g,o,t)*g%t,E=yt(v,f,t)*v%t,T=yt(E,c,t)*E%t,U=yt(T,p,t)*T%t,k=yt(U,c,t)*E%t,R=yt(k,r,t)*a%t,N=yt(R,u,t)*v%t,$=yt(N,n,t)*l%t,J=yt($,mn,t);if(!Tr.eql(Tr.sqr(J),e))throw new Error("Cannot find square root");return J}const Tr=rr(Fr.p,{sqrt:uh}),ah=sh(Fr,{Fp:Tr,endo:fh}),ch=hh(ah,_o),lh=ch.Point;lh.Fn.ORDER;function S(e){return Ao(e)}function Y(e,t){if(!e)throw new Error(`verifyCryptoBackend: ${t}`)}function dh(e){Y(e.isPoint(S("0279be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798")),"isPoint should accept generator point"),Y(!e.isPoint(S("030000000000000000000000000000000000000000000000000000000000000005")),"isPoint should reject invalid point"),Y(e.isXOnlyPoint(S("79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798")),"isXOnlyPoint should accept generator x-coordinate"),Y(!e.isXOnlyPoint(S("0000000000000000000000000000000000000000000000000000000000000005")),"isXOnlyPoint should reject x-coordinate not on curve"),Y(!e.isXOnlyPoint(S("0000000000000000000000000000000000000000000000000000000000000000")),"isXOnlyPoint should reject zero"),Y(!e.isXOnlyPoint(S("79be667ef9dcbbac55a06295ce870b07")),"isXOnlyPoint should reject wrong length"),Y(e.isPrivate(S("79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798")),"isPrivate should accept valid scalar"),Y(e.isPrivate(S("fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364140")),"isPrivate should accept n-1"),Y(!e.isPrivate(S("0000000000000000000000000000000000000000000000000000000000000000")),"isPrivate should reject zero"),Y(!e.isPrivate(S("fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141")),"isPrivate should reject n"),Y(!e.isPrivate(S("fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364142")),"isPrivate should reject n+1");const t=e.privateAdd(S("0000000000000000000000000000000000000000000000000000000000000001"),S("0000000000000000000000000000000000000000000000000000000000000000"));Y(t!==null&&lt(t,S("0000000000000000000000000000000000000000000000000000000000000001")),"privateAdd: 1 + 0 should equal 1"),Y(e.privateAdd(S("fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd036413e"),S("0000000000000000000000000000000000000000000000000000000000000003"))===null,"privateAdd: (n-3) + 3 should return null (result is zero mod n)");const r=e.privateAdd(S("e211078564db65c3ce7704f08262b1f38f1ef412ad15b5ac2d76657a63b2c500"),S("b51fbb69051255d1becbd683de5848242a89c229348dd72896a87ada94ae8665"));Y(r!==null&&lt(r,S("9730c2ee69edbb958d42db7460bafa18fef9d955325aec99044c81c8282b0a24")),"privateAdd: known vector failed"),Y(lt(e.privateNegate(S("0000000000000000000000000000000000000000000000000000000000000001")),S("fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364140")),"privateNegate(1) should equal n-1"),Y(lt(e.privateNegate(S("fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd036413e")),S("0000000000000000000000000000000000000000000000000000000000000003")),"privateNegate(n-3) should equal 3"),Y(lt(e.privateNegate(S("b1121e4088a66a28f5b6b0f5844943ecd9f610196d7bb83b25214b60452c09af")),S("4eede1bf775995d70a494f0a7bb6bc11e0b8cccd41cce8009ab1132c8b0a3792")),"privateNegate known vector failed"),Y(lt(e.pointCompress(S("0479be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8"),!0),S("0279be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798")),"pointCompress uncompressed->compressed failed"),Y(lt(e.pointCompress(S("0479be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8"),!1),S("0479be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8")),"pointCompress uncompressed->uncompressed failed"),Y(lt(e.pointCompress(S("0279be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),!0),S("0279be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798")),"pointCompress compressed->compressed failed"),Y(lt(e.pointCompress(S("0279be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),!1),S("0479be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8")),"pointCompress compressed->uncompressed failed");const n=e.pointFromScalar(S("b1121e4088a66a28f5b6b0f5844943ecd9f610196d7bb83b25214b60452c09af"));Y(n!==null&&lt(n,S("02b07ba9dca9523b7ef4bd97703d43d20399eb698e194704791a25ce77a400df99")),"pointFromScalar known vector failed"),Y(e.xOnlyPointAddTweak(S("79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),S("fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364140"))===null,"xOnlyPointAddTweak should return null for infinity result");let o=e.xOnlyPointAddTweak(S("1617d38ed8d8657da4d4761e8057bc396ea9e4b9d29776d4be096016dbd2509b"),S("a8397a935f0dfceba6ba9618f6451ef4d80637abf4e6af2669fbc9de6a8fd2ac"));Y(o!==null&&lt(o.xOnlyPubkey,S("e478f99dab91052ab39a33ea35fd5e6e4933f4d28023cd597c9a1f6760346adf"))&&o.parity===1,"xOnlyPointAddTweak parity=1 case failed"),o=e.xOnlyPointAddTweak(S("2c0b7cf95324a07d05398b240174dc0c2be444d96b159aa6c7f7b1e668680991"),S("823c3cd2142744b075a87eade7e1b8678ba308d566226a0056ca2b7a76f86b47")),Y(o!==null&&lt(o.xOnlyPubkey,S("9534f8dc8c6deda2dc007655981c78b49c5d96c778fbf363462a11ec9dfd948c"))&&o.parity===0,"xOnlyPointAddTweak parity=0 case failed");const f=e.sign(S("5e9f0a0d593efdcf78ac923bc3313e4e7d408d574354ee2b3288c0da9fbba6ed"),S("fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364140"));if(Y(lt(f,S("54c4a33c6423d689378f160a7ff8b61330444abb58fb470f96ea16d99d4a2fed07082304410efa6b2943111b6a4e0aaa7b7db55a07e9861d1fb3cb1f421044a5")),"sign known vector failed"),Y(e.verify(S("5e9f0a0d593efdcf78ac923bc3313e4e7d408d574354ee2b3288c0da9fbba6ed"),S("0379be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),f),"verify known vector failed"),e.signSchnorr){const u=e.signSchnorr(S("7e2d58d8b3bcdf1abadec7829054f90dda9805aab56c77333024b9d0a508b75c"),S("c90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b14e5c9"),S("c87aa53824b4d7ae2eb035a2b5bbbccc080e76cdc6d1692c4b0b62d798e6d906"));Y(lt(u,S("5831aaeed7b44bb74e5eab94ba9d4294c49bcf2a60728d8b4c200f50dd313c1bab745879a5ad954a72c45a91c3a51d3c7adea98d82f8481e0e1e03674a6f3fb7")),"signSchnorr known vector failed")}e.verifySchnorr&&Y(e.verifySchnorr(S("7e2d58d8b3bcdf1abadec7829054f90dda9805aab56c77333024b9d0a508b75c"),S("dd308afec5777e13121fa72b9cc1b7cc0139715309b086c960e18fd969774eb8"),S("5831aaeed7b44bb74e5eab94ba9d4294c49bcf2a60728d8b4c200f50dd313c1bab745879a5ad954a72c45a91c3a51d3c7adea98d82f8481e0e1e03674a6f3fb7")),"verifySchnorr known vector failed")}class gt{static#o;#a;constructor(t){this.#a=t}get lib(){return this.#a}static init(t){return gt.#o&&gt.#o.#a===t?gt.#o:(dh(t),gt.#o=new gt(t),gt.#o)}static get(){if(!gt.#o)throw new Error("ECC library not initialized. Call EccContext.init() or initEccLib() first.");return gt.#o}static clear(){gt.#o=void 0}static isInitialized(){return gt.#o!==void 0}}function ph(){return gt.get().lib}const Te=192,wh=e=>"left"in e&&"right"in e;function En(e,t){if(e.length<33)throw new TypeError(`The control-block length is too small. Got ${e.length}, expected min 33.`);const r=(e.length-33)/32;let n=t;for(let o=0;o<r;o++){const f=e.subarray(33+32*o,65+32*o);oe(n,f)<0?n=Ie(n,f):n=Ie(f,n)}return n}function vn(e,t){if(e.length<1)throw new TypeError(`The control-block length is too small. Got ${e.length}, expected min 1.`);const r=(e.length-1)/32;let n=t;for(let o=0;o<r;o++){const f=e.subarray(1+32*o,33+32*o);oe(n,f)<0?n=Ie(n,f):n=Ie(f,n)}return n}function We(e){if(Ks(e))return{hash:_t(e)};const t=[We(e[0]),We(e[1])];t.sort((o,f)=>oe(o.hash,f.hash));const r=t[0],n=t[1];return{hash:Ie(r.hash,n.hash),left:r,right:n}}function ue(e,t){if(wh(e)){const r=ue(e.left,t);if(r!==void 0)return[...r,e.right.hash];const n=ue(e.right,t);if(n!==void 0)return[...n,e.left.hash]}else if(M(e.hash,t))return[]}function _t(e){const t=e.version||Te;return Sr("TapLeaf",Nt([new Uint8Array([t]),gh(e.output)]))}function yh(e,t){return Sr("TapTweak",t?Nt([e,t]):e)}function _e(e,t){if(!(e instanceof Uint8Array)||e.length!==32||t&&t.length!==32)return null;const r=yh(e,t),n=ph().xOnlyPointAddTweak(e,r);return!n||n.xOnlyPubkey===null?null:{parity:n.parity,x:new Uint8Array(n.xOnlyPubkey)}}function Ie(e,t){return Sr("TapBranch",Nt([e,t]))}function gh(e){const t=kr(e.length),r=ce(t);return Nn(e.length,r),Nt([r,e])}const An=q,On=2,bh=80;class me{static NAME=it.P2MR;#o;#a;#n;#s;#e;#t;#r;#i;#f;#u;#h;#c;#w;#y;#g;#l=!1;#d=!1;#p=!1;#m=!1;#E=!1;#v=!1;#A;#b=!1;#P;#O=!1;#T;#I=!1;constructor(t,r){this.#o=t.network??Ot,this.#a={validate:r?.validate??!0,allowIncomplete:r?.allowIncomplete??!1},this.#n=t.address,this.#s=t.hash,this.#e=t.scriptTree,this.#t=t.output,this.#r=t.witness,this.#i=t.redeem,this.#f=t.redeemVersion,this.#a.validate&&this.#C()}get name(){return it.P2MR}get network(){return this.#o}get address(){return this.#l||(this.#u=this.#R(),this.#l=!0),this.#u}get hash(){return this.#d||(this.#h=this.#x(),this.#d=!0),this.#h}get output(){return this.#p||(this.#c=this.#S(),this.#p=!0),this.#c}get redeem(){return this.#m||(this.#w=this.#_(),this.#m=!0),this.#w}get redeemVersion(){return this.#E||(this.#y=this.#N(),this.#E=!0),this.#y??Te}get witness(){return this.#v||(this.#g=this.#L(),this.#v=!0),this.#g}static fromScriptTree(t,r){return new me({scriptTree:t,network:r})}static fromAddress(t,r){return new me({address:t,network:r})}static fromOutput(t,r){return new me({output:t,network:r})}static fromHash(t,r){return new me({hash:t,network:r})}toPayment(){return{name:this.name,network:this.network,address:this.address,hash:this.hash,scriptTree:this.#e,output:this.output,redeem:this.redeem,redeemVersion:this.redeemVersion,witness:this.witness}}#U(){if(!this.#b){if(this.#n){const t=Br(this.#n);t&&(this.#A={version:t.version,prefix:t.prefix,data:t.data})}this.#b=!0}return this.#A}#B(){if(!this.#O){if(this.#r&&this.#r.length>0){const t=this.#r[this.#r.length-1];this.#r.length>=2&&t&&t[0]===bh?this.#P=this.#r.slice(0,-1):this.#P=this.#r.slice()}this.#O=!0}return this.#P}#k(){return this.#I||(this.#e?this.#T=We(this.#e):this.#s&&(this.#T={hash:this.#s}),this.#I=!0),this.#T}#R(){if(this.#n)return this.#n;const t=this.hash;if(!t)return;const r=ut.bech32m.toWords(t);return r.unshift(On),ut.bech32m.encode(this.#o.bech32,r)}#x(){if(this.#s)return this.#s;const t=this.#k();if(t)return t.hash;if(this.#t)return this.#t.subarray(2);if(this.#n)return this.#U()?.data;const r=this.#B();if(r&&r.length>1){const n=r[r.length-1],o=n[0]&Xt,f=r[r.length-2],u=_t({output:f,version:o});return vn(n,u)}}#S(){if(this.#t)return this.#t;const t=this.hash;if(t)return at([An.OP_2,t])}#_(){if(this.#i)return this.#i;const t=this.#B();if(!t||t.length<2)return;const r=t[t.length-1];return{output:t[t.length-2],witness:t.slice(0,-2),redeemVersion:r[0]&Xt}}#N(){return this.#f!==void 0?this.#f:this.#i&&this.#i.redeemVersion!==void 0&&this.#i.redeemVersion!==null?this.#i.redeemVersion:Te}#L(){if(this.#r)return this.#r;const t=this.#k();if(t&&this.#i?.output){const r=_t({output:this.#i.output,version:this.redeemVersion}),n=ue(t,r);if(!n)return;const o=this.redeemVersion??192,f=Nt([new Uint8Array([o|1]),...n]);return[this.#i.output,f]}}#C(){let t=new Uint8Array(0);if(this.#n){const o=this.#U();if(!o)throw new TypeError("Invalid address");if(this.#o&&this.#o.bech32!==o.prefix)throw new TypeError("Invalid prefix or Network mismatch");if(o.version!==On)throw new TypeError("Invalid address version");if(o.data.length!==32)throw new TypeError("Invalid address data");t=o.data}if(this.#t){if(this.#t.length!==34||this.#t[0]!==An.OP_2||this.#t[1]!==32)throw new TypeError("Output is invalid");if(t.length>0&&!M(t,this.#t.subarray(2)))throw new TypeError("Hash mismatch");t=this.#t.subarray(2)}if(this.#s){if(this.#s.length!==32)throw new TypeError("Invalid hash length");if(t.length>0&&!M(t,this.#s))throw new TypeError("Hash mismatch")}const r=this.#k();if(this.#s&&r&&!M(this.#s,r.hash))throw new TypeError("Hash mismatch");if(this.#i?.output&&r){const o=_t({output:this.#i.output,version:this.redeemVersion});if(!ue(r,o))throw new TypeError("Redeem script not in tree")}const n=this.#B();if(this.#i&&this.redeem){if(this.#i.redeemVersion&&this.#i.redeemVersion!==this.redeem.redeemVersion)throw new TypeError("Redeem.redeemVersion and witness mismatch");if(this.#i.output){const o=ht(this.#i.output);if(!o||o.length===0)throw new TypeError("Redeem.output is invalid");if(this.redeem.output&&!M(this.#i.output,this.redeem.output))throw new TypeError("Redeem.output and witness mismatch")}if(this.#i.witness&&this.redeem.witness&&!Jt(this.#i.witness,this.redeem.witness))throw new TypeError("Redeem.witness and witness mismatch")}if(n&&n.length>0){if(n.length<2)throw new TypeError("P2MR requires at least 2 witness items (script + control block)");const o=n[n.length-1];if(o.length<1)throw new TypeError(`The control-block length is too small. Got ${o.length}, expected min 1.`);if((o.length-1)%32!==0)throw new TypeError(`The control-block length of ${o.length} is incorrect!`);const f=(o.length-1)/32;if(f>128)throw new TypeError(`The script path is too long. Got ${f}, expected max 128.`);const u=o[0];if((u&1)!==1)throw new TypeError("P2MR control byte parity bit must be 1");const c=u&Xt,p=n[n.length-2],l=_t({output:p,version:c}),a=vn(o,l);if(t.length>0&&!M(t,a))throw new TypeError("Merkle root mismatch for p2mr witness")}}}const Pn=q,Tn=1,mh=80;class Ee{static NAME=it.P2TR;#o;#a;#n;#s;#e;#t;#r;#i;#f;#u;#h;#c;#w;#y;#g;#l;#d;#p;#m;#E;#v;#A=!1;#b=!1;#P=!1;#O=!1;#T=!1;#I=!1;#U=!1;#B=!1;#k=!1;#R;#x=!1;#S;#_=!1;#N;#L=!1;constructor(t,r){this.#o=t.network??Ot,this.#a={validate:r?.validate??!0,allowIncomplete:r?.allowIncomplete??!1},this.#n=t.address,this.#s=t.pubkey,this.#e=t.internalPubkey,this.#t=t.hash,this.#r=t.scriptTree,this.#i=t.signature,this.#f=t.output,this.#u=t.witness,this.#h=t.redeem,this.#c=t.redeemVersion,this.#a.validate&&this.#W()}get name(){return it.P2TR}get network(){return this.#o}get address(){return this.#A||(this.#w=this.#V(),this.#A=!0),this.#w}get pubkey(){return this.#b||(this.#y=this.#M(),this.#b=!0),this.#y}get internalPubkey(){return this.#P||(this.#g=this.#F(),this.#P=!0),this.#g}get hash(){return this.#O||(this.#l=this.#K(),this.#O=!0),this.#l}get signature(){return this.#T||(this.#d=this.#$(),this.#T=!0),this.#d}get output(){return this.#I||(this.#p=this.#G(),this.#I=!0),this.#p}get redeem(){return this.#U||(this.#m=this.#j(),this.#U=!0),this.#m}get redeemVersion(){return this.#B||(this.#E=this.#q(),this.#B=!0),this.#E??Te}get witness(){return this.#k||(this.#v=this.#Y(),this.#k=!0),this.#v}static fromInternalPubkey(t,r,n){return new Ee({internalPubkey:t,scriptTree:r,network:n})}static fromAddress(t,r){return new Ee({address:t,network:r})}static fromOutput(t,r){return new Ee({output:t,network:r})}static fromSignature(t,r,n){return new Ee({signature:t,internalPubkey:r,network:n})}toPayment(){return{name:this.name,network:this.network,address:this.address,pubkey:this.pubkey,internalPubkey:this.internalPubkey,hash:this.hash,scriptTree:this.#r,signature:this.signature,output:this.output,redeem:this.redeem,redeemVersion:this.redeemVersion,witness:this.witness}}#C(){if(!this.#x){if(this.#n){const t=Br(this.#n);t&&(this.#R={version:t.version,prefix:t.prefix,data:t.data})}this.#x=!0}return this.#R}#H(){if(!this.#_){if(this.#u&&this.#u.length>0){const t=this.#u[this.#u.length-1];this.#u.length>=2&&t&&t[0]===mh?this.#S=this.#u.slice(0,-1):this.#S=this.#u.slice()}this.#_=!0}return this.#S}#D(){return this.#L||(this.#r?this.#N=We(this.#r):this.#t&&(this.#N={hash:this.#t}),this.#L=!0),this.#N}#V(){if(this.#n)return this.#n;const t=this.pubkey;if(!t)return;const r=ut.bech32m.toWords(t);return r.unshift(Tn),ut.bech32m.encode(this.#o.bech32,r)}#M(){if(this.#s)return this.#s;if(this.#f)return this.#f.subarray(2);if(this.#n)return this.#C()?.data;const t=this.internalPubkey;if(t){const r=_e(t,this.hash);if(r)return r.x}}#F(){if(this.#e)return this.#e;const t=this.#H();if(t&&t.length>1){const r=t[t.length-1];if(r)return r.subarray(1,33)}}#K(){const t=this.#D();if(t)return t.hash;const r=this.#H();if(r&&r.length>1){const n=r[r.length-1],o=n[0]&Xt,f=r[r.length-2],u=_t({output:f,version:o});return En(n,u)}}#$(){if(this.#i)return this.#i;const t=this.#H();if(t&&t.length===1)return t[0]}#G(){if(this.#f)return this.#f;const t=this.pubkey;if(t)return at([Pn.OP_1,t])}#j(){if(this.#h)return this.#h;const t=this.#H();if(!t||t.length<2)return;const r=t[t.length-1];return{output:t[t.length-2],witness:t.slice(0,-2),redeemVersion:r[0]&Xt}}#q(){return this.#c!==void 0?this.#c:this.#h&&this.#h.redeemVersion!==void 0&&this.#h.redeemVersion!==null?this.#h.redeemVersion:Te}#Y(){if(this.#u)return this.#u;const t=this.#D();if(t&&this.#h?.output&&this.#e){const r=_t({output:this.#h.output,version:this.redeemVersion}),n=ue(t,r);if(!n)return;const o=_e(this.#e,t.hash);if(!o)return;const f=this.redeemVersion??192,u=Nt([new Uint8Array([f|o.parity]),this.#e,...n]);return[this.#h.output,u]}if(this.#i)return[this.#i]}#W(){let t=new Uint8Array(0);if(this.#n){const o=this.#C();if(!o)throw new TypeError("Invalid address");if(this.#o&&this.#o.bech32!==o.prefix)throw new TypeError("Invalid prefix or Network mismatch");if(o.version!==Tn)throw new TypeError("Invalid address version");if(o.data.length!==32)throw new TypeError("Invalid address data");t=o.data}if(this.#s){if(t.length>0&&!M(t,this.#s))throw new TypeError("Pubkey mismatch");t=this.#s}if(this.#f){if(this.#f.length!==34||this.#f[0]!==Pn.OP_1||this.#f[1]!==32)throw new TypeError("Output is invalid");if(t.length>0&&!M(t,this.#f.subarray(2)))throw new TypeError("Pubkey mismatch");t=this.#f.subarray(2)}if(this.#e){const o=_e(this.#e,this.hash);if(!o)throw new TypeError("Invalid internal pubkey");if(t.length>0&&!M(t,o.x))throw new TypeError("Pubkey mismatch");t=o.x}const r=this.#D();if(this.#t&&r&&!M(this.#t,r.hash))throw new TypeError("Hash mismatch");if(this.#h?.output&&r){const o=_t({output:this.#h.output,version:this.redeemVersion});if(!ue(r,o))throw new TypeError("Redeem script not in tree")}const n=this.#H();if(this.#h&&this.redeem){if(this.#h.redeemVersion&&this.#h.redeemVersion!==this.redeem.redeemVersion)throw new TypeError("Redeem.redeemVersion and witness mismatch");if(this.#h.output){const o=ht(this.#h.output);if(!o||o.length===0)throw new TypeError("Redeem.output is invalid");if(this.redeem.output&&!M(this.#h.output,this.redeem.output))throw new TypeError("Redeem.output and witness mismatch")}if(this.#h.witness&&this.redeem.witness&&!Jt(this.#h.witness,this.redeem.witness))throw new TypeError("Redeem.witness and witness mismatch")}if(n&&n.length>0)if(n.length===1){const o=n[0];if(this.#i&&!M(this.#i,o))throw new TypeError("Signature mismatch")}else{const o=n[n.length-1];if(o.length<33)throw new TypeError(`The control-block length is too small. Got ${o.length}, expected min 33.`);if((o.length-33)%32!==0)throw new TypeError(`The control-block length of ${o.length} is incorrect!`);const f=(o.length-33)/32;if(f>128)throw new TypeError(`The script path is too long. Got ${f}, expected max 128.`);const u=o.subarray(1,33);if(this.#e&&!M(this.#e,u))throw new TypeError("Internal pubkey mismatch");if(!Fs(u))throw new TypeError("Invalid internalPubkey for p2tr witness");const c=o[0],p=c&Xt,l=n[n.length-2],a=_t({output:l,version:p}),w=En(o,a),m=_e(u,w);if(!m)throw new TypeError("Invalid outputKey for p2tr witness");if(t.length>0&&!M(t,m.x))throw new TypeError("Pubkey mismatch for p2tr witness");if(m.parity!==(c&1))throw new Error("Incorrect parity")}}}const In=q,Eh=new Uint8Array(0);class ve{static NAME=it.P2WPKH;#o;#a;#n;#s;#e;#t;#r;#i;#f;#u;#h;#c;#w;#y;#g;#l=!1;#d=!1;#p=!1;#m=!1;#E=!1;#v=!1;#A=!1;#b;#P=!1;constructor(t,r){this.#o=t.network??Ot,this.#a={validate:r?.validate??!0,allowIncomplete:r?.allowIncomplete??!1},this.#n=t.address,this.#s=t.hash,this.#e=t.pubkey,this.#t=t.signature,this.#r=t.output,this.#i=t.witness,this.#a.validate&&this.#S()}get name(){return it.P2WPKH}get network(){return this.#o}get address(){return this.#l||(this.#f=this.#T(),this.#l=!0),this.#f}get hash(){return this.#d||(this.#u=this.#I(),this.#d=!0),this.#u}get pubkey(){return this.#p||(this.#h=this.#U(),this.#p=!0),this.#h}get signature(){return this.#m||(this.#c=this.#B(),this.#m=!0),this.#c}get output(){return this.#E||(this.#w=this.#k(),this.#E=!0),this.#w}get input(){return this.#v||(this.#y=this.#R(),this.#v=!0),this.#y}get witness(){return this.#A||(this.#g=this.#x(),this.#A=!0),this.#g}static fromPubkey(t,r){return new ve({pubkey:t,network:r})}static fromAddress(t,r){return new ve({address:t,network:r})}static fromHash(t,r){return new ve({hash:t,network:r})}static fromOutput(t,r){return new ve({output:t,network:r})}toPayment(){return{name:this.name,network:this.network,address:this.address,hash:this.hash,pubkey:this.pubkey,signature:this.signature,output:this.output,input:this.input,witness:this.witness}}#O(){if(!this.#P){if(this.#n){const t=ut.bech32.decode(this.#n),r=t.words.shift(),n=ut.bech32.fromWords(t.words);this.#b={version:r??0,prefix:t.prefix,data:new Uint8Array(n)}}this.#P=!0}return this.#b}#T(){if(this.#n)return this.#n;const t=this.hash;if(!t)return;const r=ut.bech32.toWords(t);return r.unshift(0),ut.bech32.encode(this.#o.bech32,r)}#I(){if(this.#s)return this.#s;if(this.#r)return this.#r.subarray(2,22);if(this.#n)return this.#O()?.data;const t=this.#e??this.pubkey;if(t)return At(t)}#U(){if(this.#e)return this.#e;if(this.#i&&this.#i.length>=2)return this.#i[1]}#B(){if(this.#t)return this.#t;if(this.#i&&this.#i.length>=1)return this.#i[0]}#k(){if(this.#r)return this.#r;const t=this.hash;if(t)return at([In.OP_0,t])}#R(){if(this.witness)return Eh}#x(){if(this.#i)return this.#i;if(!(!this.#e||!this.#t))return[this.#t,this.#e]}#S(){let t=new Uint8Array(0);if(this.#n){const r=this.#O();if(!r)throw new TypeError("Invalid address");if(this.#o&&this.#o.bech32!==r.prefix)throw new TypeError("Invalid prefix or Network mismatch");if(r.version!==0)throw new TypeError("Invalid address version");if(r.data.length!==20)throw new TypeError("Invalid address data");t=r.data}if(this.#s){if(t.length>0&&!M(t,this.#s))throw new TypeError("Hash mismatch");t=this.#s}if(this.#r){if(this.#r.length!==22||this.#r[0]!==In.OP_0||this.#r[1]!==20)throw new TypeError("Output is invalid");if(t.length>0&&!M(t,this.#r.subarray(2)))throw new TypeError("Hash mismatch");t=this.#r.subarray(2)}if(this.#e){const r=At(this.#e);if(t.length>0&&!M(t,r))throw new TypeError("Hash mismatch");if(t=r,!he(this.#e)||this.#e.length!==33)throw new TypeError("Invalid pubkey for p2wpkh")}if(this.#i){if(this.#i.length!==2)throw new TypeError("Witness is invalid");const r=this.#i[0],n=this.#i[1];if(!Qe(r))throw new TypeError("Witness has invalid signature");if(!he(n)||n.length!==33)throw new TypeError("Witness has invalid pubkey");if(this.#t&&!M(this.#t,r))throw new TypeError("Signature mismatch");if(this.#e&&!M(this.#e,n))throw new TypeError("Pubkey mismatch");const o=At(n);if(t.length>0&&!M(t,o))throw new TypeError("Hash mismatch")}}}const Bn=q,pr=new Uint8Array(0);function Ne(e){return!!(e instanceof Uint8Array&&e.length===65&&e[0]===4&&he(e))}class Ae{static NAME=it.P2WSH;#o;#a;#n;#s;#e;#t;#r;#i;#f;#u;#h;#c;#w;#y=!1;#g=!1;#l=!1;#d=!1;#p=!1;#m=!1;#E;#v=!1;#A;#b=!1;constructor(t,r){let n=t.network;n||(n=t.redeem&&t.redeem.network||Ot),this.#o=n,this.#a={validate:r?.validate??!0,allowIncomplete:r?.allowIncomplete??!1},this.#n=t.address,this.#s=t.hash,this.#e=t.output,this.#t=t.redeem,this.#r=t.witness,this.#a.validate&&this.#x()}get name(){const t=this.redeem;return t!==void 0&&t.name!==void 0?`p2wsh-${t.name}`:it.P2WSH}get network(){return this.#o}get address(){return this.#y||(this.#i=this.#T(),this.#y=!0),this.#i}get hash(){return this.#g||(this.#f=this.#I(),this.#g=!0),this.#f}get output(){return this.#l||(this.#u=this.#U(),this.#l=!0),this.#u}get input(){return this.#d||(this.#h=this.#B(),this.#d=!0),this.#h}get redeem(){return this.#p||(this.#c=this.#k(),this.#p=!0),this.#c}get witness(){return this.#m||(this.#w=this.#R(),this.#m=!0),this.#w}static fromRedeem(t,r){return new Ae({redeem:t,network:r})}static fromAddress(t,r){return new Ae({address:t,network:r})}static fromHash(t,r){return new Ae({hash:t,network:r})}static fromOutput(t,r){return new Ae({output:t,network:r})}toPayment(){const t=this.witness,r=this.redeem;return{name:this.name,network:this.network,address:this.address,hash:this.hash,output:this.output,input:this.input,redeem:r,witness:t}}#P(){if(!this.#v){if(this.#n){const t=ut.bech32.decode(this.#n),r=t.words.shift(),n=ut.bech32.fromWords(t.words);this.#E={version:r??0,prefix:t.prefix,data:new Uint8Array(n)}}this.#v=!0}return this.#E}#O(){return this.#b||(this.#t?.input&&(this.#A=ht(this.#t.input)??void 0),this.#b=!0),this.#A}#T(){if(this.#n)return this.#n;const t=this.hash;if(!t)return;const r=ut.bech32.toWords(t);return r.unshift(0),ut.bech32.encode(this.#o.bech32,r)}#I(){if(this.#s)return this.#s;if(this.#e)return this.#e.subarray(2);if(this.#n)return this.#P()?.data;const t=this.redeem;if(t&&t.output)return mr(t.output)}#U(){if(this.#e)return this.#e;const t=this.hash;if(t)return at([Bn.OP_0,t])}#B(){if(this.witness)return pr}#k(){if(this.#t)return this.#t;if(this.#r&&this.#r.length>0)return{output:this.#r[this.#r.length-1],input:pr,witness:this.#r.slice(0,-1)}}#R(){if(this.#r)return this.#r;const t=this.#t;if(t){if(t.input&&t.input.length>0&&t.output&&t.output.length>0){const r=this.#O();if(r){const n=Ws(r);return this.#c=Object.assign({witness:n},t,{input:pr}),this.#p=!0,[].concat(n,t.output)}}return!t.output||!t.witness?void 0:[].concat(t.witness,t.output)}}#x(){let t=new Uint8Array(0);if(this.#n){const r=this.#P();if(!r)throw new TypeError("Invalid address");if(r.prefix!==this.#o.bech32)throw new TypeError("Invalid prefix or Network mismatch");if(r.version!==0)throw new TypeError("Invalid address version");if(r.data.length!==32)throw new TypeError("Invalid address data");t=r.data}if(this.#s){if(t.length>0&&!M(t,this.#s))throw new TypeError("Hash mismatch");t=this.#s}if(this.#e){if(this.#e.length!==34||this.#e[0]!==Bn.OP_0||this.#e[1]!==32)throw new TypeError("Output is invalid");const r=this.#e.subarray(2);if(t.length>0&&!M(t,r))throw new TypeError("Hash mismatch");t=r}if(this.#t){if(this.#t.network&&this.#t.network!==this.#o)throw new TypeError("Network mismatch");if(this.#t.input&&this.#t.input.length>0&&this.#t.witness&&this.#t.witness.length>0)throw new TypeError("Ambiguous witness source");if(this.#t.output){const n=ht(this.#t.output);if(!n||n.length<1)throw new TypeError("Redeem.output is invalid");if(this.#t.output.byteLength>3600)throw new TypeError("Redeem.output unspendable if larger than 3600 bytes");if(jn(n)>201)throw new TypeError("Redeem.output unspendable with more than 201 non-push ops");const o=mr(this.#t.output);if(t.length>0&&!M(t,o))throw new TypeError("Hash mismatch");t=o}const r=this.#O();if(this.#t.input&&r&&!xr(r))throw new TypeError("Non push-only scriptSig");if(this.#r&&this.#t.witness&&!Jt(this.#r,this.#t.witness))throw new TypeError("Witness and redeem.witness mismatch");if(this.#t.input&&r?.some(Ne)||this.#t.output&&(ht(this.#t.output)||[]).some(Ne))throw new TypeError("redeem.input or redeem.output contains uncompressed pubkey")}if(this.#r&&this.#r.length>0){const r=this.#r[this.#r.length-1];if(this.#t&&this.#t.output&&!M(this.#t.output,r))throw new TypeError("Witness and redeem.output mismatch");if(this.#r.some(Ne)||(ht(r)||[]).some(Ne))throw new TypeError("Witness contains uncompressed pubkey")}}}const kn=q;class De{static NAME=it.P2PK;#o;#a;#n;#s;#e;#t;#r;#i;#f;#u;#h;#c=!1;#w=!1;#y=!1;#g=!1;#l=!1;constructor(t,r){this.#o=t.network??Ot,this.#a={validate:r?.validate??!0,allowIncomplete:r?.allowIncomplete??!1},this.#n=t.pubkey,this.#s=t.signature,this.#e=t.output,this.#t=t.input,this.#a.validate&&this.#A()}get name(){return it.P2PK}get network(){return this.#o}get pubkey(){return this.#c||(this.#r=this.#d(),this.#c=!0),this.#r}get signature(){return this.#w||(this.#i=this.#p(),this.#w=!0),this.#i}get output(){return this.#y||(this.#f=this.#m(),this.#y=!0),this.#f}get input(){return this.#g||(this.#u=this.#E(),this.#g=!0),this.#u}get witness(){return this.#l||(this.#h=this.#v(),this.#l=!0),this.#h}static fromPubkey(t,r){return new De({pubkey:t,network:r})}static fromOutput(t,r){return new De({output:t,network:r})}static fromSignature(t,r,n){return new De({signature:t,pubkey:r,network:n})}toPayment(){return{name:this.name,network:this.network,pubkey:this.pubkey,signature:this.signature,output:this.output,input:this.input,witness:this.witness}}#d(){if(this.#n)return this.#n;if(this.#e)return this.#e.subarray(1,-1)}#p(){if(this.#s)return this.#s;if(this.#t){const t=ht(this.#t);if(t&&t.length>0)return t[0]}}#m(){if(this.#e)return this.#e;const t=this.#n;if(t)return at([t,kn.OP_CHECKSIG])}#E(){if(this.#t)return this.#t;const t=this.#s;if(t)return at([t])}#v(){if(this.input)return[]}#A(){if(this.#e){if(this.#e[this.#e.length-1]!==kn.OP_CHECKSIG)throw new TypeError("Output is invalid");const t=this.pubkey;if(!he(t))throw new TypeError("Output pubkey is invalid");if(this.#n&&t&&!M(this.#n,t))throw new TypeError("Pubkey mismatch")}if(this.#s){const t=this.input;if(this.#t&&t&&!M(this.#t,t))throw new TypeError("Signature mismatch")}if(this.#t){const t=ht(this.#t);if(!t||t.length!==1)throw new TypeError("Input is invalid");const r=this.signature;if(!r||!Qe(r))throw new TypeError("Input has invalid signature")}}}const ie=q,Le=ie.OP_RESERVED;class Ve{static NAME=it.P2MS;#o;#a;#n;#s;#e;#t;#r;#i;#f;#u;#h;#c;#w;#y;#g;#l=!1;#d=!1;#p=!1;#m=!1;#E=!1;#v=!1;#A=!1;#b;#P=!1;constructor(t,r){this.#o=t.network??Ot,this.#a={validate:r?.validate??!0,allowIncomplete:r?.allowIncomplete??!1},this.#n=t.m,this.#s=t.n,this.#e=t.pubkeys,this.#t=t.signatures,this.#r=t.output,this.#i=t.input,this.#a.validate&&this.#_()}get name(){const t=this.m,r=this.n;return t!==void 0&&r!==void 0?`p2ms(${t} of ${r})`:it.P2MS}get network(){return this.#o}get m(){return this.#l||(this.#f=this.#T(),this.#l=!0),this.#f}get n(){return this.#d||(this.#u=this.#I(),this.#d=!0),this.#u}get pubkeys(){return this.#p||(this.#h=this.#U(),this.#p=!0),this.#h}get signatures(){return this.#m||(this.#c=this.#B(),this.#m=!0),this.#c}get output(){return this.#E||(this.#w=this.#k(),this.#E=!0),this.#w}get input(){return this.#v||(this.#y=this.#R(),this.#v=!0),this.#y}get witness(){return this.#A||(this.#g=this.#x(),this.#A=!0),this.#g}static fromPubkeys(t,r,n){return new Ve({m:t,pubkeys:r,network:n})}static fromOutput(t,r){return new Ve({output:t,network:r})}static fromSignatures(t,r,n,o){return new Ve({signatures:t,m:r,pubkeys:n,network:o})}toPayment(){return{name:this.name,network:this.network,m:this.m,n:this.n,pubkeys:this.pubkeys,signatures:this.signatures,output:this.output,input:this.input,witness:this.witness}}#O(t){this.#P||(this.#P=!0,this.#b=ht(t)??[],this.#f=this.#b[0]-Le,this.#u=this.#b[this.#b.length-2]-Le,this.#h=this.#b.slice(1,-2),this.#l=!0,this.#d=!0,this.#p=!0)}#T(){if(this.#n!==void 0)return this.#n;const t=this.#r??this.output;if(t)return this.#O(t),this.#f}#I(){if(this.#s!==void 0)return this.#s;if(this.#e)return this.#e.length;if(this.#r)return this.#O(this.#r),this.#u}#U(){if(this.#e)return this.#e;if(this.#r)return this.#O(this.#r),this.#h}#B(){if(this.#t)return this.#t;if(this.#i)return ht(this.#i)?.slice(1)}#k(){if(this.#r)return this.#r;const t=this.#n,r=this.n,n=this.#e;if(!(t===void 0||r===void 0||!n))return at([].concat(Le+t,n,Le+r,ie.OP_CHECKMULTISIG))}#R(){if(this.#i)return this.#i;if(this.#t)return at([ie.OP_0].concat(this.#t))}#x(){if(this.input)return[]}#S(t){return Qe(t)||this.#a.allowIncomplete&&t===ie.OP_0}#_(){if(this.#r){this.#O(this.#r);const t=this.#b;if(!t)throw new TypeError("Output is invalid");if(typeof t[0]!="number")throw new TypeError("Output is invalid");if(typeof t[t.length-2]!="number")throw new TypeError("Output is invalid");if(t[t.length-1]!==ie.OP_CHECKMULTISIG)throw new TypeError("Output is invalid");const r=this.#f,n=this.#u,o=this.#h;if(r===void 0||n===void 0||!o)throw new TypeError("Output is invalid");if(r<=0||n>16||r>n||n!==t.length-3)throw new TypeError("Output is invalid");if(!o.every(f=>he(f)))throw new TypeError("Output is invalid");if(this.#n!==void 0&&this.#n!==r)throw new TypeError("m mismatch");if(this.#s!==void 0&&this.#s!==n)throw new TypeError("n mismatch");if(this.#e&&!Jt(this.#e,o))throw new TypeError("Pubkeys mismatch")}if(this.#e){if(this.#s!==void 0&&this.#s!==this.#e.length)throw new TypeError("Pubkey count mismatch");if(this.#u=this.#e.length,this.#d=!0,this.#f!==void 0&&this.#u<this.#f)throw new TypeError("Pubkey count cannot be less than m")}if(this.#t){if(this.#f!==void 0&&this.#t.length<this.#f)throw new TypeError("Not enough signatures provided");if(this.#f!==void 0&&this.#t.length>this.#f)throw new TypeError("Too many signatures provided")}if(this.#i){if(this.#i[0]!==ie.OP_0)throw new TypeError("Input is invalid");const t=this.signatures;if(!t||t.length===0||!t.every(r=>this.#S(r)))throw new TypeError("Input has invalid signature(s)");if(this.#t&&!Jt(this.#t,t))throw new TypeError("Signature mismatch");if(this.#n!==void 0&&this.#t&&this.#n!==this.#t.length)throw new TypeError("Signature count mismatch")}}}ae("0000000000000000000000000000000000000000000000000000000000000000");Gs(ae("0000000000000000000000000000000000000000000000000000000000000001"));const Un=q;class Ir{static NAME=it.Embed;#o;#a;#n;#s;#e;#t;#r=!1;#i=!1;constructor(t,r){this.#o=t.network??Ot,this.#a={validate:r?.validate??!0,allowIncomplete:r?.allowIncomplete??!1},this.#n=t.data,this.#s=t.output,this.#a.validate&&this.#h()}get name(){return it.Embed}get network(){return this.#o}get data(){return this.#r||(this.#e=this.#f(),this.#r=!0),this.#e??[]}get output(){return this.#i||(this.#t=this.#u(),this.#i=!0),this.#t}static fromData(t,r){return new Ir({data:t,network:r})}static fromOutput(t,r){return new Ir({output:t,network:r})}toPayment(){return{name:this.name,network:this.network,data:this.data,output:this.output}}#f(){if(this.#n)return this.#n;if(this.#s)return ht(this.#s)?.slice(1)}#u(){if(this.#s)return this.#s;if(this.#n)return at([Un.OP_RETURN].concat(this.#n))}#h(){if(this.#s){const t=ht(this.#s);if(!t)throw new TypeError("Output is invalid");if(t[0]!==Un.OP_RETURN)throw new TypeError("Output is invalid");if(!t.slice(1).every(r=>r instanceof Uint8Array))throw new TypeError("Output is invalid");if(this.#n&&!Jt(this.#n,this.data))throw new TypeError("Data mismatch")}}}ae("6a24aa21a9ed");var Rn;(function(e){e[e.UNSIGNED_TX=0]="UNSIGNED_TX",e[e.GLOBAL_XPUB=1]="GLOBAL_XPUB"})(Rn||(Rn={}));var xt;(function(e){e[e.NON_WITNESS_UTXO=0]="NON_WITNESS_UTXO",e[e.WITNESS_UTXO=1]="WITNESS_UTXO",e[e.PARTIAL_SIG=2]="PARTIAL_SIG",e[e.SIGHASH_TYPE=3]="SIGHASH_TYPE",e[e.REDEEM_SCRIPT=4]="REDEEM_SCRIPT",e[e.WITNESS_SCRIPT=5]="WITNESS_SCRIPT",e[e.BIP32_DERIVATION=6]="BIP32_DERIVATION",e[e.FINAL_SCRIPTSIG=7]="FINAL_SCRIPTSIG",e[e.FINAL_SCRIPTWITNESS=8]="FINAL_SCRIPTWITNESS",e[e.POR_COMMITMENT=9]="POR_COMMITMENT",e[e.TAP_KEY_SIG=19]="TAP_KEY_SIG",e[e.TAP_SCRIPT_SIG=20]="TAP_SCRIPT_SIG",e[e.TAP_LEAF_SCRIPT=21]="TAP_LEAF_SCRIPT",e[e.TAP_BIP32_DERIVATION=22]="TAP_BIP32_DERIVATION",e[e.TAP_INTERNAL_KEY=23]="TAP_INTERNAL_KEY",e[e.TAP_MERKLE_ROOT=24]="TAP_MERKLE_ROOT"})(xt||(xt={}));var $t;(function(e){e[e.REDEEM_SCRIPT=0]="REDEEM_SCRIPT",e[e.WITNESS_SCRIPT=1]="WITNESS_SCRIPT",e[e.BIP32_DERIVATION=2]="BIP32_DERIVATION",e[e.TAP_INTERNAL_KEY=5]="TAP_INTERNAL_KEY",e[e.TAP_TREE=6]="TAP_TREE",e[e.TAP_BIP32_DERIVATION=7]="TAP_BIP32_DERIVATION"})($t||($t={}));const Ze="0123456789abcdefABCDEF",Xe=Ze.split("").map(e=>e.codePointAt(0)),xn=Array(256).fill(!0).map((e,t)=>{const r=String.fromCodePoint(t),n=Ze.indexOf(r);return n<0?void 0:n<16?n:n-6});new TextEncoder;const vh=new TextDecoder;function xi(e){const t=e.reduce((o,f)=>o+f.length,0),r=new Uint8Array(t);let n=0;for(const o of e)r.set(o,n),n+=o.length;return r}function Qt(e){const t=e||new Uint8Array;return t.length>512?Oh(t):Ah(t)}function Ah(e){let t="";for(let r=0;r<e.length;++r)t+=Ze[xn[Xe[e[r]>>4]]],t+=Ze[xn[Xe[e[r]&15]]];return t}function Oh(e){const t=new Uint8Array(e.length*2);for(let r=0;r<e.length;++r)t[r*2]=Xe[e[r]>>4],t[r*2+1]=Xe[e[r]&15];return vh.decode(t)}function Ph(e,t){const r=Math.min(e.length,t.length);for(let n=0;n<r;++n)if(e[n]!==t[n])return e[n]<t[n]?-1:1;return e.length===t.length?0:e.length>t.length?1:-1}function Th(e,t,r,n){if(t+4>e.length)throw new Error("Offset is outside the bounds of Uint8Array");if(n=n.toUpperCase(),r>4294967295)throw new Error(`The value of "value" is out of range. It must be >= 0 and <= ${4294967295}. Received ${r}`);return n==="LE"?(e[t]=r&255,e[t+1]=r>>8&255,e[t+2]=r>>16&255,e[t+3]=r>>24&255):(e[t]=r>>24&255,e[t+1]=r>>16&255,e[t+2]=r>>8&255,e[t+3]=r&255),t+4}function Ih(e,t,r){if(t+4>e.length)throw new Error("Offset is outside the bounds of Uint8Array");if(r=r.toUpperCase(),r==="LE"){let n=0;return n=(n<<8)+e[t+3]>>>0,n=(n<<8)+e[t+2]>>>0,n=(n<<8)+e[t+1]>>>0,n=(n<<8)+e[t]>>>0,n}else{let n=0;return n=(n<<8)+e[t]>>>0,n=(n<<8)+e[t+1]>>>0,n=(n<<8)+e[t+2]>>>0,n=(n<<8)+e[t+3]>>>0,n}}const Bh=e=>[...Array(e).keys()],kh=e=>e.length===33&&[2,3].includes(e[0])||e.length===65&&e[0]===4;function Kr(e,t=kh){function r(c){if(c.key[0]!==e)throw new Error("Decode Error: could not decode bip32Derivation with key 0x"+Qt(c.key));const p=c.key.slice(1);if(!t(p))throw new Error("Decode Error: bip32Derivation has invalid pubkey in key 0x"+Qt(c.key));if(c.value.length/4%1!==0)throw new Error("Decode Error: Input BIP32_DERIVATION value length should be multiple of 4");const l={masterFingerprint:c.value.slice(0,4),pubkey:p,path:"m"};for(const a of Bh(c.value.length/4-1)){const w=Ih(c.value,a*4+4,"LE"),m=!!(w&2147483648),g=w&2147483647;l.path+="/"+g.toString(10)+(m?"'":"")}return l}function n(c){const p=Uint8Array.from([e]),l=xi([p,c.pubkey]),a=c.path.split("/"),w=new Uint8Array(a.length*4);w.set(c.masterFingerprint,0);let m=4;return a.slice(1).forEach(g=>{const v=g.slice(-1)==="'";let E=2147483647&parseInt(v?g.slice(0,-1):g,10);v&&(E+=2147483648),Th(w,m,E,"LE"),m+=4}),{key:l,value:w}}const o="{ masterFingerprint: Uint8Array; pubkey: Uint8Array; path: string; }";function f(c){return c.pubkey instanceof Uint8Array&&c.masterFingerprint instanceof Uint8Array&&typeof c.path=="string"&&t(c.pubkey)&&c.masterFingerprint.length===4}function u(c,p,l){const a=Qt(p.pubkey);return l.has(a)?!1:(l.add(a),c.filter(w=>Ph(w.pubkey,p.pubkey)===0).length===0)}return{decode:r,encode:n,check:f,expected:o,canAddToArray:u}}function Si(e){return t;function t(r){let n;if(e.includes(r.key[0])&&(n=r.key.slice(1),!(n.length===33||n.length===65)||![2,3,4].includes(n[0])))throw new Error("Format Error: invalid pubkey in key 0x"+Qt(r.key));return n}}function _i(e){function t(u){if(u.key[0]!==e)throw new Error("Decode Error: could not decode redeemScript with key 0x"+Qt(u.key));return u.value}function r(u){return{key:Uint8Array.from([e]),value:u}}const n="Uint8Array";function o(u){return u instanceof Uint8Array}function f(u,c){return!!u&&!!c&&u.redeemScript===void 0}return{decode:t,encode:r,check:o,expected:n,canAdd:f}}const Uh=e=>e.length===32;function Ni(e){const t=Kr(e,Uh);function r(u){const{numberValue:c,bytes:p}=as(u.value),l=t.decode({key:u.key,value:u.value.slice(p+Number(c)*32)}),a=new Array(Number(c));for(let w=0,m=p;w<c;w++,m+=32)a[w]=u.value.slice(m,m+32);return{...l,leafHashes:a}}function n(u){const c=t.encode(u),p=kr(u.leafHashes.length),l=new Uint8Array(p);Nn(u.leafHashes.length,l);const a=xi([l,...u.leafHashes,c.value]);return{...c,value:a}}const o="{ masterFingerprint: Uint8Array; pubkey: Uint8Array; path: string; leafHashes: Uint8Array[]; }";function f(u){return Array.isArray(u.leafHashes)&&u.leafHashes.every(c=>c instanceof Uint8Array&&c.length===32)&&t.check(u)}return{decode:r,encode:n,check:f,expected:o,canAddToArray:t.canAddToArray}}function Li(e){function t(u){if(u.key[0]!==e||u.key.length!==1)throw new Error("Decode Error: could not decode tapInternalKey with key 0x"+Qt(u.key));if(u.value.length!==32)throw new Error("Decode Error: tapInternalKey not a 32-byte x-only pubkey");return u.value}function r(u){return{key:Uint8Array.from([e]),value:u}}const n="Uint8Array";function o(u){return u instanceof Uint8Array&&u.length===32}function f(u,c){return!!u&&!!c&&u.tapInternalKey===void 0}return{decode:t,encode:r,check:o,expected:n,canAdd:f}}function Ci(e){function t(u){if(u.key[0]!==e)throw new Error("Decode Error: could not decode witnessScript with key 0x"+Qt(u.key));return u.value}function r(u){return{key:Uint8Array.from([e]),value:u}}const n="Uint8Array";function o(u){return u instanceof Uint8Array}function f(u,c){return!!u&&!!c&&u.witnessScript===void 0}return{decode:t,encode:r,check:o,expected:n,canAdd:f}}Kr(xt.BIP32_DERIVATION),_i(xt.REDEEM_SCRIPT),Ci(xt.WITNESS_SCRIPT),Si([xt.PARTIAL_SIG,xt.BIP32_DERIVATION]),Ni(xt.TAP_BIP32_DERIVATION),Li(xt.TAP_INTERNAL_KEY);Kr($t.BIP32_DERIVATION),_i($t.REDEEM_SCRIPT),Ci($t.WITNESS_SCRIPT),Si([$t.BIP32_DERIVATION]),Ni($t.TAP_BIP32_DERIVATION),Li($t.TAP_INTERNAL_KEY);export{Rh as X,ae as n,mr as p,ls as x};
